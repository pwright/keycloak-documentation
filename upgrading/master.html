<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Upgrading Guide</title><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" name="viewport"><link href="node_modules/reveal.js/css/reveal.css" rel="stylesheet"><link rel="stylesheet" href="node_modules/reveal.js/css/theme/black.css" id="theme"><!--This CSS is generated by the Asciidoctor-Reveal.js converter to further integrate AsciiDoc's existing semantic with Reveal.js--><style type="text/css">.reveal div.right {
  float: right;
}

/* callouts */
.conum[data-value] {display:inline-block;color:#fff!important;background-color:rgba(50,150,50,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}</style><link href="node_modules/reveal.js/lib/css/zenburn.css" rel="stylesheet"><script>var link = document.createElement( 'link' );
link.rel = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match( /print-pdf/gi ) ? "node_modules/reveal.js/css/print/pdf.css" : "node_modules/reveal.js/css/print/paper.css";
document.getElementsByTagName( 'head' )[0].appendChild( link );</script><!--[if lt IE 9]><script src="node_modules/reveal.js/lib/js/html5shiv.js"></script><![endif]--></head><body><div class="reveal"><div class="slides"><section class="title" data-state="title"><h1>Upgrading Guide</h1></section><section><section id="intro"><h2>Introduction</h2><div class="paragraph"><p>Red Hat Single Sign-On (RH-SSO) 7.3 is based on the Keycloak project and provides security for your web applications by
providing Web single sign-on capabilities based on popular standards such as SAML 2.0, OpenID Connect, and OAuth 2.0.
The Red Hat Single Sign-On Server can act as a SAML or OpenID Connect-based identity provider, mediating with your
enterprise user directory or third-party SSO provider for identity information and your applications using standards-based
tokens.</p></div><div class="paragraph"><p>RH-SSO provides two operating modes: standalone server or managed domain. The standalone server operating mode represents
running RH-SSO as a single server instance. The managed domain operating mode allows for the management of multiple
RH-SSO instances from a single control point. The upgrade process differs depending on which operating mode has been
implemented. Specific instructions for each mode are provided where applicable.</p></div><div class="paragraph"><p>The purpose of this guide is to document the steps that are required to successfully upgrade from
Red Hat Single Sign-On 7.2 to Red Hat Single Sign-On 7.3.</p></div></section><section id="_about_upgrades"><h2>About Upgrades</h2><h3>Major Upgrades</h3><div class="paragraph"><p>A major upgrade or migration is required when RH-SSO is upgraded from one major release to another, for example, from
Red Hat Single Sign-On 7.2 to Red Hat Single Sign-On 8.0. There may be breaking API changes between major releases
that could require rewriting parts of applications or server extensions.</p></div>
<h3>Minor Updates</h3><div class="paragraph"><p>Red Hat Single Sign-On periodically provides point releases, which are minor updates that include bug fixes, security
fixes, and new features. If you plan to upgrade from one Red Hat Single Sign-On point release to another, for example,
from Red Hat Single Sign-On 7.2 to Red Hat Single Sign-On 7.3, code changes should not be required for applications or
custom server extensions as long as no private, unsupported, or tech preview APIs are used.</p></div>
<h3>Micro Updates</h3><div class="paragraph"><p>Red Hat Single Sign-On 7 also periodically provides micro releases that contain bug and security fixes.
Micro releases increment the minor release version by the last digit, for example from 7.2.0 to 7.2.1. These release
do not require migration and should not impact the server configuration files. The patch management system for ZIP
installations can also rollback the patch and server configuration.</p></div>
<div class="paragraph"><p>A micro release only contains the artifacts that have changed. For example if Red Hat Single Sign-On 7.2.1 contains changes to
the server and the JavaScript adapter, but not the EAP adapter, only the server and JavaScript adapter are released and require
updating.</p></div></section></section>
<section><section id="_changes"><h2>Changes</h2><div class="paragraph"><p>Review these changes carefully before upgrading.</p></div></section><section id="_rh_sso_7_3"><h2>RH-SSO 7.3</h2><div class="paragraph"><p>The following changes have occurred from RH-SSO 7.2 to RH-SSO 7.3.</p></div>
<h3>Changes to Authorization Services</h3><div class="paragraph"><p>We added support for UMA 2.0. This version of the UMA specification introduced some important changes on how permissions are obtained from the server.</p></div>
<div class="paragraph"><p>Here are the main changes introduced by UMA 2.0 support. See <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on_continuous_delivery/6/html-single/authorization_services_guide/">Authorization Services Guide</a> for details.</p></div>
<div class="dlist"><dl><dt class="hdlist1">Authorization API was removed</dt><dd><p>Prior to UMA 2.0 (UMA 1.0), client applications were using the Authorization API to obtain permissions from the server in the format of a RPT. The new version
of UMA specification has removed the Authorization API which was also removed from Red Hat Single Sign-On. In UMA 2.0, RPTs can now be obtained from the token endpoint by using a specific grant type.
See <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on_continuous_delivery/6/html-single/authorization_services_guide/#_service_obtaining_permissions">Authorization Services Guide</a> for details.</p></dd><dt class="hdlist1">Entitlement API was removed</dt><dd><p>With the introduction of UMA 2.0, we decided to leverage the token endpoint and UMA grant type to allow obtaining RPTs from Red Hat Single Sign-On and
avoid having different APIs. The functionality provided by the Entitlement API was kept the same and is still possible to obtain permissions for a set
of one or more resources and scopes or all permissions from the server in case no resource or scope is provided.
See <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on_continuous_delivery/6/html-single/authorization_services_guide/#_service_obtaining_permissions">Authorization Services Guide</a> for details.</p></dd><dt class="hdlist1">Changes to UMA Discovery Endpoint</dt><dd><p>UMA Discovery document changed, see <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on_continuous_delivery/6/html-single/authorization_services_guide/#_service_authorization_api">Authorization Services Guide</a> for details.</p></dd><dt class="hdlist1">Changes to Red Hat Single Sign-On Authorization JavaScript Adapter</dt><dd><p>The Red Hat Single Sign-On Authorization JavaScript Adapter (keycloak-authz.js) changed in order to comply with the changes introduced by UMA 2.0 while keeping
the same behavior as before. The main change is on how you invoke both <code>authorization</code> and <code>entitlement</code> methods which now
expect a specific object type representing an authorization request. This new object type provides more flexibility on how
permissions can be obtained from the server by supporting the different parameters supported by the UMA grant type.
See <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on_continuous_delivery/6/html-single/authorization_services_guide/#_enforcer_js_adapter">Authorization Services Guide</a> for details.</p><div class="literalblock"><div class="content"><pre>One of the main changes introduced by this release is that you are no longer required to exchange access tokens with RPTs in
order to access resources protected by a resource server (when not using UMA). Depending on how the policy enforcer is configured on the resource server side, you can just send regular
access tokens as a bearer token and permissions will still be enforced.</pre></div></div></dd><dt class="hdlist1">Changes to Red Hat Single Sign-On Authorization Client Java API</dt><dd><p>When upgrading to the new version of Red Hat Single Sign-On Authorization Client Java API, you&#8217;ll notice that some representation classes
were moved to a different package in <code>org.keycloak:keycloak-core</code>.</p></dd></dl></div>
<h3>Client Templates changed to Client Scopes</h3><div class="paragraph"><p>We added support for Client Scopes, which requires some attention during migration.</p></div>
<div class="dlist"><dl><dt class="hdlist1">Client Templates changed to Client Scopes</dt><dd><p>Client Templates were changed to Client Scopes. If you had any Client Templates, their protocol mappers and role scope mappings
will be preserved.</p></dd><dt class="hdlist1">Spaces replaced in the names</dt><dd><p>Client templates with the space character in the name were renamed by replacing spaces with an underscore, because spaces are
not allowed in the name of client scopes. For example, a client template <code>my template</code> will be changed to client scope <code>my_template</code>.</p></dd><dt class="hdlist1">Linking Client Scopes to Clients</dt><dd><p>For clients which had the client template, the corresponding client scope
is now added as <code>Default Client Scope</code> to the client. So protocol mappers and role scope mappings will be preserved on the client.</p></dd><dt class="hdlist1">Realm Default Client Scopes not linked with existing clients</dt><dd><p>During the migration, the list of built-in client scopes is added to each realm as well as list of <code>Realm Default Client Scopes</code>. However,
existing clients are NOT upgraded and new client scopes are NOT automatically added to them. Also all the protocol mappers and role
scope mappings are kept on existing clients. In the new version, when you create a new client, it automatically has Realm Default Client Scopes
attached to it and it does not have any protocol mappers attached to it. We did not change existing clients during migration as it
would be impossible to properly detect customizations, which you will have for protocol mappers of the clients, for example. If you want to
update existing clients (remove protocol mappers from them and link them with client scopes), you will need to do it manually.</p></dd><dt class="hdlist1">Consents need to be confirmed again</dt><dd><p>The client scopes change required the refactoring of consents. Consents now point to client scopes, not to roles or protocol mappers.
Because of this change, the previously confirmed persistent consents by users are not valid anymore and users need to confirm
the consent page again after the migration.</p></dd><dt class="hdlist1">Some configuration switches removed</dt><dd><p>The switch <code>Scope Param Required</code> was removed from Role Detail. The switches <code>Consent Required</code> and <code>Consent Text</code> were removed
from the Protocol Mapper details. Those switches were replaced by the Client Scope feature.</p></dd></dl></div>
<h3>New default client scopes</h3><div class="paragraph"><p>We have added new realm default client scopes <code>roles</code> and <code>web-origins</code>. These client scopes contain protocol
mappers to add the roles of the user and allowed web origins to the token. During migration, these client scopes should be
automatically added to all the OpenID Connect clients as default client scopes. Hence no setup should be required after database
migration is finished.</p></div>
<h4>Protocol mapper SPI addition</h4><div class="paragraph"><p>Related to this, there is a small addition in the (unsupported) Protocol Mappers SPI. You can be affected only if you
implemented a custom ProtocolMapper. There is a new <code>getPriority()</code> method on the ProtocolMapper interface. The method has the
default implementation set to return 0. If your protocol mapper implementation relies on the roles in the access token <code>realmAccess</code>
or <code>resourceAccess</code> properties, you may need to increase the priority of your mapper.</p></div>
<h4>Audience resolving</h4><div class="paragraph"><p>Audiences of all the clients, for which authenticated user has at least one client role in the token, are automatically added
to the <code>aud</code> claim in the access token now. On the other hand, an access token may not automatically contain the audience of the
frontend client, for which it was issued. Read the <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on_continuous_delivery/6/html-single/server_administration_guide/#_audience">Server Administration Guide</a> for more details.</p></div>
<h3>Upgrade to EAP 7.2</h3><div class="paragraph"><p>The Red Hat Single Sign-On server was upgraded to use EAP 7.2 as the underlying container. This does not directly involve any
specific Red Hat Single Sign-On server functionality, but there are few changes related to the migration, which worth mentioning.</p></div>
<div class="dlist"><dl><dt class="hdlist1">Dependency updates</dt><dd><p>The dependencies were updated to the versions used by EAP 7.2 server. For example, Infinispan is now 9.3.1.Final.</p></dd><dt class="hdlist1">Configuration changes</dt><dd><p>There are few configuration changes in the <code>standalone(-ha).xml</code> and <code>domain.xml</code> files. You should follow the <a href="#_install_new_version">Upgrading Red Hat Single Sign-On server</a>
section to handle the migration of configuration files automatically.</p></dd><dt class="hdlist1">Cross-Datacenter Replication changes</dt><dd><div class="ulist"><ul><li><p>You will need to upgrade JDG server to version 7.3.0. The older version may still work, but it is
not guaranteed as we don&#8217;t test it anymore.</p></li><li><p>There is a need to add <code>protocolVersion</code> property with the value <code>2.6</code> to the configuration of the <code>remote-store</code> element in the
Red Hat Single Sign-On configuration. This is required as there is a need to downgrade the version of HotRod protocol to be compatible
with the version used by JDG 7.3.0.</p></li></ul></div></dd></dl></div>
<h3>Hostname configuration</h3><div class="paragraph"><p>In previous versions it was recommended to use a filter to specify permitted hostnames. It is now possible to
set a fixed hostname which makes it easier to make sure the valid hostname is used and also allows internal
applications to invoke Red Hat Single Sign-On through an alternative URL, for example an internal IP address. It is
recommended that you switch to this approach in production.</p></div>
<h3>JavaScipt Adapter Promise</h3><div class="paragraph"><p>To use native JavaScript promise with the JavaScript adapter it is now required to set <code>promiseType</code> to <code>native</code> in the
init options.</p></div>
<div class="paragraph"><p>In the past if native promise was available a wrapper was returned that provided both the legacy Keycloak promise and
the native promise. This was causing issues as the error handler was not always set prior to the native error event, which
resulted in <code>Uncaught (in promise)</code> error.</p></div>
<h3>Microsoft Identity Provider updated to use the Microsoft Graph API</h3><div class="paragraph"><p>The Microsoft Identity Provider implementation in Red Hat Single Sign-On used to rely on the Live SDK
endpoints for authorization and obtaining the user profile. From November 2018 onwards, Microsoft is removing support
for the Live SDK API in favor of the new Microsoft Graph API. The Red Hat Single Sign-On identity provider has been updated
to use the new endpoints so if this integration is in use make sure you upgrade to the latest Red Hat Single Sign-On version.</p></div>
<div class="paragraph"><p>Legacy client applications registered under "Live SDK applications" won&#8217;t work with the Microsoft Graph endpoints
due to changes in the id format of the applications. If you run into an error saying that the application identifier
was not found in the directory, you will have to register the client application again in the
<a href="https://account.live.com/developers/applications/create">Microsoft Application Registration</a> portal to obtain a new application id.</p></div>
<h3>Google Identity Provider updated to use Google Sign-in authentication system</h3><div class="paragraph"><p>The Google Identity Provider implementation in Red Hat Single Sign-On used to rely on the Google+ API endpoints
endpoints for authorization and obtaining the user profile. From March 2019 onwards, Google is removing support
for the Google+ API in favor of the new Google Sign-in authentication system. The Red Hat Single Sign-On identity provider has been updated
to use the new endpoints so if this integration is in use make sure you upgrade to the latest Red Hat Single Sign-On version.</p></div>
<div class="paragraph"><p>If you run into an error saying that the application identifier was not found in the directory, you will have to register the client application again in the
<a href="https://console.developers.google.com/apis/credentials">Google API Console</a> portal to obtain a new application id and secret.</p></div>
<div class="paragraph"><p>It is possible that you will need to adjust custom mappers for non-standard claims that were provided by Google+ user
information endpoint and are provided under different name by Google Sign-in API. Please consult Google documentation
for the most up-to-date information on available claims.</p></div>
<h3>LinkedIn Social Broker Updated to Version 2 of LinkedIn APIs</h3><div class="paragraph"><p>Accordingly with LinkedIn, all developers need to migrate to version 2.0 of their APIs and OAuth 2.0. As such, we have updated
our LinkedIn Social Broker.</p></div>
<div class="paragraph"><p>Existing deployments using this broker may start experiencing errors when fetching user&#8217;s profile using version 2 of
LinkedIn APIs. This error may be related with the lack of permissions granted to the client application used to configure the broker
which may not be authorized to access the Profile API or request specific OAuth2 scopes during the authentication process.</p></div>
<div class="paragraph"><p>Even for newly created LinkedIn client applications, you need to make sure that the client is able to request the <code>r_liteprofile</code> and
<code>r_emailaddress</code> OAuth2 scopes, at least, as well that the client application can fetch current member&#8217;s profile from the <code><a href="https://api.linkedin.com/v2/me" class="bare">https://api.linkedin.com/v2/me</a></code> endpoint.</p></div>
<div class="paragraph"><p>Due to these privacy restrictions imposed by LinkedIn in regards to access to member&#8217;s information and the limited set of claims returned by the
current member&#8217;s Profile API, the LinkedIn Social Broker
is now using the member&#8217;s email address as the default username. That means that the <code>r_emailaddress</code> is always set when
sending authorization requests during the authentication.</p></div></section><section id="_rh_sso_7_2"><h2>RH-SSO 7.2</h2><div class="paragraph"><p>The following changes have occurred from RH-SSO 7.1 to RH-SSO 7.2.</p></div>
<h3>New Password Hashing algorithms</h3><div class="paragraph"><p>We have added two new password hashing algorithms (pbkdf2-sha256 and pbkdf2-sha512). New realms will use the pbkdf2-sha256
hashing algorithm with 27500 hashing iterations. Since pbkdf2-sha256 is slightly faster than pbkdf2 the iterations was
increased to 27500 from 20000.</p></div>
<div class="paragraph"><p>Existing realms are upgraded if the password policy contains the default value for the hashing algorithm (not specified) and
iteration (20000). If you have changed the hashing iterations, you need to manually change to pbkdf2-sha256 if you&#8217;d like
to use the more secure hashing algorithm.</p></div>
<h3>ID Token requires scope=openid</h3><div class="paragraph"><p>In RH-SSO 7.0, the ID Token was returned regardless if <code>scope=openid</code> query parameter was present or not in authorization
request. This is incorrect according to the OpenID Connect specification.</p></div>
<div class="paragraph"><p>In RH-SSO 7.1, we added this query parameter to adapters, but left the old behavior to accommodate migration.</p></div>
<div class="paragraph"><p>In RH-SSO 7.2, this behavior has changed and the <code>scope=openid</code> query parameter is now required to mark the request as an
OpenID Connect request. If this query parameter is omitted the ID Token will not be generated.</p></div>
<h3>Microsoft SQL Server requires extra dependency</h3><div class="paragraph"><p>Microsoft JDBC Driver 6.0 requires additional dependency added to the JDBC driver module. If you observe an
<code>NoClassDefFoundError</code> error when using Microsoft SQL Server please add the following dependency to your JDBC driver
<code>module.xml</code> file:</p></div>
<pre class="highlight listingblock"><code class="xml language-xml">&lt;module name="javax.xml.bind.api"/&gt;</code></pre>
<h3>Added session_state parameter to OpenID Connect Authentication Response</h3><div class="paragraph"><p>The OpenID Connect Session Management specification requires that the parameter <code>session_state</code> is present in the OpenID Connect Authentication Response.</p></div>
<div class="paragraph"><p>In RH-SSO 7.1, we did not have this parameter, but now Red Hat Single Sign-On adds this parameter by default, as required by the specification.</p></div>
<div class="paragraph"><p>However, some OpenID Connect / OAuth2 adapters, and especially older Red Hat Single Sign-On adapters (such as RH-SSO 7.1 and older), may have issues with this new parameter.</p></div>
<div class="paragraph"><p>For example, the parameter will be always present in the browser URL after successful authentication to the client application.
If you use RH-SSO 7.1 or a legacy OAuth2 / OpenID Connect adapter, it may be useful to disable adding the <code>session_state</code> parameter to the authentication response.
This can be done for the particular client in the Red Hat Single Sign-On admin console, in client details in the section with <code>OpenID Connect Compatibility Modes</code>,
described in <a href="#_compatibility_with_older_adapters">Compatibility with older adapters</a>. There is the <code>Exclude Session State From Authentication Response</code> switch,
which can be turned on to prevent adding the <code>session_state</code> parameter to the Authentication Response.</p></div>
<h3>Microsoft Identity Provider updated to use the Microsoft Graph API</h3><div class="paragraph"><p>The Microsoft Identity Provider implementation in Red Hat Single Sign-On up to version 7.2.4 relies on the Live SDK
endpoints for authorization and obtaining the user profile. From November 2018 onwards, Microsoft is removing support
for the Live SDK API in favor of the new Microsoft Graph API. The Red Hat Single Sign-On identity provider has been updated
to use the new endpoints so if this integration is in use make sure you upgrade to Red Hat Single Sign-On version 7.2.5 or later.</p></div>
<div class="paragraph"><p>Legacy client applications registered under "Live SDK applications" won&#8217;t work with the Microsoft Graph endpoints
due to changes in the id format of the applications. If you run into an error saying that the application identifier
was not found in the directory, you will have to register the client application again in the
<a href="https://account.live.com/developers/applications/create">Microsoft Application Registration</a> portal to obtain a new application id.</p></div>
<h3>Google Identity Provider updated to use Google Sign-in authentication system</h3><div class="paragraph"><p>The Google Identity Provider implementation in Red Hat Single Sign-On up to version 7.2.5 relies on the Google+ API endpoints
endpoints for authorization and obtaining the user profile. From March 2019 onwards, Google is removing support
for the Google+ API in favor of the new Google Sign-in authentication system. The Red Hat Single Sign-On identity provider has been updated
to use the new endpoints so if this integration is in use make sure you upgrade to Red Hat Single Sign-On version 7.2.6 or later.</p></div>
<div class="paragraph"><p>If you run into an error saying that the application identifier was not found in the directory, you will have to register the client application again in the
<a href="https://console.developers.google.com/apis/credentials">Google API Console</a> portal to obtain a new application id and secret.</p></div>
<div class="paragraph"><p>It is possible that you will need to adjust custom mappers for non-standard claims that were provided by Google+ user
information endpoint and are provided under different name by Google Sign-in API. Please consult Google documentation
for the most up-to-date information on available claims.</p></div>
<h3>LinkedIn Social Broker Updated to Version 2 of LinkedIn APIs</h3><div class="paragraph"><p>Accordingly with LinkedIn, all developers need to migrate to version 2.0 of their APIs and OAuth 2.0. As such, we have updated
our LinkedIn Social Broker so if this integration is in use make sure you upgrade to Red Hat Single Sign-On version 7.2.6 or later.</p></div>
<div class="paragraph"><p>Existing deployments using this broker may start experiencing errors when fetching user&#8217;s profile using version 2 of
LinkedIn APIs. This error may be related with the lack of permissions granted to the client application used to configure the broker
which may not be authorized to access the Profile API or request specific OAuth2 scopes during the authentication process.</p></div>
<div class="paragraph"><p>Even for newly created LinkedIn client applications, you need to make sure that the client is able to request the <code>r_liteprofile</code> and
<code>r_emailaddress</code> OAuth2 scopes, at least, as well that the client application can fetch current member&#8217;s profile from the <code><a href="https://api.linkedin.com/v2/me" class="bare">https://api.linkedin.com/v2/me</a></code> endpoint.</p></div>
<div class="paragraph"><p>Due to these privacy restrictions imposed by LinkedIn in regards to access to member&#8217;s information and the limited set of claims returned by the
current member&#8217;s Profile API, the LinkedIn Social Broker
is now using the member&#8217;s email address as the default username. That means that the <code>r_emailaddress</code> is always set when
sending authorization requests during the authentication.</p></div></section><section id="_rh_sso_7_1"><h2>RH-SSO 7.1</h2><div class="paragraph"><p>The following changes have occurred from RH-SSO 7.0 to RH-SSO 7.1.</p></div>
<h3>Realm Keys</h3><div class="paragraph"><p>For RH-SSO 7.0, only one set of keys could be associated with a realm. This meant that when changing the keys, all current cookies and tokens would be invalidated and all users would have to re-authenticate. For RH-SSO 7.1, support for multiple keys for one realm has been added. At any given time, one set of keys is the active set used for creating signatures, but there can be multiple keys used to verify signatures. This means that old cookies and tokens can be verified, then refreshed with the new signatures, allowing users to remain authenticated when keys are changed. There are also some changes to how keys are managed through the Admin Console and Admin REST API; for more details see <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on_continuous_delivery/6/html-single/server_administration_guide/#realm_keys">Realm Keys</a> in the Server Administration Guide.</p></div>
<div class="paragraph"><p>To allow seamless key rotation you must remove hard-coded keys from client adapters. The client adapters will automatically retrieve keys from the server as long as the realm key is not specified. Client adapters will also retrieve new keys automatically when keys are rotated.</p></div>
<h3>Client Redirect URI Matching</h3><div class="paragraph"><p>For RH-SSO 7.0, query parameters are ignored when matching valid redirect URIs for a client. For RH-SSO 7.1, query parameters are no longer ignored. If you need to include query parameters in the redirect URI you must specify the query parameters in the valid redirect URI for the client (for example, https://hostname/app/login?foo=bar) or use a wildcard (for example, https://hostname/app/login/*). Fragments are also no longer permitted in Valid Redirect URIs (that is, https://hostname/app#fragment).</p></div>
<h3>Automatically Redirect to Identity Provider</h3><div class="paragraph"><p>For RH-SSO 7.1, identity providers cannot be set as the default authentication provider. To automatically redirect to an identity provider for RH-SSO 7.1, you must now configure the identity provider redirector. For more information see <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on_continuous_delivery/6/html-single/server_administration_guide/#default_identity_provider">Default Identity Provider</a> in the <em>Server Administration Guide</em>. If you previously had an identity provider with the default authentication provider option set, this value is automatically used as the value for the identity provider redirector when the server is upgraded to RH-SSO 7.1.</p></div>
<h3>Admin REST API</h3><div class="paragraph"><p>For RH-SSO 7.0, paginated endpoints in the Admin REST API return all results if the maxResults query parameter was not specified. This could cause issues with a temporary high load and requests timing out when a large number of results were returned (for example, users). For RH-SSO 7.1, a maximum of 100 results are returned if a value for maxResults is not specified. You can return all results by specifying maxResults as -1.</p></div>
<h3>Server Configuration</h3><div class="paragraph"><p>For RH-SSO 7.0, server configuration is split between the keycloak-server.json file and the standalone/domain.xml or domain.xml file. For RH-SSO 7.1, the keycloak-server.json file has been removed and all server configuration is done through the standalone.xml or domain.xml file. The upgrading procedure for RH-SSO 7.1 automatically migrates the server configuration from the keycloak-server.json file to the standalone.xml or domain.xml file.</p></div>
<h3>Key Encryption Algorithm in SAML Assertions</h3><div class="paragraph"><p>For RH-SSO 7.1, keys in SAML assertions and documents are now encrypted using the RSA-OAEP encryption scheme. To use encrypted assertions, ensure your service providers support this encryption scheme. In the event that you have service providers that do not support RSA-OAEP, RH-SSO can be configured to use the legacy RSA-v1.5 encryption scheme by starting the server with the system property "keycloak.saml.key_trans.rsa_v1.5" set to true. If you do this, you should upgrade your service providers as soon as possible to be able to revert to the more secure RSA-OAEP encryption scheme.</p></div></section></section>
<section><section id="_upgrading"><h2>Upgrading Red Hat Single Sign-On Server</h2><div class="paragraph"><p>The upgrade process for the Red Hat Single Sign-On server is different if you are upgrading to a different
minor release or not.</p></div><div class="paragraph"><p>If you are upgrading to a new minor release, for example from 7.0.0 to 7.1.0, follow the steps in <a href="#_upgrading_minor">Minor Upgrades</a>.</p></div><div class="paragraph"><p>If you are upgrading to a new micro release, for example from 7.1.0 to 7.1.1, follow the steps in <a href="#_upgrading_micro">Micro Upgrades</a>.</p></div></section><section id="_upgrading_minor"><h2>Minor Upgrades</h2><h3>Preparing for Upgrading</h3><div class="paragraph"><p>Before you upgrade, be aware of the order in which you need to perform the upgrade steps. Also note potential issues
that can occur within the upgrade process. In general, you must upgrade Red Hat Single Sign-On server first, and then upgrade
the adapters.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Prior to applying the upgrade, handle any open transactions and delete the data/tx-object-store/ transaction directory.</p></li><li><p>Back up the old installation (configuration, themes, and so on).</p></li><li><p>Back up the database. For detailed information on how to back up the database, see the documentation for the relational
database you are using.</p></li><li><p>Upgrade Red Hat Single Sign-On server.</p><div class="ulist"><ul><li><p>Testing the upgrade in a non-production environment first, to prevent any installation issues from being exposed in
production, is a best practice.</p></li><li><p>Be aware that after the upgrade the database will no longer be compatible with the old server</p></li><li><p>Ensure the upgraded server is functional before upgrading adapters in production.</p></li></ul></div></li><li><p>If you need to revert the upgrade, first restore the old installation, and then restore the database from the backup copy.</p></li><li><p>Upgrade the adapters.</p></li></ol></div>
<h3>Upgrading Red Hat Single Sign-On server</h3><div class="paragraph"><p>It is important that you upgrade Red Hat Single Sign-On server before upgrading the adapters.</p></div>
<div class="paragraph"><p>To upgrade Red Hat Single Sign-On server, complete the following steps:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Prior to applying the upgrade, handle any open transactions and delete the data/tx-object-store/ transaction directory.</p></li><li><p>Download the new server archive</p></li><li><p>Move the downloaded archive to the desired location.</p></li><li><p>Extract the archive. This step installs a clean instance of the latest Red Hat Single Sign-On release.</p></li><li><p>For standalone installations, copy the RHSSO_HOME/standalone/ directory from the previous installation over the
directory in the new installation.</p><div class="paragraph"><p>For domain installations, copy the RHSSO_HOME/domain/ directory from the previous installation over the directory
in the new installation.</p></div>
<div class="paragraph"><p>For domain installations, create the empty directory RHSSO_HOME/domain/deployments.</p></div>
<div class="paragraph"><p>NOTE:
Files in the bin directory should not be overwritten by the files from previous versions. Changes should be made manually.</p></div></li><li><p>Copy any custom modules that have been added to the modules directory.</p></li><li><p>Run the applicable upgrade script below.</p></li></ol></div>
<div class="paragraph"><p>To upgrade Red Hat Single Sign-On server RPM distribution, complete the following steps:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Prior to applying the upgrade, handle any open transactions and delete the /var/opt/rh/rh-sso7/lib/keycloak/standalone/data/tx-object-store/ transaction directory.</p></li><li><p>Make sure you have subscribed to proper repositories containing JBOSS EAP and Red Hat Single Sign-On.</p><div class="literalblock"><div class="content"><pre>subscription-manager repos --enable=jb-eap-7.1-for-rhel-7-server-rpms
subscription-manager repos --enable=rh-sso-7.2-for-rhel-7-server-rpms</pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><div class="paragraph"><p>To disable older product repositories for both JBOSS EAP and Red Hat Single Sign-On use:</p></div>
<div class="literalblock"><div class="content"><pre>subscription-manager repos --disable=&lt;OLDER_PRODUCT_REPO&gt;</pre></div></div>
<div class="paragraph"><p>To check the repositories use:</p></div>
<div class="literalblock"><div class="content"><pre>yum repolist</pre></div></div></td></tr></table></div></li><li><p>The RPM upgrade process will not replace any of your modified configuration files, and will instead create .rpmnew files for the default configuration of the new Red Hat Single Sign-On version.</p><div class="paragraph"><p>To activate any new features in the new release, such as new subsystems, you must manually merge each .rpmnew file into your existing configuration files</p></div></li><li><p>Copy any custom modules that have been added to the modules directory.</p></li><li><p>Run the applicable upgrade script as described below.</p><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><div class="paragraph"><p>Red Hat Single Sign-On RPM server distribution is using</p></div>
<div class="paragraph"><p><code>RHSSO_HOME=/opt/rh/rh-sso7/root/usr/share/keycloak</code></p></div>
<div class="paragraph"><p>Use it when calling migration scripts below.</p></div></td></tr></table></div></li></ol></div>
<h4>Running the Standalone Mode Upgrade Script</h4><div class="paragraph"><p>To run the upgrade script for standalone mode, complete the following steps:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>If you are using a different configuration file than the default one, edit the migration script to specify the new file name.</p></li><li><p>Stop the server.</p></li><li><p>Run the upgrade script:</p><div class="literalblock"><div class="content"><pre>bin/jboss-cli.sh --file=bin/migrate-standalone.cli</pre></div></div></li></ol></div>
<h4>Running the Standalone-High Availability Mode Upgrade Script</h4><div class="paragraph"><p>For standalone-high availability (HA) mode, all instances must be upgraded at the same time.</p></div>
<div class="paragraph"><p>To run the upgrade script for standalone-HA mode, complete the following steps:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>If you are using a different configuration file than the default one, edit the migration script to specify the new file name.</p></li><li><p>Stop the server.</p></li><li><p>Run the upgrade script:</p><div class="literalblock"><div class="content"><pre>bin/jboss-cli.sh --file=bin/migrate-standalone-ha.cli</pre></div></div></li></ol></div>
<h4>Running the Domain Mode Upgrade Script</h4><div class="paragraph"><p>For domain mode, all instances must be upgraded at the same time.</p></div>
<div class="paragraph"><p>To run the upgrade script for domain mode, complete the following steps:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>If you have changed the profile name, you must edit the upgrade script to change a variable near the beginning of the script.</p></li><li><p>Edit the domain script to include the location of the keycloak-server.json file.</p></li><li><p>Stop the server.</p></li><li><p>Run the upgrade script on the domain controller only:</p><div class="literalblock"><div class="content"><pre>bin/jboss-cli.sh --file=bin/migrate-domain.cli</pre></div></div></li></ol></div>
<h4>Running the Domain-clustered Mode Upgrade Script</h4><div class="paragraph"><p>For domain-clustered mode, all instances must be upgraded at the same time.</p></div>
<div class="paragraph"><p>To run the upgrade script for domain-clustered mode, complete the following steps:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>If you have changed the profile name, you must edit the upgrade script to change a variable near the beginning of the script.</p></li><li><p>Edit the domain-clustered script to include the location of the keycloak-server.json file.</p></li><li><p>Stop the server.</p></li><li><p>Run the upgrade script on the domain controller only:</p><div class="literalblock"><div class="content"><pre>bin/jboss-cli.sh --file=bin/migrate-domain-clustered.cli</pre></div></div></li></ol></div>
<h3>Migrating the Database</h3><div class="paragraph"><p>Red Hat Single Sign-On can automatically migrate the database schema, or you can choose to do it manually. By default the
database is automatically migrated when you start the new installation for the first time.</p></div>
<h4>Automatic Relational Database Migration</h4><div class="paragraph"><p>To enable automatic upgrading of the database schema, set the migrationStrategy property value to "update" for the
default connectionsJpa provider:</p></div>
<pre class="highlight listingblock"><code class="xml language-xml"> &lt;spi name="connectionsJpa"&gt;
    &lt;provider name="default" enabled="true"&gt;
        &lt;properties&gt;
            ...
            &lt;property name="migrationStrategy" value="update"/&gt;
        &lt;/properties&gt;
    &lt;/provider&gt;
&lt;/spi&gt;</code></pre>
<div class="paragraph"><p>Or run this CLI command:</p></div>
<pre class="highlight listingblock"><code class="bash language-bash">/subsystem=keycloak-server/spi=connectionsJpa/provider=default/:map-put(name=properties,key=migrationStrategy,value=update)</code></pre>
<div class="paragraph"><p>When you start the server with this setting your database is automatically migrated if the database schema has changed
in the new version.</p></div>
<h4>Manual Relational Database Migration</h4><div class="paragraph"><p>To enable manual upgrading of the database schema, set the migrationStrategy property value to "manual" for the default
connectionsJpa provider:</p></div>
<pre class="highlight listingblock"><code class="xml language-xml"> &lt;spi name="connectionsJpa"&gt;
    &lt;provider name="default" enabled="true"&gt;
        &lt;properties&gt;
            ...
            &lt;property name="migrationStrategy" value="manual"/&gt;
        &lt;/properties&gt;
    &lt;/provider&gt;
&lt;/spi&gt;</code></pre>
<div class="paragraph"><p>Or run this CLI command:</p></div>
<pre class="highlight listingblock"><code class="bash language-bash">/subsystem=keycloak-server/spi=connectionsJpa/provider=default/:map-put(name=properties,key=migrationStrategy,value=manual)</code></pre>
<div class="paragraph"><p>When you start the server with this configuration it checks if the database needs to be migrated. The required changes
are written to an SQL file that you can review and manually run against the database. For further details on how to
apply this file to the database, see the documentation for the relational database you&#8217;re using. After the changes have
been written to the file, the server exits.</p></div>
<h3>Migrating Themes</h3><div class="paragraph"><p>If you have created any custom themes they must be migrated to the new server. Any changes to the built-in themes might
need to be reflected in your custom themes, depending on which aspects you have customized.</p></div>
<div class="paragraph"><p>You must copy your custom themes from the old server "themes" directory to the new server "themes" directory.
After that you need to review the changes below and consider if the changes need to be applied to your custom theme.</p></div>
<div class="paragraph"><p>In summary:</p></div>
<div class="ulist"><ul><li><p>If you have customized any of the changed templates listed below you need to compare the template from the base theme
to see if there are changes you need to apply.</p></li><li><p>If you have customized any of the styles and are extending the Red Hat Single Sign-On themes you need to review the changes to
the styles. If you are extending the base theme you can skip this step.</p></li><li><p>If you have customized messages you might need to change the key or value or to add additional messages.</p></li></ul></div>
<div class="paragraph"><p>Each step is described in more detail below the list of changes.</p></div>
<h4>Theme changes RH-SSO 7.3</h4><div class="paragraph"><p><strong>Templates</strong></p></div>
<div class="ulist"><ul><li><p>Account: account.ftl</p></li><li><p>Account: applications.ftl</p></li><li><p>Account: resource-detail.ftl (new)</p></li><li><p>Account: resources.ftl (new)</p></li><li><p>Account: template.ftl</p></li><li><p>Account: totp.ftl</p></li><li><p>Email-html: email-test.ftl</p></li><li><p>Email-html: email-verification-with-code.ftl (new)</p></li><li><p>Email-html: email-verification.ftl</p></li><li><p>Email-html: event-login_error.ftl</p></li><li><p>Email-html: event-removed_totp.ftl</p></li><li><p>Email-html: event-update_password.ftl</p></li><li><p>Email-html: event-update_totp.ftl</p></li><li><p>Email-html: executeActions.ftl</p></li><li><p>Email-html: identity-provider-link.ftl</p></li><li><p>Email-html: password-reset.ftl</p></li><li><p>Email-text: email-verification-with-code.ftl (new)</p></li><li><p>Email-text: email-verification.ftl</p></li><li><p>Email-text: executeActions.ftl</p></li><li><p>Email-text: identity-provider-link.ftl</p></li><li><p>Email-text: password-reset.ftl</p></li><li><p>Login: cli_splash.ftl (new)</p></li><li><p>Login: code.ftl</p></li><li><p>Login: error.ftl</p></li><li><p>Login: info.ftl</p></li><li><p>Login: login-config-totp-text.ftl (new)</p></li><li><p>Login: login-config-totp.ftl</p></li><li><p>Login: login-idp-link-confirm.ftl</p></li><li><p>Login: login-idp-link-email.ftl</p></li><li><p>Login: login-oauth-grant.ftl</p></li><li><p>Login: login-page-expired.ftl</p></li><li><p>Login: login-reset-password.ftl</p></li><li><p>Login: login-totp.ftl</p></li><li><p>Login: login-update-password.ftl</p></li><li><p>Login: login-update-profile.ftl</p></li><li><p>Login: login-verify-email-code-text.ftl (new)</p></li><li><p>Login: login-verify-email.ftl</p></li><li><p>Login: login-x509-info.ftl</p></li><li><p>Login: login.ftl</p></li><li><p>Login: register.ftl</p></li><li><p>Login: template.ftl</p></li><li><p>Login: terms.ftl</p></li><li><p>Welcome: index.ftl (new)</p></li></ul></div>
<div class="paragraph"><p><strong>Messages</strong></p></div>
<div class="ulist"><ul><li><p>Account: messages_en.properties</p></li><li><p>Admin: admin-messages_en.properties</p></li><li><p>Email: messages_en.properties</p></li><li><p>Login: messages_en.properties</p></li></ul></div>
<div class="paragraph"><p><strong>Styles</strong></p></div>
<div class="ulist"><ul><li><p>Login: login-rhsso.css (new)</p></li><li><p>Welcome: welcome-rhsso.css</p></li></ul></div>
<h4>Theme changes RH-SSO 7.2</h4><div class="paragraph"><p><strong>Templates</strong></p></div>
<div class="ulist"><ul><li><p>Account: account.ftl</p></li><li><p>Account: applications.ftl</p></li><li><p>Account: federatedIdentity.ftl</p></li><li><p>Account: password.ftl</p></li><li><p>Account: sessions.ftl</p></li><li><p>Account: template.ftl</p></li><li><p>Account: totp.ftl</p></li><li><p>Admin: index.ftl</p></li><li><p>Email: email-test.ftl (new)</p></li><li><p>Email: email-verification.ftl</p></li><li><p>Email: event-login_error.ftl</p></li><li><p>Email: event-removed_totp.ftl</p></li><li><p>Email: event-update_password.ftl</p></li><li><p>Email: event-update_totp.ftl</p></li><li><p>Email: executeActions.ftl</p></li><li><p>Email: identity-provider-link.ftl</p></li><li><p>Email: password-reset.ftl</p></li><li><p>Login: bypass_kerberos.ftl (removed)</p></li><li><p>Login: error.ftl</p></li><li><p>Login: info.ftl</p></li><li><p>Login: login-config-totp.ftl</p></li><li><p>Login: login-idp-link-email.ftl</p></li><li><p>Login: login-oauth-grant.ftl</p></li><li><p>Login: login-page-expired.ftl (new)</p></li><li><p>Login: login-reset-password.ftl</p></li><li><p>Login: login-totp.ftl</p></li><li><p>Login: login-update-password.ftl</p></li><li><p>Login: login-update-profile.ftl</p></li><li><p>Login: login-verify-email.ftl</p></li><li><p>Login: login-x509-info.ftl (new)</p></li><li><p>Login: login.ftl (new)</p></li><li><p>Login: register.ftl (new)</p></li><li><p>Login: template.ftl (new)</p></li><li><p>Login: terms.ftl (new)</p></li></ul></div>
<div class="paragraph"><p><strong>Messages</strong></p></div>
<div class="ulist"><ul><li><p>Account: messages_en.properties</p></li><li><p>Admin: admin-messages_en.properties</p></li><li><p>Admin: messages_en.properties</p></li><li><p>Email: messages_en.properties</p></li><li><p>Login: messages_en.properties</p></li></ul></div>
<div class="paragraph"><p><strong>Styles</strong></p></div>
<div class="ulist"><ul><li><p>Account: account.css</p></li><li><p>Login: login.css</p></li></ul></div>
<h4>Theme changes RH-SSO 7.1</h4><div class="paragraph"><p><strong>Templates</strong></p></div>
<div class="ulist"><ul><li><p>Account: account.ftl</p></li><li><p>Account: federatedIdentity.ftl</p></li><li><p>Account: totp.ftl</p></li><li><p>Login: info.ftl</p></li><li><p>Login: login-config-totp.ftl</p></li><li><p>Login: login-reset-password.ftl</p></li><li><p>Login: login.ftl</p></li></ul></div>
<div class="paragraph"><p><strong>Messages</strong></p></div>
<div class="ulist"><ul><li><p>Account: editAccountHtmlTtile renamed to editAccountHtmlTitle</p></li><li><p>Account: role_uma_authorization added</p></li><li><p>Login: loginTotpStep1 value changed</p></li><li><p>Login: invalidPasswordGenericMessage added</p></li><li><p>Login: invlidRequesterMessage renamed to invalidRequesterMessage</p></li><li><p>Login: clientDisabledMessage added</p></li></ul></div>
<div class="paragraph"><p><strong>Styles</strong></p></div>
<div class="ulist"><ul><li><p>Account: account.css</p></li><li><p>Login: login.css</p></li></ul></div>
<h4>Migrating Templates</h4><div class="paragraph"><p>If you have customized any of the templates you need to carefully review the changes that have been made to the templates
to decide if you need to apply these changes to your customized templates. Most likely you will need to apply the same
changes to your customized templates. If you have not customized any of the listed templates you can skip this section.</p></div>
<div class="paragraph"><p>A best practice is to use a diff tool to compare the templates to see what changes you might need to make to your
customized template. If you have only made minor changes it is simpler to compare the updated template to your
customized template. However, if you have made many changes it might be easier to compare the new template to your
customized old template, as this will show you what changes you need to make.</p></div>
<div class="paragraph"><p>The following screenshot compares the info.ftl template from the Login theme and an example custom theme:</p></div>
<div class="paragraph"><div class="title">Comparison of the updated version of a Login theme template with an example custom Login theme template</div><p><span class="image"><img src="images/theme-migration-meld-info-1.png" alt="theme migration meld info 1"></span></p></div>
<div class="paragraph"><p>From this comparison it is easy to identify that the first change ("Hello world!!") was a customization, while the
second change ("if pageRedirectUri") is a change to the base theme. By copying the second change to your custom template,
you have successfully updated your customized template.</p></div>
<div class="paragraph"><p>For the alternative approach the following screenshot compares the info.ftl template from the old installation with
the updated info.ftl template from the new installation:</p></div>
<div class="paragraph"><div class="title">Comparison of an example custom Login theme template with the updated version of the Login theme template</div><p><span class="image"><img src="images/theme-migration-meld-info-2.png" alt="theme migration meld info 2"></span></p></div>
<div class="paragraph"><p>From this comparison it is easy to identify what has been changed in the base template. You will then manually have to
make the same changes to your modified template. Since this approach is not as simple as the first approach, only use
this approach if the first one is not feasible.</p></div>
<h4>Migrating Messages</h4><div class="paragraph"><p>If you have added support for another language, you need to apply all the changes listed above. If you have not added
support for another language, you might not need to change anything; you only have to make changes if you have changed
an affected message in your theme.</p></div>
<div class="paragraph"><p>For added values, review the value of the message in the base theme to determine if you need to customize that message.</p></div>
<div class="paragraph"><p>For renamed keys, rename the key in your custom theme.</p></div>
<div class="paragraph"><p>For changed values, check the value in the base theme to determine if you need to make changes to your custom theme.</p></div>
<h4>Migrating Styles</h4><div class="paragraph"><p>If you are inheriting styles from the keycloak or rh-sso themes you might need to update your custom styles to reflect
changes made to the styles from the built-in themes.</p></div>
<div class="paragraph"><p>A best practice is to use a diff tool to compare the changes to stylesheets between the old server installation and the
new server installation.</p></div>
<div class="paragraph"><p>For example, using the diff command:</p></div>
<pre class="highlight listingblock"><code class="bash language-bash">$ diff RHSSO_HOME_OLD/themes/keycloak/login/resources/css/login.css \
RHSSO_HOME_NEW/themes/keycloak/login/resources/css/login.css</code></pre>
<div class="paragraph"><p>Review the changes and determine if they affect your custom styling.</p></div></section><section id="_upgrading_micro"><h2>Micro Upgrades</h2><h3>Patching a ZIP/Installer Installation</h3><div class="paragraph"><p>Patches for a ZIP installation of RH-SSO are available to download from the
<a href="https://access.redhat.com/">Red Hat Customer Portal</a>.</p></div>
<div class="paragraph"><p>For multiple RH-SSO hosts in a managed domain environment, individual hosts can be patched from your RH-SSO domain controller.</p></div>
<div class="paragraph"><p>In addition to applying a patch, you can also roll back the application of a patch.</p></div>
<h4>Important Notes on ZIP Installation Patching</h4><div class="ulist"><ul><li><p>If you apply a patch that updates a module, the new patched JARs that are used at runtime are stored in <code>RHSSO_HOME/modules/system/layers/base/.overlays/<em>PATCH_ID</em>/<em>MODULE</em></code>. The original unpatched files are left in <code>RHSSO_HOME/modules/system/layers/base/<em>MODULE</em></code>, but these JARs are <strong>not</strong> used at runtime.</p></li><li><p>In order to significantly decrease the size of cumulative patch releases for RH-SSO 7 you cannot perform a partial roll back of a cumulative patch. For a patch that has been applied, you will only be able to roll back the whole patch.</p><div class="paragraph"><p>For example, if you apply CP03 to RH-SSO 7.0.0, you will not be able to roll back to CP01 or CP02. If you would like the ability to roll back to each cumulative patch release, each cumulative patch must be applied separately in the order they were released.</p></div></li></ul></div>
<h4>Applying a Patch</h4><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">RH-SSO servers that have been installed using the RPM method cannot be updated using these instructions. See the <a href="#rpm-patching">RPM instructions for applying a patch</a> instead.</td></tr></table></div>
<div class="paragraph"><p>You can apply downloaded patches to a RH-SSO server using either the <a href="#zip_patching_management_cli">management CLI</a> or the <a href="#zip_patching_management_console">management console</a>.</p></div>
<div class="olist arabic" id="zip_patching_management_cli"><div class="title">Applying a Patch to RH-SSO Using the Management CLI</div><ol class="arabic"><li><p>Download the patch file from the Red Hat Customer Portal at <a href="https://access.redhat.com/downloads/" class="bare">https://access.redhat.com/downloads/</a>.</p></li><li><p>From the <a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/configuration_guide/#management_cli_overview">management CLI</a>, apply the patch using the following command, including the appropriate path to the patch file:</p><pre class="highlight nowrap listingblock"><code>patch apply /path/to/downloaded-patch.zip</code></pre>
<div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><div class="paragraph"><p>To patch another RH-SSO host in a managed domain, you can specify the RH-SSO host name using the <code>--host=</code> argument. For example:</p></div>
<pre class="highlight nowrap listingblock"><code>patch apply /path/to/downloaded-patch.zip --host=my-host</code></pre></td></tr></table></div>
<div class="paragraph"><p>The patch tool will warn if there are any conflicts in attempting to apply the patch. If there are conflicts, enter <code>patch --help</code> for the available arguments to re-run the command with an argument specifying how to resolve the conflicts.</p></div></li><li><p>Restart the RH-SSO server for the patch to take effect:</p><pre class="highlight nowrap listingblock"><code>shutdown --restart=true</code></pre></li></ol></div>
<div class="olist arabic" id="zip_patching_management_console"><div class="title">Applying a Patch to RH-SSO Using the Management Console</div><ol class="arabic"><li><p>Download the patch file from the Red Hat Customer Portal at <a href="https://access.redhat.com/downloads/" class="bare">https://access.redhat.com/downloads/</a>.</p></li><li><p>Open the <a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/configuration_guide/#management_console_overview">management console</a> and navigate to the <strong>Patch Management</strong> view.</p><div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>For a standalone server, click the <strong>Patching</strong> tab.</p><div class="paragraph"><div class="title">The Patch Management Screen for a Standalone Server</div><p><span class="image"><img src="images/patching-standalone-tab.png" alt="The Patch Management Screen for a Standalone Server"></span></p></div></li><li><p>For a server in a managed domain, click the <strong>Patching</strong> tab, then select the host that you want to patch from the table, and click <strong>View</strong>.</p><div class="paragraph"><div class="title">The Patch Management Screen for a Managed Domain</div><p><span class="image"><img src="images/patching-domain-tab.png" alt="The Patch Management Screen for a Managed Domain"></span></p></div></li></ol></div></li><li><p>Click <strong>Apply a New Patch</strong>.</p><div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>If you are patching a managed domain host, on the next screen select whether to shutdown the servers on the host, and click <strong>Next</strong>.</p></li></ol></div></li><li><p>Click the <strong>Browse</strong> button, select the downloaded patch you want to apply, and then click <strong>Next</strong>.</p><div class="paragraph"><div class="title">Apply Patch Screen</div><p><span class="image"><img src="images/patching-select-patch.png" alt="Apply Patch Screen"></span>
.. If there are any conflicts in attempting to apply the patch, a warning will be displayed. Click <strong>View error details</strong> to see the detail of the conflicts. If there is a conflict, you can either cancel the operation, or select the <strong>Override all conflicts</strong> check box and click <strong>Next</strong>. Overriding conflicts will result in the content of the patch overriding any user modifications.</p></div></li><li><p>After the patch has been successfully applied, select whether to restart RH-SSO now for the patch to take effect, and click <strong>Finish</strong>.</p></li></ol></div>
<h4>Rolling Back a Patch</h4><div class="paragraph"><p>You can roll back a previously applied RH-SSO patch using either the <a href="#zip_rollback_management_cli">management CLI</a> or the <a href="#zip_rollback_management_console">management console</a>.</p></div>
<div class="admonitionblock important"><table><tr><td class="icon"><div class="title">Important</div></td><td class="content">Rolling back a patch using the patch management system is not intended as a general uninstall functionality. It is only intended to be used immediately after the application of a patch that had undesirable effects.</td></tr></table></div>
<div class="ulist"><div class="title">Prerequisites</div><ul><li><p>A patch that was previously applied.</p></li></ul></div>
<div class="admonitionblock warning"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content"><div class="paragraph"><p>When following either procedure, use caution when specifying the value of the <code>Reset Configuration</code> option:</p></div>
<div class="paragraph"><p>If set to <code>TRUE</code>, the patch rollback process will also roll back the RH-SSO server configuration files to their pre-patch state. Any changes that were made to the RH-SSO server configuration files after the patch was applied will be lost.</p></div>
<div class="paragraph"><p>If set to <code>FALSE</code>, the server configuration files will not be rolled back. In this situation, it is possible that the server will not start after the rollback, as the patch may have altered configurations, such as namespaces, which may no longer be valid and will have to be fixed manually.</p></div></td></tr></table></div>
<div class="olist arabic" id="zip_rollback_management_cli"><div class="title">Rolling Back a Patch Using the Management CLI</div><ol class="arabic"><li><p>From the management CLI, use the <code>patch history</code> command to find the ID of the patch that you want to roll back.</p><div class="openblock"><div class="content"><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">If you are using a managed domain, you must add the <code>--host=<em>HOSTNAME</em></code> argument to the commands in this procedure to specify the RH-SSO host.</td></tr></table></div></div></div></li><li><p>Roll back the patch with the appropriate patch ID from the previous step.</p><pre class="highlight nowrap listingblock"><code>patch rollback --patch-id=PATCH_ID --reset-configuration=TRUE</code></pre>
<div class="paragraph"><p>The patch tool will warn if there are any conflicts in attempting to roll back the patch. If there are conflicts, enter <code>patch --help</code> for the available arguments to re-run the command with an argument specifying how to resolve the conflicts.</p></div></li><li><p>Restart the RH-SSO server for the patch roll back to take effect:</p><pre class="highlight nowrap listingblock"><code>shutdown --restart=true</code></pre></li></ol></div>
<div class="olist arabic" id="zip_rollback_management_console"><div class="title">Rolling Back a Patch Using the Management Console</div><ol class="arabic"><li><p>Open the management console and navigate to the <strong>Patch Management</strong> view.</p><div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>For a standalone server, click the <strong>Patching</strong> tab.</p></li><li><p>For a server in a managed domain, click the <strong>Patching</strong> tab, then select the host that you want to patch from the table, and click <strong>View</strong>.</p></li></ol></div></li><li><p>Select the patch that you want to rollback from those listed in the table, then click <strong>Rollback</strong>.</p><div class="paragraph"><div class="title">Recent Patch History Screen</div><p><span class="image"><img src="images/patching-rollback-table.png" alt="Recent Patch History Screen"></span>
.. If you are rolling back a patch on a managed domain host, on the next screen select whether to shutdown the servers on the host, and click <strong>Next</strong>.</p></div></li><li><p>Choose your options for the rollback process, then click <strong>Next</strong>.</p><div class="paragraph"><div class="title">Patch Rollback Options</div><p><span class="image"><img src="images/patching-rollback-options.png" alt="Patch Rollback Options"></span></p></div></li><li><p>Confirm the options and the patch to be rolled back, then click <strong>Next</strong>.</p><div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>If there are any conflicts in attempting to rollback the patch and the <strong>Override all</strong> option was not selected, a warning will be displayed. Click <strong>View error details</strong> to see the detail of the conflicts. If there is a conflict, you can either cancel the operation, or click <strong>Choose Options</strong> and try the operation again with the <strong>Override all</strong> check box selected. Overriding conflicts will result in the rollback operation overriding any user modifications.</p></li></ol></div></li><li><p>After the patch has been successfully rolled back, select whether to restart the RH-SSO server now for the changes to take effect, and click <strong>Finish</strong>.</p></li></ol></div>
<h4>Clearing Patch History</h4><div class="paragraph"><p>When patches are applied to a RH-SSO server, the content and history of the patches are preserved for use in rollback operations. If multiple cumulative patches are applied, the patch history may use a significant amount of disk space.</p></div>
<div class="paragraph"><p>You can use the following management CLI command to remove all older patches that are not currently in use. When using this command, only the latest cumulative patch is preserved along with the GA release. This is only useful for freeing space if multiple cumulative patches have previously been applied.</p></div>
<pre class="highlight nowrap listingblock"><code>/core-service=patching:ageout-history</code></pre>
<div class="admonitionblock important"><table><tr><td class="icon"><div class="title">Important</div></td><td class="content">If you clear the patch history, you will not be able to roll back a previously applied patch.</td></tr></table></div>
<h3>Patching an RPM Installation</h3><div class="ulist"><div class="title">Prerequisites</div><ul><li><p>Ensure that the base operating system is up to date, and is subscribed and enabled to get updates from the standard Red Hat Enterprise Linux repositories.</p></li><li><p>Ensure that you are subscribed to the relevant RH-SSO repository for the update.</p></li><li><p>Back up all configuration files, deployments, and user data.</p></li></ul></div>
<div class="admonitionblock important"><table><tr><td class="icon"><div class="title">Important</div></td><td class="content"><div class="paragraph"><p>For a managed domain, the RH-SSO domain controller should be updated first.</p></div></td></tr></table></div>
<div class="paragraph"><p>To install a RH-SSO patch via RPM from your subscribed repository, update your Red Hat Enterprise Linux system using the following command:</p></div>
<pre class="highlight nowrap listingblock"><code class="bash language-bash">yum update</code></pre>
<h3>Patching a local Maven installation</h3><div class="paragraph"><p>If you have installed the RH-SSO Client Adapters Maven Repository using a ZIP file downloaded from the <a href="https://access.redhat.com/">Red Hat Customer Portal</a>, it may also need to be patched.</p></div>
<div class="paragraph"><p>The RH-SSO Client Adapters Maven Repository is available online or as a downloaded ZIP file. If you use the publicly hosted online Maven repository, updates are automatically applied, and no action is required to update it. However, if you installed the Maven repository locally using the ZIP file, you are responsible for applying updates to the repository.</p></div>
<div class="paragraph"><p>Whenever a cumulative patch is released for RH-SSO, a corresponding patch is provided for the RH-SSO Client Adapters Maven Repository. This patch is available in the form of an incremental ZIP file that is unzipped into the existing local repository. It does not overwrite or remove any existing files, so there is no rollback requirement.</p></div>
<div class="paragraph"><p>Use the following procedure to apply updates to your locally installed RH-SSO Client Adapters Maven Repository.</p></div>
<h4>Prerequisites</h4><div class="ulist"><ul><li><p>Valid access and subscription to the Red Hat Customer Portal.</p></li><li><p>The RH-SSO Client Adapters Maven Repository, previously downloaded and installed locally.</p></li></ul></div>
<h4>Update a locally installed RH-SSO Client Adapters Maven Repository</h4><div class="olist arabic"><ol class="arabic"><li><p>Open a browser and log into the <a href="https://access.redhat.com/">Red Hat Customer Portal</a>.</p></li><li><p>Select <strong>Downloads</strong> from the menu at the top of the page.</p></li><li><p>Select <code>Red Hat Single Sign-On</code> from the list.</p></li><li><p>Select the correct version of Red Hat Single Sign-On from the Version drop-down menu, then select the <strong>Patches</strong> tab.</p></li><li><p>Find <code>Red Hat Single Sign-On 7.x.y Client Adapters Incremental Maven Repository</code> from the list, where <code>x.y</code> match the cumulative patch number you want to update to. Select <strong>Download</strong>.</p></li><li><p>Locate the path to your RH-SSO Client Adapters Maven Repository. This is referred to in the commands below as <code>RH-SSO_MAVEN_REPOSITORY_PATH</code>. Unzip the downloaded Maven patch file directly into this directory, like this:</p><div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>For Red Hat Enterprise Linux, open a terminal and run the following command, replacing the values for the cumulative patch number and your Maven repository path:</p><pre class="highlight listingblock"><code>$ unzip -o rh-sso-7.x.y-incremental-maven-repository.zip  -d RH-SSO_MAVEN_REPOSITORY_PATH</code></pre></li><li><p>For Microsoft Windows, use the Windows extraction utility to extract the ZIP file into the root of the <code>RH-SSO_MAVEN_REPOSITORY_PATH</code> directory.</p></li></ol></div></li></ol></div></section></section>
<section><section id="_upgrading_red_hat_single_sign_on_adapters"><h2>Upgrading Red Hat Single Sign-On Adapters</h2><div class="paragraph" id="_upgrade_adapters"><p>It is important that you upgrade Red Hat Single Sign-On server first, and then upgrade the adapters. Earlier versions of the
adapter might work with later versions of Red Hat Single Sign-On server, but earlier versions of Red Hat Single Sign-On server might not
work with later versions of the adapter.</p></div></section><section id="_compatibility_with_older_adapters"><h2>Compatibility with older adapters</h2><div class="paragraph"><p>As mentioned above, we try to support newer release versions of Red Hat Single Sign-On server working with older release versions of the adapters.
However, in some cases we need to include fixes on the Red Hat Single Sign-On server side which may break compatibility with older versions
of the adapters. For example, when we implement new aspects of the OpenID Connect specification, which older client adapter versions
were not aware of.</p></div>
<div class="paragraph"><p>In those cases, we added Compatibility modes. For OpenId Connect clients, there is a section named <code>OpenID Connect Compatibility Modes</code>
in the Red Hat Single Sign-On admin console, on the page with client details. Here, you can disable some new aspects of the Red Hat Single Sign-On server
to preserve compatibility with older client adapters. More details are available in the tool tips of individual switches.</p></div></section><section id="_upgrade_eap_adapter"><h2>Upgrading the EAP Adapter</h2><div class="paragraph"><p>If you originally installed the adapter using a downloaded archive, to upgrade the JBoss EAP adapter, complete the following steps:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Download the new adapter archive.</p></li><li><p>Remove the previous adapter modules by deleting the <code>EAP_HOME/modules/system/add-ons/keycloak/</code> directory.</p></li><li><p>Unzip the downloaded archive into EAP_HOME.</p></li></ol></div>
<div class="paragraph"><p>If you originally installed the adapter using RPM, to upgrade the adapter, complete the following steps, which are different depending on whether you are performing a minor or a micro upgrade:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>For minor upgrades, use Yum to uninstall any adapters you currently have installed and then use Yum to install the new version of the adapters.</p></li><li><p>For micro upgrades, use Yum to upgrade the adapter. This is the only step for micro upgrades.</p></li></ol></div>
<pre class="highlight nowrap listingblock"><code class="bash language-bash">yum update</code></pre></section><section id="_upgrade_js_adapter"><h2>Upgrading the JavaScript Adapter</h2><div class="paragraph"><p>To upgrade a JavaScript adapter that has been copied to your web application, complete the following steps:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Download the new adapter archive.</p></li><li><p>Overwrite the keycloak.js file in your application with the keycloak.js file from the downloaded archive.</p></li></ol></div></section><section id="_upgrade_nodejs_adapter"><h2>Upgrading the Node.js Adapter</h2><div class="paragraph"><p>To upgrade a Node.js adapter that has been copied to your web application, complete the following steps:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Download the new adapter archive.</p></li><li><p>Remove the existing Node.js adapter directory</p></li><li><p>Unzip the updated file into its place</p></li><li><p>Change the dependency for keycloak-connect in the package.json of your application</p></li></ol></div></section></section></div></div><script src="node_modules/reveal.js/lib/js/head.min.js"></script><script src="node_modules/reveal.js/js/reveal.js"></script><script>Array.prototype.slice.call(document.querySelectorAll('.slides section')).forEach(function(slide) {
  if (slide.getAttribute('data-background-color')) return;
  // user needs to explicitly say he wants CSS color to override otherwise we might break custom css or theme (#226)
  if (!(slide.classList.contains('canvas') || slide.classList.contains('background'))) return;
  var bgColor = getComputedStyle(slide).backgroundColor;
  if (bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent') {
    slide.setAttribute('data-background-color', bgColor);
    slide.style.backgroundColor = 'transparent';
  }
})

// See https://github.com/hakimel/reveal.js#configuration for a full list of configuration options
Reveal.initialize({
  // Display presentation control arrows
  controls: true,
  // Help the user learn the controls by providing hints, for example by
  // bouncing the down arrow when they first encounter a vertical slide
  controlsTutorial: true,
  // Determines where controls appear, "edges" or "bottom-right"
  controlsLayout: 'bottom-right',
  // Visibility rule for backwards navigation arrows; "faded", "hidden"
  // or "visible"
  controlsBackArrows: 'faded',
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: false,
  // Control which views the slide number displays on
  showSlideNumber: 'all',
  // Push each slide change to the browser history
  history: false,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // Randomizes the order of slides each time the presentation loads
  shuffle: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags whether to include the current fragment in the URL,
  // so that reloading brings you to the same fragment position
  fragmentInURL: false,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Flags if we should show a help overlay when the questionmark
  // key is pressed
  help: true,
  // Flags if speaker notes should be visible to all viewers
  showNotes: false,
  // Global override for autolaying embedded media (video/audio/iframe)
  // - null: Media will only autoplay if data-autoplay is present
  // - true: All media will autoplay, regardless of individual setting
  // - false: No media will autoplay, regardless of individual setting
  autoPlayMedia: null,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Use this method for navigation when auto-sliding
  autoSlideMethod: Reveal.navigateNext,
  // Specify the average time in seconds that you think you will spend
  // presenting each slide. This is used to show a pacing timer in the
  // speaker view
  defaultTiming: 120,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  // Add `data-preview-link` and `data-preview-link="false"` to customise each link
  // individually
  previewLinks: false,
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: 'slide',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',
  // Number of pixels to move the parallax background per slide
  // - Calculated automatically unless specified
  // - Set to 0 to disable movement along an axis
  parallaxBackgroundHorizontal: null,
  parallaxBackgroundVertical: null,
  // The display mode that will be used to show slides
  display: 'block',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 960,
  height: 700,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'node_modules/reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
      
      { src: 'node_modules/reveal.js/plugin/zoom-js/zoom.js', async: true },
      { src: 'node_modules/reveal.js/plugin/notes/notes.js', async: true },
      
      
      
      
  ],

  

});</script></body></html>