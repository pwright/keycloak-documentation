<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Red Hat Single Sign-On for OpenShift</title><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" name="viewport"><link href="node_modules/reveal.js/css/reveal.css" rel="stylesheet"><link rel="stylesheet" href="node_modules/reveal.js/css/theme/black.css" id="theme"><!--This CSS is generated by the Asciidoctor-Reveal.js converter to further integrate AsciiDoc's existing semantic with Reveal.js--><style type="text/css">.reveal div.right {
  float: right;
}

/* callouts */
.conum[data-value] {display:inline-block;color:#fff!important;background-color:rgba(50,150,50,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}</style><link href="node_modules/reveal.js/lib/css/zenburn.css" rel="stylesheet"><script>var link = document.createElement( 'link' );
link.rel = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match( /print-pdf/gi ) ? "node_modules/reveal.js/css/print/pdf.css" : "node_modules/reveal.js/css/print/paper.css";
document.getElementsByTagName( 'head' )[0].appendChild( link );</script><!--[if lt IE 9]><script src="node_modules/reveal.js/lib/js/html5shiv.js"></script><![endif]--></head><body><div class="reveal"><div class="slides"><section class="title" data-state="title"><h1>Red Hat Single Sign-On for OpenShift</h1></section><section><section id="_introduction"><h2>Introduction</h2></section><section id="_what_is_red_hat_single_sign_on"><h2>What Is Red Hat Single Sign-On?</h2><div class="paragraph"><p>Red Hat Single Sign-On is an integrated sign-on solution available as a Red Hat JBoss Middleware for OpenShift containerized image. The Red Hat Single Sign-On for OpenShift image provides an authentication server for users to centrally log in, log out, register, and manage user accounts for web applications, mobile applications, and RESTful web services.</p></div>
<div class="paragraph" id="sso-templates"><p>Red Hat offers multiple OpenShift application templates utilizing the Red Hat Single Sign-On for OpenShift image version number 6. These define the resources needed to develop Red Hat Single Sign-On 6 server based deployment and can be split into the following two categories:</p></div>
<div class="ulist" id="passthrough-templates"><ul><li><p>Templates using HTTPS and JGroups keystores and a truststore for the Red Hat Single Sign-On server, all prepared beforehand. These secure the TLS communication using <a href="https://docs.openshift.com/container-platform/latest/architecture/networking/routes.html#passthrough-termination">passthrough TLS termination</a>:</p><div class="ulist"><ul><li><p><strong><em>sso-cd-https</em></strong>: Red Hat Single Sign-On 6 backed by internal H2 database on the same pod.</p></li><li><p><strong><em>sso-cd-mysql</em></strong>: Red Hat Single Sign-On 6 backed by ephemeral MySQL database on a separate pod.</p></li><li><p><strong><em>sso-cd-mysql-persistent</em></strong>: Red Hat Single Sign-On 6 backed by persistent MySQL database on a separate pod.</p></li><li><p><strong><em>sso-cd-postgresql</em></strong>: Red Hat Single Sign-On 6 backed by ephemeral PostgreSQL database on a separate pod.</p></li><li><p><strong><em>sso-cd-postgresql-persistent</em></strong>: Red Hat Single Sign-On 6 backed by persistent PostgreSQL database on a separate pod.</p></li></ul></div></li></ul></div>
<div class="ulist" id="reencrypt-templates"><ul><li><p>Templates using OpenShift&#8217;s internal <a href="https://docs.openshift.com/container-platform/latest/dev_guide/secrets.html#service-serving-certificate-secrets">service serving x509 certificate secrets</a> to automatically create the HTTPS keystore used for serving secure content. The JGroups cluster traffic is authenticated using the <code>AUTH</code> protocol and encrypted using the <code>ASYM_ENCRYPT</code> protocol. The Red Hat Single Sign-On server truststore is also created automatically, containing the <strong>/var/run/secrets/kubernetes.io/serviceaccount/service-ca.crt</strong> CA certificate file, which is used to sign the certificate for HTTPS keystore. Moreover, the truststore for the Red Hat Single Sign-On server is pre-populated with the all known, trusted CA certificate files found in the Java system path. These templates secure the TLS communication using <a href="https://docs.openshift.com/container-platform/latest/architecture/networking/routes.html#re-encryption-termination">re-encryption TLS termination</a>:</p><div class="ulist"><ul><li><p><strong><em>sso-cd-x509-https</em></strong>: Red Hat Single Sign-On 6 with auto-generated HTTPS keystore and Red Hat Single Sign-On truststore, backed by internal H2 database. The <code>ASYM_ENCRYPT</code> JGroups protocol is used for encryption of cluster traffic.</p></li><li><p><strong><em>sso-cd-x509-mysql-persistent</em></strong>: Red Hat Single Sign-On 6 with auto-generated HTTPS keystore and Red Hat Single Sign-On truststore, backed by persistent MySQL database. The <code>ASYM_ENCRYPT</code> JGroups protocol is used for encryption of cluster traffic.</p></li><li><p><strong><em>sso-cd-x509-postgresql-persistent</em></strong>: Red Hat Single Sign-On 6 with auto-generated HTTPS keystore and Red Hat Single Sign-On truststore, backed by persistent PostgreSQL database. The <code>ASYM_ENCRYPT</code> JGroups protocol is used for encryption of cluster traffic.</p></li></ul></div></li></ul></div>
<div class="paragraph"><p>Other templates that integrate with Red Hat Single Sign-On are also available:</p></div>
<div class="ulist"><ul><li><p><strong><em>eap64-sso-s2i</em></strong>: Red Hat Single Sign-On-enabled Red Hat JBoss Enterprise Application Platform 6.4.</p></li><li><p><strong><em>eap71-sso-s2i</em></strong>: Red Hat Single Sign-On-enabled Red Hat JBoss Enterprise Application Platform 7.1.</p></li><li><p><strong><em>datavirt63-secure-s2i</em></strong>: Red Hat Single Sign-On-enabled Red Hat JBoss Data Virtualization 6.3.</p></li></ul></div>
<div class="paragraph"><p>These templates contain environment variables specific to Red Hat Single Sign-On that enable automatic Red Hat Single Sign-On client registration when deployed.</p></div>
<div class="paragraph"><p>See <a href="#Auto-Man-Client-Reg">Automatic and Manual Red Hat Single Sign-On Client Registration Methods</a> for more information.</p></div></section></section>
<section><section id="_before_you_begin"><h2>Before You Begin</h2></section><section id="_comparison_red_hat_single_sign_on_for_openshift_image_and_red_hat_single_sign_on"><h2>Comparison: Red Hat Single Sign-On for OpenShift Image and Red Hat Single Sign-On</h2><div class="paragraph"><p>The Red Hat Single Sign-On for OpenShift image version number 6 is based on Red Hat Single Sign-On 6. There are some differences in functionality between the Red Hat Single Sign-On for OpenShift image and Red Hat Single Sign-On:</p></div>
<div class="ulist"><ul><li><p>The Red Hat Single Sign-On for OpenShift image includes all of the functionality of Red Hat Single Sign-On. In addition, the Red Hat Single Sign-On-enabled JBoss EAP image automatically handles OpenID Connect or SAML client registration and configuration for <strong><em>.war</em></strong> deployments that contain <strong>&lt;auth-method&gt;KEYCLOAK&lt;/auth-method&gt;</strong> or <strong>&lt;auth-method&gt;KEYCLOAK-SAML&lt;/auth-method&gt;</strong> in their respective <strong>web.xml</strong> files.</p></li></ul></div></section><section id="_version_compatibility_and_support"><h2>Version Compatibility and Support</h2><div class="paragraph"><p>See the xPaaS part of the <a href="https://access.redhat.com/articles/2176281">OpenShift and Atomic Platform Tested Integrations page</a> for details about OpenShift image version compatibility.</p></div></section><section id="_deprecated_image_streams_and_application_templates_for_red_hat_single_sign_on_for_openshift"><h2>Deprecated Image Streams and Application Templates for Red Hat Single Sign-On for OpenShift</h2><div class="admonitionblock important"><table><tr><td class="icon"><div class="title">Important</div></td><td class="content"><div class="paragraph"><p>The Red Hat Single Sign-On for OpenShift image version number 7.0 and 7.1 are deprecated and they will no longer receive updates of image and application templates.</p></div>
<div class="paragraph"><p><strong>To deploy new applications, it is recommended to use the version 7.2 or 6 of the Red Hat Single Sign-On for OpenShift image along with the application templates specific to these image versions.</strong></p></div></td></tr></table></div></section><section id="_initial_setup"><h2>Initial Setup</h2><div class="paragraph"><p>The Tutorials in this guide follow on from and assume an OpenShift instance similar to that created by performing <a href="https://docs.openshift.com/container-platform/latest/install/index.html">the installation of the OpenShift Container Platform cluster</a>.</p></div>
<div class="admonitionblock important"><table><tr><td class="icon"><div class="title">Important</div></td><td class="content"><div class="paragraph"><p>For information related to updating the existing database when migrating Red Hat Single Sign-On for OpenShift image from previous versions to version 6, see the <a href="#upgrading-sso-db-from-previous-version">Updating Existing Database when Migrating Red Hat Single Sign-On for OpenShift Image to a new version</a> section.</p></div></td></tr></table></div></section></section>
<section><section id="_get_started"><h2>Get Started</h2></section><section id="_using_the_red_hat_single_sign_on_for_openshift_image_streams_and_application_templates"><h2>Using the Red Hat Single Sign-On for OpenShift Image Streams and Application Templates</h2><div class="admonitionblock important"><table><tr><td class="icon"><div class="title">Important</div></td><td class="content"><div class="paragraph"><p>Red Hat JBoss Middleware for OpenShift images are pulled on demand from the secured Red Hat Registry: <a href="https://access.redhat.com/containers/">registry.redhat.io</a>, which requires authentication. To retrieve content, you will need to log into the registry using the Red Hat account.</p></div>
<div class="paragraph"><p>To consume container images from <strong><em>registry.redhat.io</em></strong> in shared environments such as OpenShift, it is recommended for an administrator to use a Registry Service Account, also referred to as authentication tokens, in place of an individual person&#8217;s Red Hat Customer Portal credentials.</p></div>
<div class="paragraph"><p>To create a Registry Service Account, navigate to the <a href="https://access.redhat.com/terms-based-registry/">Registry Service Account Management Application</a>, and log in if necessary.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>From the <strong><em>Registry Service Accounts</em></strong> page, click <strong><em>Create Service Account</em></strong>.</p></li><li><p>Provide a name for the Service Account, for example <strong><em>registry.redhat.io-sa</em></strong>. It will be prepended with a fixed, random string.</p><div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>Enter a description for the Service Account, for example <strong><em>Service account to consume container images from registry.redhat.io.</em></strong>.</p></li><li><p>Click <strong><em>Create</em></strong>.</p></li></ol></div></li><li><p>After the Service Account was created, click the <strong><em>registry.redhat.io-sa</em></strong> link in the <strong><em>Account name</em></strong> column of the table presented on the <strong><em>Registry Service Accounts</em></strong> page.</p></li><li><p>Finally, click the <strong><em>OpenShift Secret</em></strong> tab, and perform all steps listed on that page.</p></li></ol></div>
<div class="paragraph"><p>See the <a href="https://access.redhat.com/RegistryAuthentication">Red Hat Container Registry Authentication</a> article for more information.</p></div></td></tr></table></div>
<div class="paragraph"><p>To update to the latest Red Hat Single Sign-On for OpenShift images, run the following commands:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>On your master host(s), ensure that you are logged in as a cluster administrator or a user with project administrator access to the global <code>openshift</code> project.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc login -u system:admin</code></pre></li><li><p>Run the following commands to update the core set of Red Hat Single Sign-On 6 resources for OpenShift in the <code>openshift</code> project:</p><pre class="highlight listingblock"><code class="bash language-bash">$ for resource in sso-cd-image-stream.json \
  sso-cd-https.json \
  sso-cd-mysql.json \
  sso-cd-mysql-persistent.json \
  sso-cd-postgresql.json \
  sso-cd-postgresql-persistent.json \
  sso-cd-x509-https.json \
  sso-cd-x509-mysql-persistent.json \
  sso-cd-x509-postgresql-persistent.json
do
  oc replace -n openshift --force -f \
  https://raw.githubusercontent.com/jboss-container-images/redhat-sso-7-openshift-image/sso-cd-dev/templates/${resource}
done</code></pre></li><li><p>Run the following command to install the Red Hat Single Sign-On 6 OpenShift image streams in the <code>openshift</code> project:</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc -n openshift import-image redhat-sso-cd-openshift:6</code></pre></li></ol></div></section><section id="Example-Deploying-SSO"><h2>Deploying the Red Hat Single Sign-On Image</h2><h3>Preparing the Deployment</h3><div class="paragraph"><p>Log in to the OpenShift CLI with a user that holds the <em>cluster:admin</em> role.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Create a new project:</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc new-project sso-app-demo</code></pre></li><li><p>Add the <code>view</code> role to the <a href="https://docs.openshift.com/container-platform/latest/dev_guide/service_accounts.html#default-service-accounts-and-roles"><code>default</code></a> service account. This enables the service account to view all the resources in the sso-app-demo namespace, which is necessary for managing the cluster.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc policy add-role-to-user view system:serviceaccount:$(oc project -q):default</code></pre></li></ol></div>
<h3>Deploying the Red Hat Single Sign-On Image using the Application Template</h3><h4>Deploying the Template via OpenShift CLI</h4><div class="olist arabic"><ol class="arabic"><li><p>List the available Red Hat Single Sign-On application templates:</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc get templates -n openshift -o name | grep -o 'sso-cd.\+'
sso-cd-https
sso-cd-mysql
sso-cd-mysql-persistent
sso-cd-postgresql
sso-cd-postgresql-persistent
sso-cd-x509-https
sso-cd-x509-mysql-persistent
sso-cd-x509-postgresql-persistent</code></pre></li><li><p>Deploy the selected one:</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc new-app --template=sso-cd-x509-https
--&gt; Deploying template "openshift/sso-cd-x509-https" to project sso-app-demo

     Red Hat Single Sign-On 6 (Ephemeral)
     ---------
     An example Red Hat Single Sign-On 7 application. For more information about using this template, see &lt;a href="https://github.com/jboss-openshift/application-templates" class="bare"&gt;https://github.com/jboss-openshift/application-templates&lt;/a&gt;.

     A new Red Hat Single Sign-On service has been created in your project. The admin username/password for accessing the master realm via the Red Hat Single Sign-On console is IACfQO8v/nR7llVSVb4Dye3TNRbXoXhRpAKTmiCRc. The HTTPS keystore used for serving secure content, the JGroups keystore used for securing JGroups communications, and server truststore used for securing Red Hat Single Sign-On requests were automatically created via OpenShift's service serving x509 certificate secrets.

     * With parameters:
        * Application Name=sso
        * JGroups Cluster Password=jg0Rssom0gmHBnooDF3Ww7V4Mu5RymmB # generated
        * Datasource Minimum Pool Size=
        * Datasource Maximum Pool Size=
        * Datasource Transaction Isolation=
        * ImageStream Namespace=openshift
        * Red Hat Single Sign-On Administrator Username=IACfQO8v # generated
        * Red Hat Single Sign-On Administrator Password=nR7llVSVb4Dye3TNRbXoXhRpAKTmiCRc # generated
        * Red Hat Single Sign-On Realm=
        * Red Hat Single Sign-On Service Username=
        * Red Hat Single Sign-On Service Password=
        * Container Memory Limit=1Gi

--&gt; Creating resources ...
    service "sso" created
    service "secure-sso" created
    service "sso-ping" created
    route "sso" created
    route "secure-sso" created
    deploymentconfig "sso" created
--&gt; Success
    Run 'oc status' to view your app.</code></pre></li></ol></div>
<h4>Deploying the Template via the OpenShift Web Console</h4><div class="paragraph"><p>Alternatively, perform the following steps to deploy the Red Hat Single Sign-On template via the OpenShift web console:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Log in to the OpenShift web console and select the <em>sso-app-demo</em> project space.</p></li><li><p>Click <strong>Add to Project</strong>, then <strong>Browse Catalog</strong> to list the default image streams and templates.</p></li><li><p>Use the <strong>Filter by Keyword</strong> search bar to limit the list to those that match <em>sso</em>. You may need to click <strong>Middleware</strong>, then <strong>Integration</strong> to show the desired application template.</p></li><li><p>Select an Red Hat Single Sign-On application template. This example uses <strong><em>Red Hat Single Sign-On 6 (Ephemeral)</em></strong>.</p></li><li><p>Click <strong>Next</strong> in the <strong>Information</strong> step.</p></li><li><p>From the <strong>Add to Project</strong> drop-down menu, select the <em>sso-app-demo</em> project space. Then click <strong>Next</strong>.</p></li><li><p>Select <strong>Do not bind at this time</strong> radio button in the <strong>Binding</strong> step. Click <strong>Create</strong> to continue.</p></li><li><p>In the <strong>Results</strong> step, click the <strong>Continue to the project overview</strong> link to verify the status of the deployment.</p></li></ol></div>
<h3>Accessing the Administrator Console of the Red Hat Single Sign-On Pod</h3><div class="paragraph"><p>After the template got deployed, identify the available routes:</p></div>
<pre class="highlight listingblock"><code class="bash language-bash">$ oc get routes</code></pre>
<table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:14.2857%"><col style="width:14.2857%"><col style="width:14.2857%"><col style="width:14.2857%"><col style="width:14.2857%"><col style="width:14.2857%"><col style="width:14.2858%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">NAME</th><th class="tableblock halign-left valign-top">HOST/PORT</th><th class="tableblock halign-left valign-top">PATH</th><th class="tableblock halign-left valign-top">SERVICES</th><th class="tableblock halign-left valign-top">PORT</th><th class="tableblock halign-left valign-top">TERMINATION</th><th class="tableblock halign-left valign-top">WILDCARD</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">sso</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">sso-sso-app-demo.openshift.example.com</p></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock">sso</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">&lt;all&gt;</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">reencrypt</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td></tr></table>
<div class="paragraph"><p>and access the Red Hat Single Sign-On administrator console at:</p></div>
<div class="ulist"><ul><li><p><strong>https://sso-sso-app-demo.openshift.example.com/auth/admin</strong></p></li></ul></div>
<div class="paragraph"><p>using the <a href="#sso-administrator-setup">administrator account</a>.</p></div></section></section>
<section><section id="_advanced_concepts"><h2>Advanced Concepts</h2><div class="paragraph"><p>These cover additional configuration topics, such as seting up keystores and a truststore for the Red Hat Single Sign-On server, creating an administrator account, an overview of available Red Hat Single Sign-On client registration methods, and guidance on configuring clustering.</p></div></section><section id="_requirements_and_deploying_passthrough_tls_termination_red_hat_single_sign_on_templates"><h2>Requirements and Deploying <a href="../introduction/introduction.html#passthrough-templates">Passthrough TLS Termination</a> Red Hat Single Sign-On Templates</h2><h3>Preparing the Deployment</h3><div class="paragraph"><p>Log in to the OpenShift CLI with a user that holds the <em>cluster:admin</em> role.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Create a new project:</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc new-project sso-app-demo</code></pre></li><li><p>Add the <code>view</code> role to the <a href="https://docs.openshift.com/container-platform/latest/dev_guide/service_accounts.html#default-service-accounts-and-roles"><code>default</code></a> service account. This enables the service account to view all the resources in the sso-app-demo namespace, which is necessary for managing the cluster.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc policy add-role-to-user view system:serviceaccount:$(oc project -q):default</code></pre></li></ol></div>
<h3>Creating HTTPS and JGroups Keystores, and Truststore for the Red Hat Single Sign-On Server</h3><div class="paragraph"><p>The Red Hat Single Sign-On application templates using <a href="../introduction/introduction.html#passthrough-templates">passthrough TLS termination</a> require:</p></div>
<div class="ulist"><ul><li><p>An <a href="#create-https-keystore">HTTPS keystore</a> used for encryption of https traffic,</p></li><li><p>The <a href="#create-jgroups-keystore">JGroups keystore</a> used for encryption of JGroups communications between nodes in the cluster, and</p></li><li><p><a href="#create-server-truststore">Red Hat Single Sign-On server truststore</a> used for securing the Red Hat Single Sign-On requests</p></li></ul></div>
<div class="paragraph"><p>the Red Hat Single Sign-On for OpenShift image to be deployed properly.</p></div>
<div class="admonitionblock important"><table><tr><td class="icon"><div class="title">Important</div></td><td class="content"><div class="paragraph"><p>The Red Hat Single Sign-On application templates using <a href="../introduction/introduction.html#reencrypt-templates">re-encryption TLS termination</a> do not <strong>require</strong> or <strong>expect</strong> the aforementioned HTTPS and JGroups keystores and Red Hat Single Sign-On server truststore to be prepared beforehand. The templates use OpenShift&#8217;s internal <a href="https://docs.openshift.com/container-platform/latest/dev_guide/secrets.html#service-serving-certificate-secrets">service serving x509 certificate secrets</a> to automatically create the HTTPS and JGroups keystores. The Red Hat Single Sign-On server truststore is also created automatically, containing the <strong>/var/run/secrets/kubernetes.io/serviceaccount/service-ca.crt</strong> CA certificate file, which is used to create these cluster certificates. Moreover, the truststore for the Red Hat Single Sign-On server is pre-populated with the all known, trusted CA certificate files found in the Java system path.</p></div></td></tr></table></div>
<div class="paragraph"><p>The <strong><em>openssl</em></strong> toolkit is used in the following example to generate a CA certificate to sign the HTTPS keystore, and create a truststore for the Red Hat Single Sign-On server. <strong><em>keytool</em></strong>, a package <strong>included with the Java Development Kit</strong>, is then utilized to the generate self-signed certificates for these keystores.</p></div>
<div class="admonitionblock warning"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content"><div class="paragraph"><p>For production environments Red Hat recommends that you use your own SSL certificate purchased from a verified Certificate Authority (CA) for SSL-encrypted connections (HTTPS).</p></div>
<div class="paragraph"><p>See the <a href="https://access.redhat.com/documentation/en-us/jboss_enterprise_application_platform/6.1/html-single/security_guide/index#Generate_a_SSL_Encryption_Key_and_Certificate">JBoss Enterprise Application Platform Security Guide</a> for more information on how to create a keystore with self-signed or purchased SSL certificates.</p></div></td></tr></table></div>
<div class="paragraph" id="create-https-keystore"><p><strong><em>Create the HTTPS keystore:</em></strong></p></div>
<div class="olist loweralpha" id="generate-ca-certificate"><ol class="loweralpha" type="a"><li><p>Generate a CA certificate. Pick and remember the password. Provide identical password, when <a href="#signing-csr-with-ca-certificate">signing the certificate sign request with the CA certificate</a> below:</p><pre class="highlight listingblock"><code class="bash language-bash">$ openssl req -new -newkey rsa:4096 -x509 -keyout xpaas.key -out xpaas.crt -days 365 -subj "/CN=xpaas-sso-demo.ca"</code></pre></li><li><p>Generate a CA certificate for the HTTPS keystore. Provide <code>mykeystorepass</code> as the keystore password:</p><pre class="highlight listingblock"><code class="bash language-bash">$ keytool -genkeypair -keyalg RSA -keysize 2048 -dname "CN=secure-sso-sso-app-demo.openshift.example.com" -alias jboss -keystore keystore.jks</code></pre></li><li><p>Generate a certificate sign request for the HTTPS keystore. Provide <code>mykeystorepass</code> as the keystore password:</p><pre class="highlight listingblock"><code class="bash language-bash">$ keytool -certreq -keyalg rsa -alias jboss -keystore keystore.jks -file sso.csr</code></pre></li></ol></div>
<div class="olist loweralpha" id="signing-csr-with-ca-certificate"><ol class="loweralpha" start="4" type="a"><li><p>Sign the certificate sign request with the CA certificate. Provide the same password that was used to <a href="#generate-ca-certificate">generate the CA certificate</a>:</p><pre class="highlight listingblock"><code class="bash language-bash">$ openssl x509 -req -CA xpaas.crt -CAkey xpaas.key -in sso.csr -out sso.crt -days 365 -CAcreateserial</code></pre></li><li><p>Import the CA certificate into the HTTPS keystore. Provide <code>mykeystorepass</code> as the keystore password. Reply <code>yes</code> to <code>Trust this certificate? [no]:</code> question:</p><pre class="highlight listingblock"><code class="bash language-bash">$ keytool -import -file xpaas.crt -alias xpaas.ca -keystore keystore.jks</code></pre></li><li><p>Import the signed certificate sign request into the HTTPS keystore. Provide <code>mykeystorepass</code> as the keystore password:</p><pre class="highlight listingblock"><code class="bash language-bash">$ keytool -import -file sso.crt -alias jboss -keystore keystore.jks</code></pre></li></ol></div>
<div class="paragraph" id="create-jgroups-keystore"><p><strong><em>Generate a secure key for the JGroups keystore:</em></strong></p></div>
<div class="paragraph"><p>Provide <code>password</code> as the keystore password:</p></div>
<pre class="highlight listingblock"><code class="bash language-bash">$ keytool -genseckey -alias secret-key -storetype JCEKS -keystore jgroups.jceks</code></pre>
<div class="paragraph" id="create-server-truststore"><p><strong><em>Import the CA certificate into a new Red Hat Single Sign-On server truststore:</em></strong></p></div>
<div class="paragraph"><p>Provide <code>mykeystorepass</code> as the truststore password. Reply <code>yes</code> to <code>Trust this certificate? [no]:</code> question:</p></div>
<pre class="highlight listingblock"><code class="bash language-bash">$ keytool -import -file xpaas.crt -alias xpaas.ca -keystore truststore.jks</code></pre>
<h3>Secrets</h3><div class="paragraph"><p>OpenShift uses objects called <a href="https://docs.openshift.com/container-platform/latest/dev_guide/secrets.html">secrets</a> to hold sensitive information, such as passwords or keystores.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Create the secrets for the HTTPS and JGroups keystores, and Red Hat Single Sign-On server truststore, generated in the <a href="#Configuring-Keystores">previous section</a>.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc secret new sso-app-secret keystore.jks jgroups.jceks truststore.jks</code></pre></li><li><p>Link these secrets to the <a href="https://docs.openshift.com/container-platform/latest/dev_guide/service_accounts.html#default-service-accounts-and-roles">default</a> service account, which is used to run Red Hat Single Sign-On pods.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc secrets link default sso-app-secret</code></pre></li></ol></div>
<h3>Deploying the Chosen Red Hat Single Sign-On Passthrough TLS Template via OpenShift CLI</h3><div class="paragraph"><p>After the aforementioned <a href="#Configuring-Keystores">keystores</a> and <a href="#Configuring-Secrets">secrets</a> are created, deploy some of the available <a href="../introduction/introduction.html#passthrough-templates">passthrough TLS termination</a> as follows:</p></div>
<div class="admonitionblock warning"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content"><div class="paragraph"><p>For simplicity, the values of <strong><em>SSO_ADMIN_USERNAME</em></strong>, <strong><em>SSO_ADMIN_PASSWORD</em></strong>, <strong><em>HTTPS_PASSWORD</em></strong>, <strong><em>JGROUPS_ENCRYPT_PASSWORD</em></strong>, and <strong><em>SSO_TRUSTSTORE_PASSWORD</em></strong> variables <a href="#advanced-topics-deploy-sso-cd-https-template">in the following command</a> have been chosen to match the default values of the respective parameters of the <strong><em>sso-cd-https</em></strong> Red Hat Single Sign-On application template.</p></div>
<div class="paragraph"><p>For production environments, Red Hat recommends that you consult the on-site policy, specific to your organization for guidance on how to generate sufficiently strong user name and password for the administrator user account of the Red Hat Single Sign-On server, and passwords for the HTTPS and JGroups keystores, and the truststore of the Red Hat Single Sign-On server.</p></div>
<div class="paragraph"><p>Be aware that <strong>the passwords provided when provisioning the template need to match the passwords provided when creating the keystores</strong>. If using different username and passwords, modify the values of respective <a href="#advanced-topics-deploy-sso-cd-https-template">template parameters</a> as appropriate for your environment.</p></div></td></tr></table></div>
<div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><div class="paragraph"><p>The following commands using the <strong><em>keytool</em></strong>, a package <strong>included with the Java Development Kit</strong>, can be used to determine the names associated with the certificate:</p></div>
<pre class="highlight listingblock"><code class="bash language-bash">$ keytool -v -list -keystore keystore.jks | grep Alias
Enter keystore password:  mykeystorepass
Alias name: xpaas.ca
Alias name: jboss</code></pre>
<pre class="highlight listingblock"><code class="bash language-bash">$ keytool -v -list -keystore jgroups.jceks -storetype jceks | grep Alias
Enter keystore password:  password
Alias name: secret-key</code></pre>
<div class="paragraph"><p>Finally, the <strong><em>SSO_ADMIN_USERNAME</em></strong>, <strong><em>SSO_ADMIN_PASSWORD</em></strong>, and the <strong><em>SSO_REALM</em></strong> template parameters in the following command are optional.</p></div></td></tr></table></div>
<div class="paragraph"><p><a id="advanced-topics-deploy-sso-cd-https-template"></a></p></div>
<pre class="highlight listingblock"><code class="bash language-bash">$ oc new-app --template=sso-cd-https \
 -p HTTPS_SECRET="sso-app-secret" \
 -p HTTPS_KEYSTORE="keystore.jks" \
 -p HTTPS_NAME="jboss" \
 -p HTTPS_PASSWORD="mykeystorepass" \
 -p JGROUPS_ENCRYPT_SECRET="sso-app-secret" \
 -p JGROUPS_ENCRYPT_KEYSTORE="jgroups.jceks" \
 -p JGROUPS_ENCRYPT_NAME="secret-key" \
 -p JGROUPS_ENCRYPT_PASSWORD="password" \
 -p SSO_ADMIN_USERNAME="admin" \
 -p SSO_ADMIN_PASSWORD="redhat" \
 -p SSO_REALM="demorealm" \
 -p SSO_TRUSTSTORE="truststore.jks" \
 -p SSO_TRUSTSTORE_PASSWORD="mykeystorepass" \
 -p SSO_TRUSTSTORE_SECRET="sso-app-secret"
--&gt; Deploying template "openshift/sso-cd-https" to project sso-app-demo

     Red Hat Single Sign-On 6 (Ephemeral with passthrough TLS)
     ---------
     An example Red Hat Single Sign-On 7 application. For more information about using this template, see https://github.com/jboss-openshift/application-templates.

     A new Red Hat Single Sign-On service has been created in your project. The admin username/password for accessing the master realm via the Red Hat Single Sign-On console is admin/redhat. Please be sure to create the following secrets: "sso-app-secret" containing the keystore.jks file used for serving secure content; "sso-app-secret" containing the jgroups.jceks file used for securing JGroups communications; "sso-app-secret" containing the truststore.jks file used for securing Red Hat Single Sign-On requests.

     * With parameters:
        * Application Name=sso
        * Custom http Route Hostname=
        * Custom https Route Hostname=
        * Server Keystore Secret Name=sso-app-secret
        * Server Keystore Filename=keystore.jks
        * Server Keystore Type=
        * Server Certificate Name=jboss
        * Server Keystore Password=mykeystorepass
        * Datasource Minimum Pool Size=
        * Datasource Maximum Pool Size=
        * Datasource Transaction Isolation=
        * JGroups Secret Name=sso-app-secret
        * JGroups Keystore Filename=jgroups.jceks
        * JGroups Certificate Name=secret-key
        * JGroups Keystore Password=password
        * JGroups Cluster Password=yeSppLfp # generated
        * ImageStream Namespace=openshift
        * Red Hat Single Sign-On Administrator Username=admin
        * Red Hat Single Sign-On Administrator Password=redhat
        * Red Hat Single Sign-On Realm=demorealm
        * Red Hat Single Sign-On Service Username=
        * Red Hat Single Sign-On Service Password=
        * Red Hat Single Sign-On Trust Store=truststore.jks
        * Red Hat Single Sign-On Trust Store Password=mykeystorepass
        * Red Hat Single Sign-On Trust Store Secret=sso-app-secret
        * Container Memory Limit=1Gi

--&gt; Creating resources ...
    service "sso" created
    service "secure-sso" created
    service "sso-ping" created
    route "sso" created
    route "secure-sso" created
    deploymentconfig "sso" created
--&gt; Success
    Run 'oc status' to view your app.</code></pre></section><section id="advanced-concepts-sso-hostname-spi-setup"><h2>Customizing the Hostname for the Red Hat Single Sign-On Server</h2><div class="paragraph"><p>The hostname SPI introduced a flexible way to configure the hostname for the Red Hat Single Sign-On server. There are two built-in providers. The first is <code>request</code>, which uses the request headers to determine the hostname. This is the <strong>default setting</strong> for Red Hat Single Sign-On for OpenShift image. The second is <code>fixed</code>, which allows configuring a fixed hostname. The latter makes sure that only valid hostnames can be used and allows internal applications to invoke Red Hat Single Sign-On server through an alternative URL.</p></div>
<div class="paragraph"><p>Run the following commands to set the <code>fixed</code> hostname SPI provider for the Red Hat Single Sign-On server:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Deploy the Red Hat Single Sign-On for OpenShift image with <strong><em>SSO_HOSTNAME</em></strong> environment variable set to the desired hostname of the Red Hat Single Sign-On server.</p><pre class="highlight listingblock"><code>$ oc new-app --template=sso-cd-x509-https \
  -p SSO_HOSTNAME="rh-sso-server.openshift.example.com"</code></pre></li><li><p>Identify the name of the route for the Red Hat Single Sign-On service.</p><pre class="highlight listingblock"><code>$ oc get routes</code></pre>
<table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:14.2857%"><col style="width:14.2857%"><col style="width:14.2857%"><col style="width:14.2857%"><col style="width:14.2857%"><col style="width:14.2857%"><col style="width:14.2858%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">NAME</th><th class="tableblock halign-left valign-top">HOST/PORT</th><th class="tableblock halign-left valign-top">PATH</th><th class="tableblock halign-left valign-top">SERVICES</th><th class="tableblock halign-left valign-top">PORT</th><th class="tableblock halign-left valign-top">TERMINATION</th><th class="tableblock halign-left valign-top">WILDCARD</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">sso</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">sso-sso-app-demo.openshift.example.com</p></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock">sso</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">&lt;all&gt;</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">reencrypt</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td></tr></table></li><li><p>Change the <code>host:</code> field to match the hostname specified as the value of the <strong><em>SSO_HOSTNAME</em></strong> environment variable above.</p><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><div class="paragraph"><p>Adjust the <code>rh-sso-server.openshift.example.com</code> value in the following command as necessary.</p></div></td></tr></table></div>
<pre class="highlight listingblock"><code>$ oc patch route/sso --type=json -p '[{"op": "replace", "path": "/spec/host", "value": "rh-sso-server.openshift.example.com"}]'</code></pre>
<div class="paragraph"><p>If successful, the previous command will return the following output:</p></div>
<pre class="highlight listingblock"><code>route "sso" patched</code></pre></li></ol></div>
<h3>Connecting to an external database</h3><div class="paragraph"><p>Red Hat Single Sign-On can be configured to connect to an external (to OpenShift cluster) database. In order to achieve this, you need to modify the <code>sso-{database name}</code> Endpoints object to point to the proper address. The procedure has been described in <a href="https://docs.okd.io/latest/dev_guide/expose_service/expose_internal_ip_service.html#manually-assign-ip-service">OpenShift manual</a>.</p></div>
<div class="paragraph"><p>Tip: The easiest way to get started is to deploy Red Hat Single Sign-On from a template and then modify the Endpoints object. You might also need to update some of the datasource configuration variables in the DeploymentConfig. Once you&#8217;re done, just roll a new deployment out.</p></div></section><section id="sso-administrator-setup"><h2>Creating the Administrator Account for Red Hat Single Sign-On Server</h2><div class="paragraph"><p>Red Hat Single Sign-On does not provide any pre-configured management account out of the box. This administrator account is necessary for logging into the <code>master</code> realm&#8217;s management console and perform server maintenance operations such as, creating realms or users, or registering applications intended to be secured by Red Hat Single Sign-On.</p></div>
<div class="paragraph"><p>The administrator account can be created:</p></div>
<div class="ulist"><ul><li><p>By providing values for the <a href="#sso-admin-template-parameters"><strong><em>SSO_ADMIN_USERNAME</em></strong> and <strong><em>SSO_ADMIN_PASSWORD</em></strong> parameters</a>, when deploying the Red Hat Single Sign-On application template, or</p></li><li><p>By <a href="#sso-admin-remote-shell">a remote shell session to particular Red Hat Single Sign-On pod</a>, if the Red Hat Single Sign-On for OpenShift image is deployed without an application template.</p></li></ul></div>
<div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><div class="paragraph"><p>Red Hat Single Sign-On allows an initial administrator account to be created via the <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html-single/getting_started_guide/#creating_the_admin_account">Welcome Page</a> web form, but only if the Welcome Page is accessed from localhost; this method of administrator account creation is not applicable for the Red Hat Single Sign-On for OpenShift image.</p></div></td></tr></table></div>
<h3>Creating the Administrator Account Using Template Parameters</h3><div class="paragraph"><p>When deploying Red Hat Single Sign-On application template, the <strong><em>SSO_ADMIN_USERNAME</em></strong> and <strong><em>SSO_ADMIN_PASSWORD</em></strong> parameters denote the username and password of the Red Hat Single Sign-On server&#8217;s administrator account to be created for the <code>master</code> realm.</p></div>
<div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><div class="paragraph"><p><strong>Both of these parameters are required.</strong> If not specified, they are auto generated and displayed as an OpenShift instructional message when the template is instantiated.</p></div></td></tr></table></div>
<div class="admonitionblock important"><table><tr><td class="icon"><div class="title">Important</div></td><td class="content"><div class="paragraph"><p>The lifespan of the Red Hat Single Sign-On server&#8217;s administrator account depends upon the storage type used to store the Red Hat Single Sign-On server&#8217;s database:</p></div>
<div class="ulist"><ul><li><p>For an in-memory database mode (<strong><em>sso-cd-https</em></strong> and <strong><em>sso-cd-x509-https</em></strong> templates) the account exists throughout the lifecycle of the particular Red Hat Single Sign-On pod (stored account data is lost upon pod destruction),</p></li><li><p>For an ephemeral database mode (<strong><em>sso-cd-mysql</em></strong> and <strong><em>sso-cd-postgresql</em></strong> templates) the account exists throughout the lifecycle of the database pod (even if the Red Hat Single Sign-On pod is destructed, the stored account data is preserved under the assumption that the database pod is still running),</p></li><li><p>For persistent database mode (<strong><em>sso-cd-mysql-persistent</em></strong>, <strong><em>sso-cd-x509-mysql-persistent</em></strong>, <strong><em>sso-cd-postgresql-persistent</em></strong>, and <strong><em>sso-cd-x509-postgresql-persistent</em></strong> templates) the account exists throughout the lifecycle of the persistent medium used to hold the database data. This means that the stored account data is preserved even when both the Red Hat Single Sign-On and the database pods are destructed.</p></li></ul></div>
<div class="paragraph"><p>It is a common practice to deploy an Red Hat Single Sign-On application template to get the corresponding OpenShift deployment config for the application, and then reuse that deployment config multiple times (every time a new Red Hat Single Sign-On application needs to be instantiated).</p></div></td></tr></table></div>
<div class="admonitionblock warning"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content"><div class="paragraph"><p>In the case of <strong>ephemeral or persistent database mode</strong>, after creating the RH_SSO server&#8217;s administrator account, remove the <strong><em>SSO_ADMIN_USERNAME</em></strong> and <strong><em>SSO_ADMIN_PASSWORD</em></strong> variables from the deployment config before deploying new Red Hat Single Sign-On applications.</p></div></td></tr></table></div>
<div class="admonitionblock important"><table><tr><td class="icon"><div class="title">Important</div></td><td class="content"><div class="paragraph"><p>Run the following commands to prepare the previously created deployment config of the Red Hat Single Sign-On application for reuse after the administrator account has been created:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Identify the deployment config of the Red Hat Single Sign-On application.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc get dc -o name
deploymentconfig/sso
deploymentconfig/sso-mysql</code></pre></li><li><p>Clear the <strong><em>SSO_ADMIN_USERNAME</em></strong> and <strong><em>SSO_ADMIN_PASSWORD</em></strong> variables setting.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc set env dc/sso \
  -e SSO_ADMIN_USERNAME="" \
  -e SSO_ADMIN_PASSWORD=""</code></pre></li></ol></div></td></tr></table></div>
<h3>Creating the Administrator Account via Remote Shell Session to Red Hat Single Sign-On Pod</h3><div class="paragraph"><p>Run following commands to create an administrator account for the <code>master</code> realm of the Red Hat Single Sign-On server, when deploying the Red Hat Single Sign-On for OpenShift image directly from the image stream (without the <a href="../introduction/introduction.html#sso-templates">template</a>), after the Red Hat Single Sign-On application pod has been started:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Identify the Red Hat Single Sign-On application pod.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc get pods
NAME                READY     STATUS    RESTARTS   AGE
sso-12-pt93n        1/1       Running   0          1m
sso-mysql-6-d97pf   1/1       Running   0          2m</code></pre></li><li><p>Open a remote shell session to the Red Hat Single Sign-On for OpenShift container.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc rsh sso-12-pt93n
sh-4.2$</code></pre></li><li><p>Create the Red Hat Single Sign-On server administrator account for the <code>master</code> realm at the command line with the <code>add-user-keycloak.sh</code> script.</p><pre class="highlight listingblock"><code class="bash language-bash">sh-4.2$ cd /opt/eap/bin/
sh-4.2$ ./add-user-keycloak.sh \
        -r master \
        -u sso_admin \
        -p sso_password
Added 'sso_admin' to '/opt/eap/standalone/configuration/keycloak-add-user.json', restart server to load user</code></pre>
<div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><div class="paragraph"><p>The 'sso_admin' / 'sso_password' credentials in the example above are for demonstration purposes only. Refer to the password policy applicable within your organization for guidance on how to create a secure user name and password.</p></div></td></tr></table></div></li><li><p>Restart the underlying JBoss EAP server instance to load the newly added user account. Wait for the server to restart properly.</p><pre class="highlight listingblock"><code class="bash language-bash">sh-4.2$ ./jboss-cli.sh --connect ':reload'
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined
}</code></pre>
<div class="admonitionblock warning"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content"><div class="paragraph"><p>When restarting the server it is important to restart just the JBoss EAP process within the running Red Hat Single Sign-On container, and not the whole container. This is because restarting the whole container will recreate it from scratch, without the Red Hat Single Sign-On server administration account for the <code>master</code> realm.</p></div></td></tr></table></div></li><li><p>Log in to the <code>master</code> realm&#8217;s administration console of the Red Hat Single Sign-On server using the credentials created in the steps above. In the browser, navigate to <strong>http://sso-&lt;project-name&gt;.&lt;hostname&gt;/auth/admin</strong>  for the Red Hat Single Sign-On web server, or to <strong>https://secure-sso-&lt;project-name&gt;.&lt;hostname&gt;/auth/admin</strong> for the encrypted Red Hat Single Sign-On web server, and specify the user name and password used to create the administrator user.</p></li></ol></div></section><section id="_deployment_process"><h2>Deployment Process</h2><div class="paragraph"><p>Once deployed, the <strong><em>sso-cd-https</em></strong> and <strong><em>sso-cd-x509-https</em></strong> templates create a single pod that contains both the database and the Red Hat Single Sign-On servers. The <strong><em>sso-cd-mysql</em></strong>, <strong><em>sso-cd-mysql-persistent</em></strong>, <strong><em>sso-cd-x509-mysql-persistent</em></strong>, <strong><em>sso-cd-postgresql</em></strong>, <strong><em>sso-cd-postgresql-persistent</em></strong>, and <strong><em>sso-cd-x509-postgresql-persistent</em></strong> templates create two pods, one for the database server and one for the Red Hat Single Sign-On web server.</p></div>
<div class="paragraph"><p>After the Red Hat Single Sign-On web server pod has started, it can be accessed at its custom configured hostnames, or at the default hostnames:</p></div>
<div class="ulist"><ul><li><p><strong>http://sso-<em>&lt;project-name&gt;</em>.<em>&lt;hostname&gt;</em>/auth/admin</strong>: for the Red Hat Single Sign-On web server, and</p></li><li><p><strong>https://secure-sso-<em>&lt;project-name&gt;</em>.<em>&lt;hostname&gt;</em>/auth/admin</strong>: for the encrypted Red Hat Single Sign-On web server.</p></li></ul></div>
<div class="paragraph"><p>Use the <a href="#sso-administrator-setup">administrator user credentials</a> to log in into the <code>master</code> realm&#8217;s administration console.</p></div></section><section id="SSO-Clients"><h2>Red Hat Single Sign-On Clients</h2><div class="paragraph"><p>Clients are Red Hat Single Sign-On entities that request user authentication. A client can be an application requesting Red Hat Single Sign-On to provide user authentication, or it can be making requests for access tokens to start services on behalf of an authenticated user. See the <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html/server_administration_guide/clients">Managing Clients chapter of the Red Hat Single Sign-On documentation</a> for more information.</p></div>
<div class="paragraph"><p>Red Hat Single Sign-On provides <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html/server_administration_guide/clients#oidc_clients">OpenID-Connect</a> and <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html/server_administration_guide/clients#saml_clients">SAML</a> client protocols.<br>
OpenID-Connect is the preferred protocol and utilizes three different access types:</p></div>
<div class="ulist"><ul><li><p><strong>public</strong>: Useful for JavaScript applications that run directly in the browser and require no server configuration.</p></li><li><p><strong>confidential</strong>: Useful for server-side clients, such as EAP web applications, that need to perform a browser login.</p></li><li><p><strong>bearer-only</strong>: Useful for back-end services that allow bearer token requests.</p></li></ul></div>
<div class="paragraph"><p>It is required to specify the client type in the <strong>&lt;auth-method&gt;</strong> key of the application <strong>web.xml</strong> file. This file is read by the image at deployment. Set the value of <strong>&lt;auth-method&gt;</strong> element to:</p></div>
<div class="ulist"><ul><li><p><strong>KEYCLOAK</strong> for the OpenID Connect client.</p></li><li><p><strong>KEYCLOAK-SAML</strong> for the SAML client.</p></li></ul></div>
<div class="paragraph"><p>The following is an example snippet for the application <strong>web.xml</strong> to configure an OIDC client:</p></div>
<pre class="highlight listingblock"><code class="bash language-bash">...
&lt;login-config&gt;
        &lt;auth-method&gt;KEYCLOAK&lt;/auth-method&gt;
&lt;/login-config&gt;
...</code></pre>
<h3>Automatic and Manual Red Hat Single Sign-On Client Registration Methods</h3><div class="paragraph"><p>A client application can be automatically registered to an Red Hat Single Sign-On realm by using credentials passed in variables specific to the <strong><em>eap64-sso-s2i</em></strong>, <strong><em>eap71-sso-s2i</em></strong>, and <strong><em>datavirt63-secure-s2i</em></strong> templates.</p></div>
<div class="paragraph"><p>Alternatively, you can manually register the client application by configuring and exporting the Red Hat Single Sign-On client adapter and including it in the client application configuration.</p></div>
<h4>Automatic Red Hat Single Sign-On Client Registration</h4><div class="paragraph"><p>Automatic Red Hat Single Sign-On client registration is determined by Red Hat Single Sign-On environment variables specific to the <strong><em>eap64-sso-s2i</em></strong>, <strong><em>eap71-sso-s2i</em></strong>, and <strong><em>datavirt63-secure-s2i</em></strong> templates. The Red Hat Single Sign-On credentials supplied in the template are then used to register the client to the Red Hat Single Sign-On realm during deployment of the client application.</p></div>
<div class="paragraph"><p>The Red Hat Single Sign-On environment variables included in the <strong><em>eap64-sso-s2i</em></strong>, <strong><em>eap71-sso-s2i</em></strong>, and <strong><em>datavirt63-secure-s2i</em></strong> templates are:</p></div>
<table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Variable</th><th class="tableblock halign-left valign-top">Description</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HOSTNAME_HTTP</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Custom hostname for http service route. Leave blank for default hostname of &lt;application-name&gt;.&lt;project&gt;.&lt;default-domain-suffix&gt;</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HOSTNAME_HTTPS</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Custom hostname for https service route. Leave blank for default hostname of &lt;application-name&gt;.&lt;project&gt;.&lt;default-domain-suffix&gt;</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_URL</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The Red Hat Single Sign-On web server authentication address: https://secure-sso-<em>&lt;project-name&gt;</em>.<em>&lt;hostname&gt;</em>/auth</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_REALM</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The Red Hat Single Sign-On realm created for this procedure.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_USERNAME</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The name of the <em>realm management user</em>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_PASSWORD</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The password of the user.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_PUBLIC_KEY</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The public key generated by the realm. It is located in the <strong>Keys</strong> tab of the <strong>Realm Settings</strong> in the Red Hat Single Sign-On console.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_BEARER_ONLY</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">If set to <strong>true</strong>, the OpenID Connect client is registered as bearer-only.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_ENABLE_CORS</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">If set to <strong>true</strong>, the Red Hat Single Sign-On adapter enables Cross-Origin Resource Sharing (CORS).</p></td></tr></table>
<div class="paragraph"><p>If the Red Hat Single Sign-On client uses the SAML protocol, the following additional variables need to be configured:</p></div>
<table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Variable</th><th class="tableblock halign-left valign-top">Description</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SAML_KEYSTORE_SECRET</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Secret to use for access to SAML keystore. The default is <em>sso-app-secret</em>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SAML_KEYSTORE</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Keystore filename in the SAML keystore secret. The default is <em>keystore.jks</em>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SAML_KEYSTORE_PASSWORD</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Keystore password for SAML. The default is <em>mykeystorepass</em>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SAML_CERTIFICATE_NAME</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Alias for keys/certificate to use for SAML. The default is <em>jboss</em>.</p></td></tr></table>
<div class="paragraph"><p>See <a href="#Example-EAP-Auto">Example Workflow: Automatically Registering EAP Application in Red Hat Single Sign-On with OpenID-Connect Client</a> for an end-to-end example of the automatic client registration method using an OpenID-Connect client.</p></div>
<h4>Manual Red Hat Single Sign-On Client Registration</h4><div class="paragraph"><p>Manual Red Hat Single Sign-On client registration is determined by the presence of a deployment file in the client application&#8217;s <em>../configuration/</em> directory. These files are exported from the client adapter in the Red Hat Single Sign-On web console. The name of this file is different for OpenID-Connect and SAML clients:</p></div>
<div class="hdlist"><table><tr><td class="hdlist1"><strong>OpenID-Connect</strong></td><td class="hdlist2"><p><em>../configuration/secure-deployments</em></p></td></tr><tr><td class="hdlist1"><strong>SAML</strong></td><td class="hdlist2"><p><em>../configuration/secure-saml-deployments</em></p></td></tr></table></div>
<div class="paragraph"><p>These files are copied to the Red Hat Single Sign-On adapter configuration section in the <em>standalone-openshift.xml</em> at when the application is deployed.</p></div>
<div class="paragraph"><p>There are two methods for passing the Red Hat Single Sign-On adapter configuration to the client application:</p></div>
<div class="ulist"><ul><li><p>Modify the deployment file to contain the Red Hat Single Sign-On adapter configuration so that it is included in the <em>standalone-openshift.xml</em> file at deployment, or</p></li><li><p>Manually include the OpenID-Connect <em>keycloak.json</em> file, or the SAML <em>keycloak-saml.xml</em> file in the client application&#8217;s <strong>../WEB-INF</strong> directory.</p></li></ul></div>
<div class="paragraph"><p>See <a href="#Example-EAP-Manual">Example Workflow: Manually Configure an Application to Use Red Hat Single Sign-On Authentication, Using SAML Client</a> for an end-to-end example of the manual Red Hat Single Sign-On client registration method using a SAML client.</p></div></section><section id="_limitations"><h2>Limitations</h2><div class="paragraph"><p>OpenShift does not currently accept OpenShift role mapping from external providers. If Red Hat Single Sign-On is used as an authentication gateway for OpenShift, users created in Red Hat Single Sign-On must have the roles added using the OpenShift Administrator <code>oc adm policy</code> command.</p></div>
<div class="paragraph"><p>For example, to allow an Red Hat Single Sign-On-created user to view a project namespace in OpenShift:</p></div>
<pre class="highlight listingblock"><code class="bash language-bash">$ oc adm policy add-role-to-user view &lt;<em>user-name</em>&gt; -n &lt;<em>project-name</em>&gt;</code></pre></section></section>
<section><section id="_tutorials"><h2>Tutorials</h2></section><section id="upgrading-sso-db-from-previous-version"><h2>Example Workflow: Updating Existing Database to Migrate to New Red Hat Single Sign-On for OpenShift Image Version</h2><div class="admonitionblock important"><table><tr><td class="icon"><div class="title">Important</div></td><td class="content"><div class="ulist"><ul><li><p>Rolling updates from previous versions of Red Hat Single Sign-On for OpenShift to version 6 are not supported as databases and caches are not backward compatible.</p></li><li><p>Stop all instances running some of previous versions of the Red Hat Single Sign-On for OpenShift before upgrading. They cannot run concurrently against the same database.</p></li><li><p>Pre-generated scripts are not available, they are generated dynamically depending on the database.</p></li></ul></div></td></tr></table></div>
<div class="paragraph"><p>Red Hat Single Sign-On 6 can <a href="#automatic-db-migration">automatically migrate the database schema</a>, or you can choose to do it <a href="#manual-db-migration">manually</a>.</p></div>
<div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><div class="paragraph"><p>By default the database is automatically migrated when you start Red Hat Single Sign-On 6 for the first time.</p></div></td></tr></table></div>
<h3>Automatic Database Migration</h3><div class="paragraph"><p>This process assumes that you are <a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_middleware_for_openshift/3/html-single/red_hat_single_sign-on_for_openshift/index#Example-Deploying-SSO">running</a> some previous version of the Red Hat Single Sign-On for OpenShift image, backed by MySQL or PostgreSQL database (deployed in ephemeral or persistent mode), running on a separate pod.</p></div>
<div class="admonitionblock important"><table><tr><td class="icon"><div class="title">Important</div></td><td class="content"><div class="paragraph"><p>Stop all pods running the previous version of the Red Hat Single Sign-On for OpenShift image before upgrading to Red Hat Single Sign-On 6, as they cannot run concurrently against the same database.</p></div></td></tr></table></div>
<div class="paragraph"><p>Use the following steps to automatically migrate the database schema:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Identify the deployment config used to deploy the containers, running previous version of the Red Hat Single Sign-On for OpenShift image.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc get dc -o name --selector=application=sso
deploymentconfig/sso
deploymentconfig/sso-postgresql</code></pre></li><li><p>Stop all pods running the previous version of the Red Hat Single Sign-On for OpenShift image in the current namespace.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc scale --replicas=0 dc/sso
deploymentconfig "sso" scaled</code></pre></li><li><p>Update the image change trigger in the existing deployment config to reference the Red Hat Single Sign-On 6 image.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc patch dc/sso --type=json -p '[{"op": "replace", "path": "/spec/triggers/0/imageChangeParams/from/name", "value": "redhat-sso-cd-openshift:6"}]'
"sso" patched</code></pre></li><li><p>Start rollout of the new Red Hat Single Sign-On 6 images based on the latest image defined in the image change triggers.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc rollout latest dc/sso
deploymentconfig "sso" rolled out</code></pre></li><li><p>Deploy Red Hat Single Sign-On 6 containers using the modified deployment config.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc scale --replicas=1 dc/sso
deploymentconfig "sso" scaled</code></pre></li><li><p>(Optional) Verify the database has been successfully updated.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc get pods --selector=application=sso
NAME                     READY     STATUS    RESTARTS   AGE
sso-4-vg21r              1/1       Running   0          1h
sso-postgresql-1-t871r   1/1       Running   0          2h</code></pre>
<pre class="highlight listingblock"><code class="bash language-bash">$ oc logs sso-4-vg21r | grep 'Updating'
11:23:45,160 INFO  [org.keycloak.connections.jpa.updater.liquibase.LiquibaseJpaUpdaterProvider] (ServerService Thread Pool -- 58) Updating database. Using changelog META-INF/jpa-changelog-master.xml</code></pre></li></ol></div>
<h3>Manual Database Migration</h3><div class="admonitionblock important"><table><tr><td class="icon"><div class="title">Important</div></td><td class="content"><div class="paragraph"><p>Pre-generated scripts are not available. They are generated dynamically depending on the database. With Red Hat Single Sign-On 6 one can generate and export these to an SQL file that can be manually applied to the database afterwards. To dynamically generate the SQL migration file for the database:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Configure Red Hat Single Sign-On 6 with the correct datasource,</p></li><li><p>Set following configuration options in the <code>standalone-openshift.xml</code> file:</p><div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p><code>initializeEmpty=false</code>,</p></li><li><p><code>migrationStrategy=manual</code>, and</p></li><li><p><code>migrationExport</code> to the location on the file system of the pod, where the output SQL migration file should be stored (e.g. <code>migrationExport="${jboss.home.dir}/keycloak-database-update.sql"</code>).</p></li></ol></div></li></ol></div>
<div class="paragraph"><p>See <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html/server_installation_and_configuration_guide/database-1#database_configuration">database configuration of Red Hat Single Sign-On 6</a> for further details.</p></div>
<div class="paragraph"><p>The database migration process handles the data schema update and performs manipulation of the data, therefore, stop all pods running the previous version of the Red Hat Single Sign-On for OpenShift image before dynamic generation of the SQL migration file.</p></div></td></tr></table></div>
<div class="paragraph"><p>This process assumes that you are <a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_middleware_for_openshift/3/html-single/red_hat_single_sign-on_for_openshift/index#Example-Deploying-SSO">running</a> some previous version of the Red Hat Single Sign-On for OpenShift image, backed by MySQL or PostgreSQL database (deployed in ephemeral or persistent mode), running on a separate pod.</p></div>
<div class="paragraph"><p>Perform the following to generate and get the SQL migration file for the database:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Prepare template of OpenShift <a href="https://docs.openshift.com/container-platform/latest/dev_guide/jobs.html">database migration job</a> to generate the SQL file.</p><pre class="highlight listingblock"><code class="yaml language-yaml">$ cat job-to-migrate-db-to-sso-cd.yaml.orig
apiVersion: batch/v1
kind: Job
metadata:
  name: job-to-migrate-db-to-sso-cd
spec:
  autoSelector: true
  parallelism: 0
  completions: 1
  template:
    metadata:
      name: job-to-migrate-db-to-sso-cd
    spec:
      containers:
      - env:
        - name: DB_SERVICE_PREFIX_MAPPING
          value: &lt;&lt;DB_SERVICE_PREFIX_MAPPING_VALUE&gt;&gt;
        - name: &lt;&lt;PREFIX&gt;&gt;_JNDI
          value: &lt;&lt;PREFIX_JNDI_VALUE&gt;&gt;
        - name: &lt;&lt;PREFIX&gt;&gt;_USERNAME
          value: &lt;&lt;PREFIX_USERNAME_VALUE&gt;&gt;
        - name: &lt;&lt;PREFIX&gt;&gt;_PASSWORD
          value: &lt;&lt;PREFIX_PASSWORD_VALUE&gt;&gt;
        - name: &lt;&lt;PREFIX&gt;&gt;_DATABASE
          value: &lt;&lt;PREFIX_DATABASE_VALUE&gt;&gt;
        - name: TX_DATABASE_PREFIX_MAPPING
          value: &lt;&lt;TX_DATABASE_PREFIX_MAPPING_VALUE&gt;&gt;
        - name: &lt;&lt;SERVICE_HOST&gt;&gt;
          value: &lt;&lt;SERVICE_HOST_VALUE&gt;&gt;
        - name: &lt;&lt;SERVICE_PORT&gt;&gt;
          value: &lt;&lt;SERVICE_PORT_VALUE&gt;&gt;
        image: &lt;&lt;SSO_IMAGE_VALUE&gt;&gt;
        imagePullPolicy: Always
        name: job-to-migrate-db-to-sso-cd
        # Keep the pod running after the SQL migration
        # file was generated, so we can retrieve it
        command:
          - "/bin/bash"
          - "-c"
          - "/opt/eap/bin/openshift-launch.sh || sleep 600"
      restartPolicy: Never</code></pre>
<pre class="highlight listingblock"><code class="bash language-bash">$ cp job-to-migrate-db-to-sso-cd.yaml.orig \
     job-to-migrate-db-to-sso-cd.yaml</code></pre></li><li><p>From deployment config used to run the previous version of the Red Hat Single Sign-On for OpenShift image, copy the datasource definition and database access credentials to appropriate places of the template of the database migration job.</p><div class="paragraph"><p>Use the following script to copy <code>DB_SERVICE_PREFIX_MAPPING</code> and <code>TX_DATABASE_PREFIX_MAPPING</code> variable values, together with values of environment variables specific to particular datasource (<code>&lt;PREFIX&gt;_JNDI</code>, <code>&lt;PREFIX&gt;_USERNAME</code>, <code>&lt;PREFIX&gt;_PASSWORD</code>, and <code>&lt;PREFIX&gt;_DATABASE</code>) from the deployment config named <code>sso</code> to the database job migration template named <code>job-to-migrate-db-to-sso-cd.yaml</code>.</p></div>
<div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><div class="paragraph"><p>Although the <code>DB_SERVICE_PREFIX_MAPPING</code> environment variable allows a <a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.1/html-single/red_hat_jboss_enterprise_application_platform_for_openshift/#datasources">comma-separated list of <strong>&lt;name&gt;-&lt;database_type&gt;=&lt;PREFIX&gt;</strong> triplets</a> as its value, this example script accepts only one datasource triplet definition for demonstration purposes. You can modify the script for handling multiple datasource definition triplets.</p></div></td></tr></table></div>
<pre class="highlight listingblock"><code class="bash language-bash">$ cat mirror_sso_dc_db_vars.sh
#!/bin/bash

# IMPORTANT:
#
# If the name of the SSO deployment config differs from 'sso'
# or if the file name of the YAML definition of the migration
# job is different, update the following two variables
SSO_DC_NAME="sso"
JOB_MIGRATION_YAML="job-to-migrate-db-to-sso-cd.yaml"

# Get existing variables of the $SSO_DC_NAME deployment config
# in an array
declare -a SSO_DC_VARS=( \
  $(oc set env dc/${SSO_DC_NAME} --list \
  | sed '/^#/d') \
)

# Get the PREFIX used in the names of environment variables
PREFIX=$( \
  grep -oP 'DB_SERVICE_PREFIX_MAPPING=[^ ]+' \
  &lt;&lt;&lt; "${SSO_DC_VARS[@]}" \
)
PREFIX=${PREFIX##*=}

# Substitute:
# * &lt;&lt;PREFIX&gt;&gt; with actual $PREFIX value and
# * &lt;&lt;PREFIX with "&lt;&lt;$PREFIX" value
# The order in which these replacements are made is important!
sed -i "s#&lt;&lt;PREFIX&gt;&gt;#${PREFIX}#g" ${JOB_MIGRATION_YAML}
sed -i "s#&lt;&lt;PREFIX#&lt;&lt;${PREFIX}#g" ${JOB_MIGRATION_YAML}

# Construct the array of environment variables
# specific to the datasource
declare -a DB_VARS=(JNDI USERNAME PASSWORD DATABASE)

# Prepend $PREFIX to each item of the datasource array
DB_VARS=( "${DB_VARS[@]/#/${PREFIX}_}" )

# Add DB_SERVICE_PREFIX_MAPPING and TX_DATABASE_PREFIX_MAPPING
# variables to datasource array
DB_VARS=( \
  "${DB_VARS[@]}" \
  DB_SERVICE_PREFIX_MAPPING \
  TX_DATABASE_PREFIX_MAPPING \
)

# Construct the SERVICE from DB_SERVICE_PREFIX_MAPPING
SERVICE=$( \
  grep -oP 'DB_SERVICE_PREFIX_MAPPING=[^ ]' \
  &lt;&lt;&lt; "${SSO_DC_VARS[@]}" \
)
SERVICE=${SERVICE#*=}
SERVICE=${SERVICE%=*}
SERVICE=${SERVICE^^}
SERVICE=${SERVICE//-/_}

# If the deployment config contains &lt;&lt;SERVICE&gt;&gt;_SERVICE_HOST
# and &lt;&lt;SERVICE&gt;&gt;_SERVICE_PORT variables, add them to the
# datasource array. Their values also need to be propagated into
# yaml definition of the migration job.
HOST_PATTERN="${SERVICE}_SERVICE_HOST=[^ ]"
PORT_PATTERN="${SERVICE}_SERVICE_PORT=[^ ]"
if
  grep -Pq "${HOST_PATTERN}" &lt;&lt;&lt; "${SSO_DC_VARS[@]}" &amp;&amp;
  grep -Pq "${PORT_PATTERN}" &lt;&lt;&lt; "${SSO_DC_VARS[@]}"
then
  DB_VARS=( \
    "${DB_VARS[@]}" \
    "${SERVICE}_SERVICE_HOST" \
    "${SERVICE}_SERVICE_PORT" \
  )
# If they are not defined, delete their placeholder rows in
# yaml definition file (since if not defined they are not
# expanded which make the yaml definition invalid).
else
  for KEY in "HOST" "PORT"
  do
    sed -i "/SERVICE_${KEY}/d" ${JOB_MIGRATION_YAML}
  done
fi

# Substitute:
# * &lt;&lt;SERVICE_HOST&gt;&gt; with ${SERVICE}_SERVICE_HOST and
# * &lt;&lt;SERVICE_HOST_VALUE&gt;&gt; with &lt;&lt;${SERVICE}_SERVICE_HOST_VALUE&gt;&gt;
# The order in which replacements are made is important!
# Do this for both "HOST" and "PORT"
for KEY in "HOST" "PORT"
do
  PATTERN_1="&lt;&lt;SERVICE_${KEY}&gt;&gt;"
  REPL_1="${SERVICE}_SERVICE_${KEY}"
  sed -i "s#${PATTERN_1}#${REPL_1}#g" ${JOB_MIGRATION_YAML}
  PATTERN_2="&lt;&lt;SERVICE_${KEY}_VALUE&gt;&gt;"
  REPL_2="&lt;&lt;${SERVICE}_SERVICE_${KEY}_VALUE&gt;&gt;"
  sed -i "s#${PATTERN_2}#${REPL_2}#g" ${JOB_MIGRATION_YAML}
done

# Propagate the values of the datasource array items into
# yaml definition of the migration job
for VAR in "${SSO_DC_VARS[@]}"
do
  IFS=$'=' read KEY VALUE &lt;&lt;&lt; $VAR
  if grep -q $KEY &lt;&lt;&lt; ${DB_VARS[@]}
  then
    KEY+="_VALUE"
    # Enwrap integer port value with double quotes
    if [[ ${KEY} =~ ${SERVICE}_SERVICE_PORT_VALUE ]]
    then
      sed -i "s#&lt;&lt;${KEY}&gt;&gt;#\"${VALUE}\"#g" ${JOB_MIGRATION_YAML}
    # Character values do not need quotes
    else
      sed -i "s#&lt;&lt;${KEY}&gt;&gt;#${VALUE}#g" ${JOB_MIGRATION_YAML}
    fi
    # Verify that the value has been successfully propagated.
    if
      grep -q '(JNDI|USERNAME|PASSWORD|DATABASE)' &lt;&lt;&lt; "${KEY}" &amp;&amp;
      grep -q "&lt;&lt;PREFIX${KEY#${PREFIX}}" ${JOB_MIGRATION_YAML} ||
      grep -q "&lt;&lt;${KEY}&gt;&gt;" ${JOB_MIGRATION_YAML}
    then
      echo "Failed to update value of ${KEY%_VALUE}! Aborting."
      exit 1
    else
      printf '%-60s%-40s\n' \
             "Successfully updated ${KEY%_VALUE} to:" \
             "$VALUE"
    fi
  fi
done</code></pre>
<div class="paragraph" id="get-db-credentials"><p>Run the script.</p></div>
<pre class="highlight listingblock"><code class="bash language-bash">$ chmod +x ./mirror_sso_dc_db_vars.sh
$ ./mirror_sso_dc_db_vars.sh
Successfully updated DB_SERVICE_PREFIX_MAPPING to:          sso-postgresql=DB
Successfully updated DB_JNDI to:                            java:jboss/datasources/KeycloakDS
Successfully updated DB_USERNAME to:                        userxOp
Successfully updated DB_PASSWORD to:                        tsWNhQHK
Successfully updated DB_DATABASE to:                        root
Successfully updated TX_DATABASE_PREFIX_MAPPING to:         sso-postgresql=DB</code></pre></li><li><p>Build the Red Hat Single Sign-On 6 database migration image using the <a href="https://github.com/iankko/openshift-examples/tree/KEYCLOAK-8500/sso-manual-db-migration">pre-configured source</a> and wait for the build to finish.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc get is -n openshift | grep sso-cd | cut -d ' ' -f1
redhat-sso-cd-openshift</code></pre>
<pre class="highlight listingblock"><code class="bash language-bash">$ oc new-build redhat-sso-cd-openshift:6~https://github.com/iankko/openshift-examples.git#KEYCLOAK-8500 \
  --context-dir=sso-manual-db-migration \
  --name=sso-cd-db-migration-image
--&gt; Found image bf45ac2 (7 days old) in image stream "openshift/redhat-sso-cd-openshift" under tag "6" for "redhat-sso-cd-openshift:6"

    Red Hat SSO 6
    ---------------
    Platform for running Red Hat SSO

    Tags: sso, sso7, keycloak

    * A source build using source code from https://github.com/iankko/openshift-examples.git#KEYCLOAK-8500 will be created
      * The resulting image will be pushed to image stream "sso-cd-db-migration-image:latest"
      * Use 'start-build' to trigger a new build

--&gt; Creating resources with label build=sso-cd-db-migration-image ...
    imagestream "sso-cd-db-migration-image" created
    buildconfig "sso-cd-db-migration-image" created
--&gt; Success
    Build configuration "sso-cd-db-migration-image" created and build triggered.
    Run 'oc logs -f bc/sso-cd-db-migration-image' to stream the build progress.</code></pre>
<pre class="highlight listingblock"><code class="bash language-bash">$ oc logs -f bc/sso-cd-db-migration-image --follow
Cloning "https://github.com/iankko/openshift-examples.git#KEYCLOAK-8500" ...
...
Push successful</code></pre></li><li><p>Update the template of the database migration job (<code>job-to-migrate-db-to-sso-cd.yaml</code>) with reference to the built <code>sso-cd-db-migration-image</code> image.</p><div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>Get the docker pull reference for the image.</p><pre class="highlight listingblock"><code class="bash language-bash">$ PULL_REF=$(oc get istag -n $(oc project -q) --no-headers | grep sso-cd-db-migration-image | tr -s ' ' | cut -d ' ' -f 2)</code></pre></li><li><p>Replace the &lt;&lt;SSO_IMAGE_VALUE&gt;&gt; field in the job template with the pull specification.</p><pre class="highlight listingblock"><code class="bash language-bash">$ sed -i "s#&lt;&lt;SSO_IMAGE_VALUE&gt;&gt;#$PULL_REF#g" job-to-migrate-db-to-sso-cd.yaml</code></pre></li><li><p>Verify that the field is updated.</p></li></ol></div></li><li><p>Instantiate database migration job from the job template.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc create -f job-to-migrate-db-to-sso-cd.yaml
job "job-to-migrate-db-to-sso-cd" created</code></pre>
<div class="admonitionblock important"><table><tr><td class="icon"><div class="title">Important</div></td><td class="content"><div class="paragraph"><p>The database migration process handles the data schema update and performs manipulation of the data, therefore, stop all pods running the previous version of the Red Hat Single Sign-On for OpenShift image before dynamic generation of the SQL migration file.</p></div></td></tr></table></div></li><li><p>Identify the deployment config used to deploy the containers, running previous version of the Red Hat Single Sign-On for OpenShift image.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc get dc -o name --selector=application=sso
deploymentconfig/sso
deploymentconfig/sso-postgresql</code></pre></li><li><p>Stop all pods running the previous version of the Red Hat Single Sign-On for OpenShift image in the current namespace.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc scale --replicas=0 dc/sso
deploymentconfig "sso" scaled</code></pre></li><li><p>Run the database migration job and wait for the pod to be running correctly.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc get jobs
NAME                            DESIRED   SUCCESSFUL   AGE
job-to-migrate-db-to-sso-cd   1         0            3m</code></pre>
<pre class="highlight listingblock"><code class="bash language-bash">$ oc scale --replicas=1 job/job-to-migrate-db-to-sso-cd
job "job-to-migrate-db-to-sso-cd" scaled</code></pre>
<pre class="highlight listingblock"><code class="bash language-bash">$ oc get pods
NAME                                  READY     STATUS      RESTARTS   AGE
sso-postgresql-1-n5p16                1/1       Running     1          19h
job-to-migrate-db-to-sso-cd-b87bb   1/1       Running     0          1m
sso-cd-db-migration-image-1-build      0/1       Completed   0          27m</code></pre>
<div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><div class="paragraph"><p>By default, the database migration job terminates automatically after <code>600 seconds</code> after the migration file is generated. You can adjust this time period.</p></div></td></tr></table></div></li><li><p>Get the dynamically generated SQL database migration file from the pod.</p><pre class="highlight listingblock"><code class="bash language-bash">$ mkdir -p ./db-update
$ oc rsync job-to-migrate-db-to-sso-cd-b87bb:/opt/eap/keycloak-database-update.sql ./db-update
receiving incremental file list
keycloak-database-update.sql

sent 30 bytes  received 29,726 bytes  59,512.00 bytes/sec
total size is 29,621  speedup is 1.00</code></pre></li><li><p>Inspect the <code>keycloak-database-update.sql</code> file for changes to be performed within manual database update to Red Hat Single Sign-On 6 version.</p></li><li><p>Apply the database update manually.</p><div class="ulist"><ul><li><p>Run the following commands if running some previous version of the Red Hat Single Sign-On for OpenShift image, backed by the PostgreSQL database deployed in ephemeral or persistent mode, running on a separate pod:</p><div class="olist lowerroman"><ol class="lowerroman" type="i"><li><p>Copy the generated SQL migration file to the PostgreSQL pod.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc rsync --no-perms=true ./db-update/ sso-postgresql-1-n5p16:/tmp
sending incremental file list

sent 77 bytes  received 11 bytes  176.00 bytes/sec
total size is 26,333  speedup is 299.24</code></pre></li><li><p>Start a shell session to the PostgreSQL pod.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc rsh sso-postgresql-1-n5p16
sh-4.2$</code></pre></li><li><p>Use the <code>psql</code> tool to apply database update manually.</p><pre class="highlight listingblock"><code class="bash language-bash">sh-4.2$ alias psql="/opt/rh/rh-postgresql95/root/bin/psql"
sh-4.2$ psql --version
psql (PostgreSQL) 9.5.4
sh-4.2$ psql -U &lt;PREFIX&gt;_USERNAME -d &lt;PREFIX&gt;_DATABASE -W -f /tmp/keycloak-database-update.sql
Password for user &lt;PREFIX&gt;_USERNAME:
INSERT 0 1
INSERT 0 1
...</code></pre>
<div class="admonitionblock important"><table><tr><td class="icon"><div class="title">Important</div></td><td class="content"><div class="paragraph"><p>Replace <code>&lt;PREFIX&gt;_USERNAME</code> and <code>&lt;PREFIX&gt;_DATABASE</code> with the actual database credentials retrieved <a href="#get-db-credentials">in previous section</a>. Also use value of <code>&lt;PREFIX&gt;_PASSWORD</code> as the password for the database, when prompted.</p></div></td></tr></table></div></li><li><p>Close the shell session to the PostgreSQL pod. Continue with <a href="#image-change-trigger-update-step">updating image change trigger step</a>.</p></li></ol></div></li><li><p>Run the following commands if running some previous version of the Red Hat Single Sign-On for OpenShift image, backed by the MySQL database deployed in ephemeral or persistent mode, running on a separate pod:</p><div class="olist lowerroman"><ol class="lowerroman" type="i"><li><p>Given the pod situation similar to the following:</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc get pods
NAME                                  READY     STATUS      RESTARTS   AGE
sso-mysql-1-zvhk3                     1/1       Running     0          1h
job-to-migrate-db-to-sso-cd-m202t   1/1       Running     0          11m
sso-cd-db-migration-image-1-build      0/1       Completed   0          13m</code></pre></li><li><p>Copy the generated SQL migration file to the MySQL pod.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc rsync --no-perms=true ./db-update/ sso-mysql-1-zvhk3:/tmp
sending incremental file list
keycloak-database-update.sql

sent 24,718 bytes  received 34 bytes  49,504.00 bytes/sec
total size is 24,594  speedup is 0.99</code></pre></li><li><p>Start a shell session to the MySQL pod.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc rsh sso-mysql-1-zvhk3
sh-4.2$</code></pre></li><li><p>Use the <code>mysql</code> tool to apply database update manually.</p><pre class="highlight listingblock"><code class="bash language-bash">sh-4.2$ alias mysql="/opt/rh/rh-mysql57/root/bin/mysql"
sh-4.2$ mysql --version
/opt/rh/rh-mysql57/root/bin/mysql  Ver 14.14 Distrib 5.7.16, for Linux (x86_64) using  EditLine wrapper
sh-4.2$ mysql -D &lt;PREFIX&gt;_DATABASE -u &lt;PREFIX&gt;_USERNAME -p &lt; /tmp/keycloak-database-update.sql
Enter password:
sh-4.2$ echo $?
0</code></pre>
<div class="admonitionblock important"><table><tr><td class="icon"><div class="title">Important</div></td><td class="content"><div class="paragraph"><p>Replace <code>&lt;PREFIX&gt;_USERNAME</code> and <code>&lt;PREFIX&gt;_DATABASE</code> with the actual database credentials retrieved <a href="#get-db-credentials">in previous section</a>. Also use value of <code>&lt;PREFIX&gt;_PASSWORD</code> as the password for the database, when prompted.</p></div></td></tr></table></div></li><li><p>Close the shell session to the MySQL pod. Continue with <a href="#image-change-trigger-update-step">updating image change trigger step</a>.</p></li></ol></div></li></ul></div></li></ol></div>
<div class="olist arabic" id="image-change-trigger-update-step"><ol class="arabic" start="12"><li><p>Update the image change trigger in the existing deployment config to reference the Red Hat Single Sign-On 6 image.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc patch dc/sso --type=json -p '[{"op": "replace", "path": "/spec/triggers/0/imageChangeParams/from/name", "value": "redhat-sso-cd-openshift:6"}]'
"sso" patched</code></pre></li><li><p>Start rollout of the new Red Hat Single Sign-On 6 images based on the latest image defined in the image change triggers.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc rollout latest dc/sso
deploymentconfig "sso" rolled out</code></pre></li><li><p>Deploy the Red Hat Single Sign-On 6 containers using the modified deployment config.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc scale --replicas=1 dc/sso
deploymentconfig "sso" scaled</code></pre></li></ol></div></section><section id="_example_workflow_migrating_the_red_hat_single_sign_on_servers_database_across_environments"><h2>Example Workflow: Migrating The Red Hat Single Sign-On Server&#8217;s Database Across Environments</h2><div class="paragraph"><p>This tutorial focuses on migrating the Red Hat Single Sign-On server database from one environment to another or migrating to a different database. It assumes steps described in <a href="#Preparing-SSO-Authentication-for-OpenShift-Deployment">Preparing Red Hat Single Sign-On Authentication for OpenShift Deployment</a> section have been performed already.</p></div>
<h3>Deploying the Red Hat Single Sign-On MySQL Application Template</h3><div class="olist arabic"><ol class="arabic"><li><p>Log in to the OpenShift web console and select the <em>sso-app-demo</em> project space.</p></li><li><p>Click <strong>Add to project</strong> to list the default image streams and templates.</p></li><li><p>Use the <strong>Filter by keyword</strong> search bar to limit the list to those that match <em>sso</em>. You may need to click <strong>See all</strong> to show the desired application template.</p></li><li><p>Select <strong><em>sso-cd-mysql</em></strong> Red Hat Single Sign-On application template. When deploying the template ensure to <strong>keep the <em>SSO_REALM</em> variable unset</strong> (default value).</p><div class="admonitionblock important"><table><tr><td class="icon"><div class="title">Important</div></td><td class="content"><div class="paragraph"><p>Export and import of Red Hat Single Sign-On 6 database <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html-single/server_administration_guide/#export_import">is triggered at Red Hat Single Sign-On server boot time and its paramaters are passed in via Java system properties.</a> This means during one Red Hat Single Sign-On server boot only one of the possible migration actions (either <strong><em>export</em></strong>, or <strong><em>import</em></strong>) can be performed.</p></div></td></tr></table></div>
<div class="admonitionblock warning"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content"><div class="paragraph"><p>When the <strong><em>SSO_REALM</em></strong> configuration variable is set on the Red Hat Single Sign-On for OpenShift image, a database import is performed in order to create the Red Hat Single Sign-On server realm requested in the variable. For the database export to be performed correctly, the <strong><em>SSO_REALM</em></strong> configuration variable cannot be simultaneously defined on such image.</p></div></td></tr></table></div></li><li><p>Click <strong>Create</strong> to deploy the application template and start pod deployment. This may take a couple of minutes.</p><div class="paragraph"><p>Then access the Red Hat Single Sign-On web console at <strong>https://secure-sso-<em>&lt;sso-app-demo&gt;</em>.<em>&lt;openshift32.example.com&gt;</em>/auth/admin</strong> using the <a href="#sso-administrator-setup">administrator account</a>.</p></div>
<div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><div class="paragraph"><p>This example workflow uses a self-generated CA to provide an end-to-end workflow for demonstration purposes. Accessing the Red Hat Single Sign-On web console will prompt an insecure connection warning.<br>
For production environments, Red Hat recommends that you use an SSL certificate purchased from a verified Certificate Authority.</p></div></td></tr></table></div></li></ol></div>
<h3>(Optional) Creating additional Red Hat Single Sign-On <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html-single/server_administration_guide/#core_concepts_and_terms">realm and users</a> to be also exported</h3><div class="paragraph"><p>When performing <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html-single/server_administration_guide/#export_import">Red Hat Single Sign-On 6 server database export</a> only Red Hat Single Sign-On realms and users currently present in the database will be exported. If the exported JSON file should include also additional Red Hat Single Sign-On realms and users, these need to be created first:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p><a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html-single/server_administration_guide/#create-realm">Create a new realm</a></p></li><li><p><a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html-single/server_administration_guide/#create-new-user">Create new users</a></p></li></ol></div>
<div class="paragraph"><p>Upon their creation <a href="#sso-export-the-database">the database can be exported.</a></p></div>
<h3>Export the Red Hat Single Sign-On database as a JSON file on the OpenShift pod</h3><div class="olist arabic"><ol class="arabic"><li><p>Get the Red Hat Single Sign-On deployment config and scale it down to zero.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc get dc -o name
deploymentconfig/sso
deploymentconfig/sso-mysql

$ oc scale --replicas=0 dc sso
deploymentconfig "sso" scaled</code></pre></li><li><p>Instruct the Red Hat Single Sign-On 6 server deployed on Red Hat Single Sign-On for OpenShift image to perform database export at Red Hat Single Sign-On server boot time.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc set env dc/sso \
  -e "JAVA_OPTS_APPEND= \
    -Dkeycloak.migration.action=export \
    -Dkeycloak.migration.provider=singleFile \
    -Dkeycloak.migration.file=/tmp/demorealm-export.json"</code></pre></li><li><p>Scale the Red Hat Single Sign-On deployment config back up. This will start the Red Hat Single Sign-On server and export its database.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc scale --replicas=1 dc sso
deploymentconfig "sso" scaled</code></pre></li><li><p>(Optional) Verify that the export was successful.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc get pods
NAME                READY     STATUS    RESTARTS   AGE
sso-4-ejr0k         1/1       Running   0          27m
sso-mysql-1-ozzl0   1/1       Running   0          4h

$ oc logs sso-4-ejr0k | grep 'Export'
09:24:59,503 INFO  [org.keycloak.exportimport.singlefile.SingleFileExportProvider] (ServerService Thread Pool -- 57) Exporting model into file /tmp/demorealm-export.json
09:24:59,998 INFO  [org.keycloak.services] (ServerService Thread Pool -- 57) KC-SERVICES0035: Export finished successfully</code></pre></li></ol></div>
<h3>Retrieve and import the exported JSON file</h3><div class="olist arabic"><ol class="arabic"><li><p>Retrieve the JSON file of the Red Hat Single Sign-On database from the pod.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc get pods
NAME                READY     STATUS    RESTARTS   AGE
sso-4-ejr0k         1/1       Running   0          2m
sso-mysql-1-ozzl0   1/1       Running   0          4h

$ oc rsync sso-4-ejr0k:/tmp/demorealm-export.json .</code></pre></li><li><p>(Optional) Import the JSON file of the Red Hat Single Sign-On database into an Red Hat Single Sign-On server running in another environment.</p><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><div class="paragraph"><p>For importing into an Red Hat Single Sign-On server not running on OpenShift, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html/server_administration_guide/export_import">Export and Import section</a> of the RH SSO Server Administration Guide.</p></div></td></tr></table></div>
<div class="paragraph"><p>Use the <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html-single/server_administration_guide/#admin_console_export_import">administration console</a> of the Red Hat Single Sign-On server to import the resources from previously exported JSON file into the Red Hat Single Sign-On server&#8217;s database, when the Red Hat Single Sign-On server is running as a Red Hat Single Sign-On 6 container on OpenShift:</p></div>
<div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>Log into the <code>master</code> realm&#8217;s administration console of the Red Hat Single Sign-On server using the credentials used to create the administrator user. In the browser, navigate to <strong>http://sso-&lt;project-name&gt;.&lt;hostname&gt;/auth/admin</strong>  for the Red Hat Single Sign-On web server, or to <strong>https://secure-sso-&lt;project-name&gt;.&lt;hostname&gt;/auth/admin</strong> for the encrypted Red Hat Single Sign-On web server.</p></li><li><p>At the top of the sidebar choose the name of the Red Hat Single Sign-On realm, the users, clients, realm roles, and client roles should be imported to. This example uses <code>master</code> realm.</p></li><li><p>Click the <strong>Import</strong> link under <strong>Manage</strong> section at the bottom of the sidebar.</p></li><li><p>In the page that opens, click <strong>Select file</strong> and then specify the location of the exported <code>demorealm-export.json</code> JSON file on the local file system.</p></li><li><p>From the <strong>Import from realm</strong> drop-down menu, select the name of the Red Hat Single Sign-On realm from which the data should be imported. This example uses <code>master</code> realm.</p></li><li><p>Choose which of users, clients, realm roles, and client roles should be imported (all of them are imported by default).</p></li><li><p>Choose a strategy to perform, when a resource already exists (one of <strong>Fail</strong>, <strong>Skip</strong>, or <strong>Overwrite</strong>).</p><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><div class="paragraph"><p>The attempt to import an object (user, client, realm role, or client role) fails if object with the same identifier already exists in the current database. Use <strong>Skip</strong> strategy to import the objects that are present in the <code>demorealm-export.json</code> file, but do not exist in current database.</p></div></td></tr></table></div></li><li><p>Click <strong>Import</strong> to perform the import.</p><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><div class="paragraph"><p>When importing objects from a non-master realm to <code>master</code> realm or vice versa, after clicking the <strong>Import</strong> button, it is sometimes possible to encounter an error like the following one:</p></div>
<div class="paragraph text-center" id="realm-import-error-message"><p><span class="image"><img src="images/import_realm_error.png" alt="Example of Possible Error Message when Performing Partial Import from Previously Exported JSON File"></span></p></div>
<div class="paragraph"><p>In such cases, it is necessary first to create the missing clients, having the <strong>Access Type</strong> set to <strong>bearer-only</strong>. These clients can be created by manual copy of their characteristics from the source Red Hat Single Sign-On server, on which the export JSON file was created, to the target Red Hat Single Sign-On server, where the JSON file is imported. After creation of the necessary clients, click the <strong>Import</strong> button again.</p></div>
<div class="paragraph"><p>To suppress the <a href="#realm-import-error-message">above</a> error message, it is needed to create the missing <code>realm-management</code> client, of the <strong>bearer-only</strong> <strong>Access Type</strong>, and click the <strong>Import</strong> button again.</p></div></td></tr></table></div>
<div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><div class="paragraph"><p>For <strong>Skip</strong> import strategy, the newly added objects are marked as <strong>ADDED</strong> and the object which were skipped are marked as <strong>SKIPPED</strong>, in the <strong>Action</strong> column on the import result page.</p></div></td></tr></table></div>
<div class="admonitionblock important"><table><tr><td class="icon"><div class="title">Important</div></td><td class="content"><div class="paragraph"><p>The administration console import allows you to <strong>overwrite</strong> resources if you choose (<strong>Overwrite</strong> strategy). On a production system use this feature with caution.</p></div></td></tr></table></div></li></ol></div></li></ol></div></section><section id="OSE-SSO-AUTH-TUTE"><h2>Example Workflow: Configuring OpenShift to use Red Hat Single Sign-On for Authentication</h2><div class="paragraph"><p>Configure OpenShift to use the Red Hat Single Sign-On deployment as the authorization gateway for OpenShift. This follows on from <a href="#Example-Deploying-SSO">Example Workflow: Preparing and Deploying the Red Hat Single Sign-On for OpenShift image</a>, in which Red Hat Single Sign-On was deployed on OpenShift.</p></div>
<div class="paragraph"><p>This example adds Red Hat Single Sign-On as an authentication method alongside <a href="https://docs.openshift.com/container-platform/latest/install_config/configuring_authentication.html#identity-providers-configuring">the identity providers</a> configured during <a href="https://docs.openshift.com/container-platform/latest/install/index.html">the installation of the OpenShift Container Platform cluster</a>. Once configured, the Red Hat Single Sign-On method will be also available (together with the configured identity providers) for the user login to your OpenShift web console.</p></div>
<h3>Configuring Red Hat Single Sign-On Credentials</h3><div class="paragraph"><p>Log in to the encrypted Red Hat Single Sign-On web server at <strong>https://secure-sso-<em>sso-app-demo</em>.<em>openshift32.example.com</em>/auth/admin</strong> using the <a href="#sso-administrator-setup">administrator account</a> created during the Red Hat Single Sign-On deployment.</p></div>
<div class="paragraph"><p><strong>Create a Realm</strong></p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Hover your cursor over the realm namespace (default is <strong>Master</strong>) at the top of the sidebar and click <strong>Add Realm</strong>.</p></li><li><p>Enter a realm name (this example uses <em>OpenShift</em>) and click <strong>Create</strong>.</p></li></ol></div>
<div class="paragraph"><p><strong>Create a User</strong></p></div>
<div class="paragraph"><p>Create a test user that can be used to demonstrate the Red Hat Single Sign-On-enabled OpenShift login:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Click <strong>Users</strong> in the <strong>Manage</strong> sidebar to view the user information for the realm.</p></li><li><p>Click <strong>Add User</strong>.</p></li><li><p>Enter a valid <strong>Username</strong> (this example uses <em>testuser</em>) and any additional optional information and click <strong>Save</strong>.</p></li><li><p>Edit the user configuration:</p><div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>Click the <strong>Credentials</strong> tab in the user space and enter a password for the user.</p></li><li><p>Ensure the <strong>Temporary Password</strong> option is set to <strong>Off</strong> so that it does not prompt for a password change later on, and click <strong>Reset Password</strong> to set the user password. A pop-up window prompts for additional confirmation.</p></li></ol></div></li></ol></div>
<div class="paragraph"><p><strong>Create and Configure an OpenID-Connect Client</strong></p></div>
<div class="paragraph"><p>See the <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html-single/server_administration_guide/#clients">Managing Clients</a> chapter of the Red Hat Single Sign-On Server Administration Guide for more information.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Click <strong>Clients</strong> in the <strong>Manage</strong> sidebar and click <strong>Create</strong>.</p></li><li><p>Enter the <strong>Client ID</strong>. This example uses <em>openshift-demo</em>.</p></li><li><p>Select a <strong>Client Protocol</strong> from the drop-down menu (this example uses <strong>openid-connect</strong>) and click <strong>Save</strong>. You will be taken to the configuration <strong>Settings</strong> page of the <em>openshift-demo</em> client.</p></li><li><p>From the <strong>Access Type</strong> drop-down menu, select <strong>confidential</strong>. This is the access type for server-side applications.</p></li><li><p>In the <strong>Valid Redirect URIs</strong> dialog, enter the URI for the OpenShift web console, which is <em>https://openshift.example.com:8443/*</em> in this example.</p></li></ol></div>
<div class="paragraph"><p>The client <strong>Secret</strong> is needed to configure OpenID-Connect on the OpenShift master in the next section. You can copy it now from under the <strong>Credentials</strong> tab. The secret is &lt;<em>7b0384a2-b832-16c5-9d73-2957842e89h7</em>&gt; for this example.</p></div>
<h3>Configuring OpenShift Master for Red Hat Single Sign-On Authentication</h3><div class="paragraph"><p>Log in to the OpenShift master CLI. You must have the required permissions to edit the <strong>/etc/origin/master/master-config.yaml</strong> file.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Edit the <strong>/etc/origin/master/master-config.yaml</strong> file and find the <strong>identityProviders</strong>. For example, in the case the OpenShift master is configured with the <a href="https://docs.openshift.com/container-platform/latest/install_config/configuring_authentication.html#HTPasswdPasswordIdentityProvider">HTPassword identity provider</a>, the <strong>identityProviders</strong> section will look similar to the following one:</p><pre class="highlight listingblock"><code class="bash language-bash">identityProviders:
- challenge: true
  login: true
  name: htpasswd_auth
  provider:
    apiVersion: v1
    file: /etc/origin/openshift-passwd
    kind: HTPasswdPasswordIdentityProvider</code></pre>
<div class="paragraph"><p>Add Red Hat Single Sign-On as a secondary identity provider with content similar to the following snippet:</p></div>
<pre class="highlight listingblock"><code class="bash language-bash">- name: rh_sso
  challenge: false
  login: true
  mappingMethod: add
  provider:
    apiVersion: v1
    kind: OpenIDIdentityProvider
    clientID: <em>openshift-demo</em>
    clientSecret: <em>7b0384a2-b832-16c5-9d73-2957842e89h7</em>
    <em>ca: xpaas.crt</em>
    urls:
      authorize: <em>https://secure-sso-sso-app-demo.openshift32.example.com/auth/realms/OpenShift/protocol/openid-connect/auth</em>
      token: <em>https://secure-sso-sso-app-demo.openshift32.example.com/auth/realms/OpenShift/protocol/openid-connect/token</em>
      userInfo: <em>https://secure-sso-sso-app-demo.openshift32.example.com/auth/realms/OpenShift/protocol/openid-connect/userinfo</em>
    claims:
      id:
      - sub
      preferredUsername:
      - preferred_username
      name:
      - name
      email:
      - email</code></pre>
<div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>The Red Hat Single Sign-On <strong>Secret</strong> hash for the <strong>clientSecret</strong> can be found in the Red Hat Single Sign-On web console: <strong>Clients</strong> &#8594; <strong><em>openshift-demo</em></strong> &#8594; <strong>Credentials</strong></p></li><li><p>The endpoints for the <strong>urls</strong> can be found by making a request with the Red Hat Single Sign-On application. For example:</p><pre class="highlight listingblock"><code class="bash language-bash">&lt;<em>curl -k https://secure-sso-sso-app-demo.openshift32.example.com/auth/realms/OpenShift/.well-known/openid-configuration | python -m json.tool</em>&gt;</code></pre>
<div class="paragraph"><p>The response includes the <strong>authorization_endpoint</strong>, <strong>token_endpoint</strong>, and <strong>userinfo_endpoint</strong>.</p></div></li><li><p>This example workflow uses a self-generated CA to provide an end-to-end workflow for demonstration purposes. For this reason, the <strong>ca</strong> is provided as &lt;<em>ca: xpaas.crt</em>&gt;. This CA certificate must also be copied into the <strong>/etc/origin/master</strong> folder. This is not necessary if using a certificate purchased from a verified Certificate Authority.</p></li></ol></div></li><li><p>Save the configuration and restart the OpenShift master:</p><pre class="highlight listingblock"><code class="bash language-bash">$ systemctl restart atomic-openshift-master</code></pre></li></ol></div>
<h3>Logging in to OpenShift</h3><div class="paragraph"><p>Navigate to the OpenShift web console, which in this example is <em><a href="https://openshift.example.com:8443/console" class="bare">https://openshift.example.com:8443/console</a></em>. The OpenShift login page now has the option to use either <strong>htpasswd_auth</strong> or <strong>rh-sso</strong>. The former is still available because it is present in the <strong>/etc/origin/master/master-config.yaml</strong>.</p></div>
<div class="paragraph"><p>Select <strong>rh-sso</strong> and log in to OpenShift with the <em>testuser</em> user created earlier in Red Hat Single Sign-On. No projects are visible to <em>testuser</em> until they are added in the OpenShift CLI. This is the only way to provide user privileges in OpenShift because it currently does not accept external role mapping.</p></div>
<div class="paragraph"><p>To provide <em>testuser</em> <code>view</code> privileges for the <em>sso-app-demo</em>, use the OpenShift CLI:</p></div>
<pre class="highlight listingblock"><code class="bash language-bash">$ oc adm policy add-role-to-user view testuser -n sso-app-demo</code></pre></section><section id="binary-builds"><h2>Example Workflow: Creating OpenShift Application from Existing Maven Binaries and Securing it Using Red Hat Single Sign-On</h2><div class="paragraph"><p>To deploy existing applications on OpenShift, you can use the <a href="https://docs.openshift.com/container-platform/latest/dev_guide/builds/build_inputs.html#binary-source">binary source</a> capability.</p></div>
<h3>Deploy Binary Build of EAP 6.4 / 7.1 JSP Service Invocation Application and Secure it Using Red Hat Single Sign-On</h3><div class="paragraph"><p>The following example uses both <a href="https://github.com/keycloak/keycloak-quickstarts/tree/latest/app-jee-jsp">app-jee-jsp</a> and <a href="https://github.com/keycloak/keycloak-quickstarts/tree/latest/service-jee-jaxrs">service-jee-jaxrs</a> quickstarts to deploy EAP 6.4 / 7.1 JSP service application that authenticates using the Red Hat Single Sign-On.</p></div>
<div class="paragraph"><p><strong>Prerequisite:</strong></p></div>
<div class="admonitionblock important"><table><tr><td class="icon"><div class="title">Important</div></td><td class="content"><div class="paragraph"><p>This guide assumes the Red Hat Single Sign-On for OpenShift image has been previously <a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_middleware_for_openshift/3/html-single/red_hat_single_sign-on_for_openshift/index#Example-Deploying-SSO">deployed using one of the following templates:</a></p></div>
<div class="ulist"><ul><li><p><strong><em>sso-cd-mysql</em></strong></p></li><li><p><strong><em>sso-cd-mysql-persistent</em></strong></p></li><li><p><strong><em>sso-cd-postgresql</em></strong></p></li><li><p><strong><em>sso-cd-postgresql-persistent</em></strong></p></li><li><p><strong><em>sso-cd-x509-mysql-persistent</em></strong></p></li><li><p><strong><em>sso-cd-x509-postgresql-persistent</em></strong></p></li></ul></div></td></tr></table></div>
<h4>Create Red Hat Single Sign-On Realm, Roles, and User for the EAP 6.4 / 7.1 JSP Application</h4><div class="paragraph"><p>The EAP 6.4 / 7.1 JSP service application requires dedicated Red Hat Single Sign-On realm, username, and password to be able to authenticate using Red Hat Single Sign-On. Perform the following steps after the Red Hat Single Sign-On for OpenShift image has been deployed:</p></div>
<div class="paragraph"><p><strong>Create the Red Hat Single Sign-On Realm</strong></p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Login to the administration console of the Red Hat Single Sign-On server.</p><div class="paragraph"><p><strong>https://secure-sso-sso-app-demo.openshift.example.com/auth/admin</strong></p></div>
<div class="paragraph"><p>Use the <a href="#sso-administrator-setup">credentials of the Red Hat Single Sign-On administrator user</a>.</p></div></li><li><p>Hover your cursor over the realm namespace (default is <strong>Master</strong>) at the top of the sidebar and click <strong>Add Realm</strong>.</p></li><li><p>Enter a realm name (this example uses <code>demo</code>) and click <strong>Create</strong>.</p></li></ol></div>
<div class="paragraph" id="copy-rsa-public-key"><p><strong>Copy the Public Key</strong></p></div>
<div class="paragraph"><p>In the newly created <code>demo</code> realm, click the <strong>Keys</strong> tab, then select <strong>Active</strong> tab, and copy the public key of type <strong>RSA</strong> that has been generated.</p></div>
<div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><div class="paragraph"><p>The Red Hat Single Sign-On for OpenShift image version 6 generates multiple keys by default, for example <strong>HS256</strong>, <strong>RS256</strong>, or <strong>AES</strong>. To copy the public key information for the Red Hat Single Sign-On for OpenShift 6 image, click the <strong>Keys</strong> tab, then select <strong>Active</strong> tab, and click the <strong>Public key</strong> button of that row in the keys table, where type of the key matches <strong>RSA</strong>. Then select and copy the content of the pop-up window that appears.</p></div></td></tr></table></div>
<div class="paragraph"><p>The information about the public key is necessary <a href="#sso-public-key-details">later to deploy</a> the Red Hat Single Sign-On-enabled EAP 6.4 / 7.1 JSP application.</p></div>
<div class="paragraph"><p><strong>Create Red Hat Single Sign-On Roles</strong></p></div>
<div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><div class="paragraph"><p>The <a href="https://github.com/keycloak/keycloak-quickstarts/tree/latest/service-jee-jaxrs">service-jee-jaxrs</a> quickstart exposes three endpoints by the service:</p></div>
<div class="ulist"><ul><li><p><code>public</code> - Requires no authentication.</p></li><li><p><code>secured</code> - Can be invoked by users with the <code>user</code> role.</p></li><li><p><code>admin</code> - Can be invoked by users with the <code>admin</code> role.</p></li></ul></div></td></tr></table></div>
<div class="paragraph"><p>Create <code>user</code> and <code>admin</code> roles in Red Hat Single Sign-On. These roles will be assigned to an Red Hat Single Sign-On application user to authenticate access to user applications.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Click <strong>Roles</strong> in the <strong>Configure</strong> sidebar to list the roles for this realm.</p><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><div class="paragraph"><p>This is a new realm, so there should only be the default (<code>offline_access</code> and <code>uma_authorization</code>) roles.</p></div></td></tr></table></div></li><li><p>Click <strong>Add Role</strong>.</p></li><li><p>Enter the role name (<code>user</code>) and click <strong>Save</strong>.</p></li></ol></div>
<div class="paragraph"><p>Repeat these steps for the <code>admin</code> role.</p></div>
<div class="paragraph"><p><strong>Create the Red Hat Single Sign-On Realm Management User</strong></p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Click <strong>Users</strong> in the <strong>Manage</strong> sidebar to view the user information for the realm.</p></li><li><p>Click <strong>Add User.</strong></p></li><li><p>Enter a valid <strong>Username</strong> (this example uses the user <code>appuser</code>) and click <strong>Save</strong>.</p></li><li><p>Edit the user configuration:</p><div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>Click the <strong>Credentials</strong> tab in the user space and enter a password for the user (this example uses the password <code>apppassword</code>).</p></li><li><p>Ensure the <strong>Temporary Password</strong> option is set to <strong>Off</strong> so that it does not prompt for a password change later on, and click <strong>Reset Password</strong> to set the user password. A pop-up window will prompt you to confirm.</p></li></ol></div></li></ol></div>
<h4>Assign <code>user</code> Red Hat Single Sign-On Role to the Realm Management User</h4><div class="paragraph"><p>Perform the following steps to tie the previously created <code>appuser</code> with the <code>user</code> Red Hat Single Sign-On role:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Click <strong>Role Mappings</strong> to list the realm and client role configuration. In <strong>Available Roles</strong>, select the <code>user</code> role created earlier, and click <strong>Add selected&gt;</strong>.</p></li><li><p>Click <strong>Client Roles</strong>, select <strong>realm-management</strong> entry from the list, select each record in the <strong>Available Roles</strong> list.</p><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><div class="paragraph"><p>You can select multiple items at once by holding the <strong>Ctrl</strong> key and simultaneously clicking the first <code>impersonation</code> entry. While keeping the <strong>Ctrl</strong> key and the left mouse button pressed, move to the end of the list to the <code>view-clients</code> entry and ensure each record is selected.</p></div></td></tr></table></div></li><li><p>Click <strong>Add selected&gt;</strong> to assign the roles to the client.</p></li></ol></div>
<h4>Prepare Red Hat Single Sign-On Authentication for OpenShift Deployment of the EAP 6.4 / 7.1 JSP Application</h4><div class="olist arabic"><ol class="arabic"><li><p>Create a new project for the EAP 6.4 / 7.1 JSP application.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc new-project eap-app-demo</code></pre></li><li><p>Add the <code>view</code> role to the <a href="https://docs.openshift.com/container-platform/latest/dev_guide/service_accounts.html#default-service-accounts-and-roles"><code>default</code></a> service account. This enables the service account to view all the resources in the <code>eap-app-demo</code> namespace, which is necessary for managing the cluster.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc policy add-role-to-user view system:serviceaccount:$(oc project -q):default</code></pre></li><li><p>The EAP template requires an <a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_middleware_for_openshift/3/html-single/red_hat_single_sign-on_for_openshift/index#Configuring-Keystores">SSL keystore and a JGroups keystore</a>. This example uses <code>keytool</code>, a package included with the Java Development Kit, to generate self-signed certificates for these keystores.</p><div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>Generate a secure key for the SSL keystore (this example uses <code>password</code> as password for the keystore).</p><pre class="highlight listingblock"><code class="bash language-bash">$ keytool -genkeypair \
-dname "CN=secure-eap-app-eap-app-demo.openshift.example.com" \
-alias https \
-storetype JKS \
-keystore eapkeystore.jks</code></pre></li><li><p>Generate a secure key for the JGroups keystore (this example uses <code>password</code> as password for the keystore).</p><pre class="highlight listingblock"><code class="bash language-bash">$ keytool -genseckey \
-alias jgroups \
-storetype JCEKS \
-keystore eapjgroups.jceks</code></pre></li><li><p>Generate the EAP 6.4 / 7.1 for OpenShift secrets with the SSL and JGroup keystore files.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc secret new eap-ssl-secret eapkeystore.jks</code></pre>
<pre class="highlight listingblock"><code class="bash language-bash">$ oc secret new eap-jgroup-secret eapjgroups.jceks</code></pre></li><li><p>Add the EAP application secret to the <a href="https://docs.openshift.com/container-platform/latest/dev_guide/service_accounts.html#default-service-accounts-and-roles"><code>default</code></a> service account.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc secrets link default eap-ssl-secret eap-jgroup-secret</code></pre></li></ol></div></li></ol></div>
<h4>Deploy Binary Build of the EAP 6.4 / 7.1 JSP Application</h4><div class="olist arabic"><ol class="arabic"><li><p>Clone the source code.</p><pre class="highlight listingblock"><code class="bash language-bash">$ git clone https://github.com/keycloak/keycloak-quickstarts.git</code></pre></li><li><p><a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.1/html-single/development_guide/#use_the_maven_repository">Configure</a> the <a href="https://access.redhat.com/maven-repository">Red Hat JBoss Middleware Maven repository</a>.</p></li><li><p>Build both the <a href="https://github.com/keycloak/keycloak-quickstarts/tree/latest/service-jee-jaxrs">service-jee-jaxrs</a> and <a href="https://github.com/keycloak/keycloak-quickstarts/tree/latest/app-jee-jsp">app-jee-jsp</a> applications.</p><div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>Build the <code>service-jee-jaxrs</code> application.</p><pre class="highlight listingblock"><code class="bash language-bash">$ cd keycloak-quickstarts/service-jee-jaxrs/</code></pre>
<pre class="highlight listingblock"><code class="bash language-bash">$ mvn clean package -DskipTests
[INFO] Scanning for projects...
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] Building Keycloak Quickstart: service-jee-jaxrs 3.1.0.Final
[INFO] ------------------------------------------------------------------------
...
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 2.153 s
[INFO] Finished at: 2017-06-26T12:06:12+02:00
[INFO] Final Memory: 25M/241M
[INFO] ------------------------------------------------------------------------</code></pre></li><li><p><strong>Comment out</strong> the <code>app-jee-jsp/config/keycloak.json</code> requirement of the <code>maven-enforcer-plugin</code> plugin and build the <code>app-jee-jsp</code> application.</p><pre class="highlight listingblock"><code class="bash language-bash">service-jee-jaxrs]$ cd ../app-jee-jsp/</code></pre>
<pre class="highlight listingblock"><code class="bash language-bash">app-jee-jsp]$ sed -i /\&lt;executions\&gt;/s/^/\&lt;\!--/ pom.xml</code></pre>
<pre class="highlight listingblock"><code class="bash language-bash">app-jee-jsp]$ sed -i '/\(&lt;\/executions&gt;\)/a\--&gt;' pom.xml</code></pre>
<pre class="highlight listingblock"><code class="bash language-bash">app-jee-jsp]$ mvn clean package -DskipTests
[INFO] Scanning for projects...
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] Building Keycloak Quickstart: app-jee-jsp 3.1.0.Final
[INFO] ------------------------------------------------------------------------
...
[INFO] Building war: /tmp/github/keycloak-quickstarts/app-jee-jsp/target/app-jsp.war
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 3.018 s
[INFO] Finished at: 2017-06-26T12:22:25+02:00
[INFO] Final Memory: 35M/310M
[INFO] ------------------------------------------------------------------------</code></pre>
<div class="admonitionblock important"><table><tr><td class="icon"><div class="title">Important</div></td><td class="content"><div class="paragraph"><p>The <a href="https://github.com/keycloak/keycloak-quickstarts/tree/latest/app-jee-jsp">app-jee-jsp</a> quickstart requires you to configure the adapter, and that the adapter configuration file (<code>keycloak.json</code>) is present in the <code>config/</code> directory in the root of the quickstart to successfully build the quickstart. But since this example configures the adapter later via selected environment variables available for the EAP 6.4 / 7.1 for OpenShift image, it is not necessary to specify the form of <code>keycloak.json</code> adapter configuration file at this moment.</p></div></td></tr></table></div></li></ol></div></li></ol></div>
<div class="olist arabic" id="directory-structure-binary-builds"><ol class="arabic" start="4"><li><p>Prepare the directory structure on the local file system.</p><div class="paragraph"><p>Application archives in the <strong>deployments/</strong> subdirectory of the main binary build directory are copied directly to the <a href="#standard-deployments-directory">standard deployments directory</a> of the image being built on OpenShift. For the application to deploy, the directory hierarchy containing the web application data must be correctly structured.</p></div>
<div class="paragraph"><p>Create the main directory for the binary build on the local file system and <strong>deployments/</strong> subdirectory within it. Copy the previously built WAR archives of both the <strong>service-jee-jaxrs</strong> and <strong>app-jee-jsp</strong> quickstarts to the <strong>deployments/</strong> subdirectory:</p></div>
<pre class="highlight listingblock"><code class="bash language-bash">app-jee-jsp]$ ls
config  pom.xml  README.md  src  target</code></pre>
<pre class="highlight listingblock"><code class="bash language-bash">app-jee-jsp]$ mkdir -p sso-eap7-bin-demo/deployments</code></pre>
<pre class="highlight listingblock"><code class="bash language-bash">app-jee-jsp]$ cp target/app-jsp.war sso-eap7-bin-demo/deployments/</code></pre>
<pre class="highlight listingblock"><code class="bash language-bash">app-jee-jsp]$ cp ../service-jee-jaxrs/target/service.war sso-eap7-bin-demo/deployments/</code></pre>
<pre class="highlight listingblock"><code class="bash language-bash">app-jee-jsp]$ tree sso-eap7-bin-demo/
sso-eap7-bin-demo/
|__ deployments
    |__ app-jsp.war
    |__ service.war

1 directory, 2 files</code></pre>
<div class="admonitionblock note" id="standard-deployments-directory"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><div class="paragraph"><p>The location of the standard deployments directory depends on the underlying base image, that was used to deploy the application. See the following table:</p></div>
<table class="tableblock frame-all grid-all" style="width:100%"><caption class="title">Table 1. Standard Location of the Deployments Directory</caption><colgroup><col style="width:50%"><col style="width:50%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Name of the Underlying Base Image(s)</th><th class="tableblock halign-left valign-top">Standard Location of the Deployments Directory</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">EAP for OpenShift 6.4 and 7.1</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>$JBOSS_HOME/standalone/deployments</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Java S2I for OpenShift</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>/deployments</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">JWS for OpenShift</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>$JWS_HOME/webapps</em></strong></p></td></tr></table></td></tr></table></div></li><li><p>Identify the image stream for EAP 6.4 / 7.1 image.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc get is -n openshift | grep eap | cut -d ' ' -f 1
jboss-eap64-openshift
jboss-eap71-openshift</code></pre></li></ol></div>
<div class="olist arabic" id="eap-new-binary-build"><ol class="arabic" start="6"><li><p>Create new binary build, specifying image stream and application name.</p><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><div class="paragraph"><p>Replace <code>--image-stream=jboss-eap71-openshift</code> parameter with the <code>--image-stream=jboss-eap64-openshift</code> one in the following oc command to deploy the JSP application on top of JBoss EAP 6.4 for OpenShift image.</p></div></td></tr></table></div>
<pre class="highlight listingblock"><code class="bash language-bash">$ oc new-build --binary=true \
--image-stream=jboss-eap71-openshift \
--name=eap-app
--&gt; Found image 31895a4 (3 months old) in image stream "openshift/jboss-eap71-openshift" under tag "latest" for "jboss-eap71-openshift"

    JBoss EAP 7.2
    -------------
    Platform for building and running JavaEE applications on JBoss EAP 7.2

    Tags: builder, javaee, eap, eap7

    * A source build using binary input will be created
      * The resulting image will be pushed to image stream "eap-app:latest"
      * A binary build was created, use 'start-build --from-dir' to trigger a new build

--&gt; Creating resources with label build=eap-app ...
    imagestream "eap-app" created
    buildconfig "eap-app" created
--&gt; Success</code></pre></li><li><p>Start the binary build. Instruct <code>oc</code> executable to use main directory of the binary build we created <a href="#directory-structure-binary-builds">in previous step</a> as the directory containing binary input for the OpenShift build. In the working directory of <strong>app-jee-jsp</strong> issue the following command.</p><pre class="highlight listingblock"><code class="bash language-bash">app-jee-jsp]$ oc start-build eap-app \
--from-dir=./sso-eap7-bin-demo/ \
--follow
Uploading directory "sso-eap7-bin-demo" as binary input for the build ...
build "eap-app-1" started
Receiving source from STDIN as archive ...
Copying all war artifacts from /home/jboss/source/. directory into /opt/eap/standalone/deployments for later deployment...
Copying all ear artifacts from /home/jboss/source/. directory into /opt/eap/standalone/deployments for later deployment...
Copying all rar artifacts from /home/jboss/source/. directory into /opt/eap/standalone/deployments for later deployment...
Copying all jar artifacts from /home/jboss/source/. directory into /opt/eap/standalone/deployments for later deployment...
Copying all war artifacts from /home/jboss/source/deployments directory into /opt/eap/standalone/deployments for later deployment...
'/home/jboss/source/deployments/app-jsp.war' -&gt; '/opt/eap/standalone/deployments/app-jsp.war'
'/home/jboss/source/deployments/service.war' -&gt; '/opt/eap/standalone/deployments/service.war'
Copying all ear artifacts from /home/jboss/source/deployments directory into /opt/eap/standalone/deployments for later deployment...
Copying all rar artifacts from /home/jboss/source/deployments directory into /opt/eap/standalone/deployments for later deployment...
Copying all jar artifacts from /home/jboss/source/deployments directory into /opt/eap/standalone/deployments for later deployment...
Pushing image 172.30.82.129:5000/eap-app-demo/eap-app:latest ...
Pushed 6/7 layers, 86% complete
Pushed 7/7 layers, 100% complete
Push successful</code></pre></li><li><p>Create a new OpenShift application based on the build.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc new-app eap-app
--&gt; Found image 6b13d36 (2 minutes old) in image stream "eap-app-demo/eap-app" under tag "latest" for "eap-app"

    eap-app-demo/eap-app-1:aa2574d9
    -------------------------------
    Platform for building and running JavaEE applications on JBoss EAP 7.2

    Tags: builder, javaee, eap, eap7

    * This image will be deployed in deployment config "eap-app"
    * Ports 8080/tcp, 8443/tcp, 8778/tcp will be load balanced by service "eap-app"
      * Other containers can access this service through the hostname "eap-app"

--&gt; Creating resources ...
    deploymentconfig "eap-app" created
    service "eap-app" created
--&gt; Success
    Run 'oc status' to view your app.</code></pre></li><li><p>Stop all running containers of the EAP 6.4 / 7.1 JSP application in the current namespace.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc get dc -o name
deploymentconfig/eap-app</code></pre>
<pre class="highlight listingblock"><code class="bash language-bash">$ oc scale dc/eap-app --replicas=0
deploymentconfig "eap-app" scaled</code></pre></li><li><p>Further configure the EAP 6.4 / 7.1 JSP application prior the deployment.</p><div class="olist loweralpha" id="sso-public-key-details"><ol class="loweralpha" type="a"><li><p>Configure the application with proper details about the Red Hat Single Sign-On server instance.</p><div class="admonitionblock warning"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content"><div class="paragraph"><p>Ensure to replace the value of <strong><em>SSO_PUBLIC_KEY</em></strong> variable below with the actual content of the RSA public key for the <code>demo</code> realm, that has been <a href="#copy-rsa-public-key">copied</a>.</p></div></td></tr></table></div>
<pre class="highlight listingblock"><code class="bash language-bash">$ oc set env dc/eap-app \
-e HOSTNAME_HTTP="eap-app-eap-app-demo.openshift.example.com" \
-e HOSTNAME_HTTPS="secure-eap-app-eap-app-demo.openshift.example.com" \
-e SSO_DISABLE_SSL_CERTIFICATE_VALIDATION="true" \
-e SSO_USERNAME="appuser" \
-e SSO_PASSWORD="apppassword" \
-e SSO_REALM="demo" \
-e SSO_URL="https://secure-sso-sso-app-demo.openshift.example.com/auth" \
-e SSO_PUBLIC_KEY="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAkdhXyKx97oIoO6HwnV/MiX2EHO55Sn+ydsPzbjJevI5F31UvUco9uA8dGl6oM8HrnaWWv+i8PvmlaRMhhl6Xs68vJTEc6d0soP+6A+aExw0coNRp2PDwvzsXVWPvPQg3+iytStxu3Icndx+gC0ZYnxoRqL7rY7zKcQBScGEr78Nw6vZDwfe6d/PQ6W4xVErNytX9KyLFVAE1VvhXALyqEM/EqYGLmpjw5bMGVKRXnhmVo9E88CkFDH8E+aPiApb/gFul1GJOv+G8ySLoR1c8Y3L29F7C81odkVBp2yMm3RVFIGSPTjHqjO/nOtqYIfY4Wyw9mRIoY5SyW7044dZXRwIDAQAB" \
-e SSO_SECRET="0bb8c399-2501-4fcd-a183-68ac5132868d"
deploymentconfig "eap-app" updated</code></pre></li><li><p>Configure the application with details about both the SSL and JGroups keystore.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc set env dc/eap-app \
-e HTTPS_KEYSTORE_DIR="/etc/eap-secret-volume" \
-e HTTPS_KEYSTORE="eapkeystore.jks" \
-e HTTPS_PASSWORD="password" \
-e JGROUPS_ENCRYPT_SECRET="eap-jgroup-secret" \
-e JGROUPS_ENCRYPT_KEYSTORE_DIR="/etc/jgroups-encrypt-secret-volume" \
-e JGROUPS_ENCRYPT_KEYSTORE="eapjgroups.jceks" \
-e JGROUPS_ENCRYPT_PASSWORD="password"
deploymentconfig "eap-app" updated</code></pre></li><li><p>Define OpenShift volumes for both the SSL and JGroups secrets created earlier.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc volume dc/eap-app --add \
--name="eap-keystore-volume" \
--type=secret \
--secret-name="eap-ssl-secret" \
--mount-path="/etc/eap-secret-volume"
deploymentconfig "eap-app" updated</code></pre>
<pre class="highlight listingblock"><code class="bash language-bash">$ oc volume dc/eap-app --add \
--name="eap-jgroups-keystore-volume" \
--type=secret \
--secret-name="eap-jgroup-secret" \
--mount-path="/etc/jgroups-encrypt-secret-volume"
deploymentconfig "eap-app" updated</code></pre></li><li><p>Configure the deployment config of the application to run application pods under the <code>default</code> OpenShift service account (default setting).</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc patch dc/eap-app --type=json \
-p '[{"op": "add", "path": "/spec/template/spec/serviceAccountName", "value": "default"}]'
"eap-app" patched</code></pre></li></ol></div></li><li><p>Deploy container of the EAP 6.4 / 7.1 JSP application using the modified deployment config.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc scale dc/eap-app --replicas=1
deploymentconfig "eap-app" scaled</code></pre></li><li><p>Expose the service as route.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc get svc -o name
service/eap-app</code></pre>
<pre class="highlight listingblock"><code class="bash language-bash">$ oc get route
No resources found.</code></pre>
<pre class="highlight listingblock"><code class="bash language-bash">$ oc expose svc/eap-app
route "eap-app" exposed</code></pre>
<pre class="highlight listingblock"><code class="bash language-bash">$ oc get route
NAME      HOST/PORT                                    PATH      SERVICES   PORT       TERMINATION   WILDCARD
eap-app   eap-app-eap-app-demo.openshift.example.com             eap-app    8080-tcp                 None</code></pre></li></ol></div>
<h4>Access the Application</h4><div class="paragraph"><p>Access the application in your browser using the URL <strong>http://eap-app-eap-app-demo.openshift.example.com/app-jsp</strong>. You should see output like on the following image:</p></div>
<div class="paragraph text-center"><p><span class="image"><img src="images/sso_app_jee_jsp.png" alt="Red Hat Single Sign-On Example JSP Application"></span></p></div>
<div class="paragraph"><p>Perform the following to test the application:</p></div>
<div class="ulist"><ul><li><p>Click the <strong>INVOKE PUBLIC</strong> button to access the <code>public</code> endpoint that doesn&#8217;t require authentication.</p><div class="paragraph"><p>You should see the <strong>Message: public</strong> output.</p></div></li><li><p>Click the <strong>LOGIN</strong> button to be redirected for user authentication to the Red Hat Single Sign-On server instance against the <code>demo</code> realm.</p><div class="paragraph"><p>Specify the username and password of the Red Hat Single Sign-On user configured earlier (<code>appuser</code> / <code>apppassword</code>). Click <strong>Log in</strong>. The look of the application changes as detailed in the following image:</p></div>
<div class="paragraph text-center"><p><span class="image"><img src="images/sso_app_jee_jsp_logged_in.png" alt="sso app jee jsp logged in"></span></p></div></li><li><p>Click the <strong>INVOKE SECURED</strong> button to access the <code>secured</code> endpoint.</p><div class="paragraph"><p>You should see the <strong>Message: secured</strong> output.</p></div></li><li><p>Click the <strong>INVOKE ADMIN</strong> button to access the <code>admin</code> endpoint.</p><div class="paragraph"><p>You should see <strong>403 Forbidden</strong> output.</p></div>
<div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><div class="paragraph"><p>The <code>admin</code> endpoint requires users with <code>admin</code> Red Hat Single Sign-On role to invoke properly. Access for the <code>appuser</code> is forbidden because they only have <code>user</code> role privilege, which allows them to access the <code>secured</code> endpoint.</p></div></td></tr></table></div>
<div class="paragraph"><p>Perform the following steps to add the <code>appuser</code> to the <code>admin</code> Red Hat Single Sign-On role:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Access the administration console of the Red Hat Single Sign-On server&#8217;s instance.</p><div class="paragraph"><p><strong>https://secure-sso-sso-app-demo.openshift.example.com/auth/admin</strong>.</p></div>
<div class="paragraph"><p>Use the <a href="#sso-administrator-setup">credentials of the Red Hat Single Sign-On administrator user</a>.</p></div></li><li><p>Click <strong>Users</strong> in the <strong>Manage</strong> sidebar to view the user information for the <code>demo</code> realm.</p></li><li><p>Click <strong>View all users</strong> button.</p></li><li><p>Click the ID link for the <strong>appuser</strong> or alternatively click the <strong>Edit</strong> button in the <strong>Actions</strong> column.</p></li><li><p>Click the <strong>Role Mappings</strong> tab.</p></li><li><p>Select <code>admin</code> entry from the <strong>Available Roles</strong> list in the <strong>Realm Roles</strong> row.</p></li><li><p>Click <strong>Add selected&gt;</strong> button to add the <code>admin</code> role to the user.</p></li><li><p>Return to EAP 6.4 / 7.1 JSP service application.</p><div class="paragraph"><p><strong>http://eap-app-eap-app-demo.openshift.example.com/app-jsp</strong>.</p></div></li><li><p>Click the <strong>LOGOUT</strong> button to reload role mappings for the <code>appuser</code>.</p></li><li><p>Click the <strong>LOGIN</strong> button again and provider <code>appuser</code> credentials.</p></li><li><p>Click the <strong>INVOKE ADMIN</strong> button again.</p><div class="paragraph"><p>You should see the <strong>Message: admin</strong> output already.</p></div></li></ol></div></li></ul></div></section><section id="Example-EAP-Auto"><h2>Example Workflow: Automatically Registering EAP Application in Red Hat Single Sign-On with OpenID-Connect Client</h2><div class="paragraph"><p>This follows on from <a href="#Example-Deploying-SSO">Example Workflow: Preparing and Deploying the Red Hat Single Sign-On for OpenShift image</a>, in which Red Hat Single Sign-On was deployed on OpenShift. This example prepares Red Hat Single Sign-On realm, role, and user credentials for an EAP project using an OpenID-Connect client adapter. These credentials are then provided in the EAP for OpenShift template for automatic Red Hat Single Sign-On client registration. Once deployed, the Red Hat Single Sign-On user can be used to authenticate and access JBoss EAP.</p></div>
<div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><div class="paragraph"><p>This example uses a OpenID-Connect client but an SAML client could also be used. See <a href="../advanced_concepts/advanced_concepts.html#SSO-Clients">Red Hat Single Sign-On Clients</a> and <a href="../advanced_concepts/advanced_concepts.html#Auto-Man-Client-Reg">Automatic and Manual Red Hat Single Sign-On Client Registration Methods</a> for more information on the differences between OpenID-Connect and SAML clients.</p></div></td></tr></table></div>
<h3>Preparing Red Hat Single Sign-On Authentication for OpenShift Deployment</h3><div class="paragraph"><p>Log in to the OpenShift CLI with a user that holds the <em>cluster:admin</em> role.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Create a new project:</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc new-project eap-app-demo</code></pre></li><li><p>Add the <code>view</code> role to the <a href="https://docs.openshift.com/container-platform/latest/dev_guide/service_accounts.html#default-service-accounts-and-roles"><code>default</code></a> service account. This enables the service account to view all the resources in the <code>eap-app-demo</code> namespace, which is necessary for managing the cluster.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc policy add-role-to-user view system:serviceaccount:$(oc project -q):default</code></pre></li><li><p>The EAP template requires an <a href="#Configuring-Keystores">SSL keystore and a JGroups keystore</a>.<br>
This example uses <code>keytool</code>, a package included with the Java Development Kit, to generate self-signed certificates for these keystores. The following commands will prompt for passwords.<br></p><div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>Generate a secure key for the SSL keystore:</p><pre class="highlight listingblock"><code class="bash language-bash">$ keytool -genkeypair -alias https -storetype JKS -keystore eapkeystore.jks</code></pre></li><li><p>Generate a secure key for the JGroups keystore:</p><pre class="highlight listingblock"><code class="bash language-bash">$ keytool -genseckey -alias jgroups -storetype JCEKS -keystore eapjgroups.jceks</code></pre></li></ol></div></li><li><p>Generate the EAP for OpenShift secrets with the SSL and JGroup keystore files:</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc secret new eap-ssl-secret eapkeystore.jks
$ oc secret new eap-jgroup-secret eapjgroups.jceks</code></pre></li><li><p>Add the EAP secret to the <code>default</code> service account:</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc secrets link default eap-ssl-secret eap-jgroup-secret</code></pre></li></ol></div>
<h3>Preparing the Red Hat Single Sign-On Credentials</h3><div class="paragraph"><p>Log in to the encrypted Red Hat Single Sign-On web server at <strong>https://secure-sso-<em>&lt;project-name&gt;</em>.<em>&lt;hostname&gt;</em>/auth/admin</strong> using the <a href="#sso-administrator-setup">administrator account</a> created during the Red Hat Single Sign-On deployment.</p></div>
<div class="paragraph"><p><strong>Create a Realm</strong></p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Hover your cursor over the realm namespace at the top of the sidebar and click*Add Realm*.</p></li><li><p>Enter a realm name (this example uses <em>eap-demo</em>) and click <strong>Create</strong>.</p></li></ol></div>
<div class="paragraph"><p><strong>Copy the Public Key</strong></p></div>
<div class="paragraph"><p>In the newly created <em>eap-demo</em> realm, click the <strong>Keys</strong> tab and copy the generated public key. This example uses the variable <em>&lt;realm-public-key&gt;</em> for brevity. This is used later to deploy the Red Hat Single Sign-On-enabled JBoss EAP image.</p></div>
<div class="paragraph"><p><strong>Create a Role</strong></p></div>
<div class="paragraph"><p>Create a role in Red Hat Single Sign-On with a name that corresponds to the JEE role defined in the <strong>web.xml</strong> of the example EAP application. This role is assigned to an Red Hat Single Sign-On <em>application user</em> to authenticate access to user applications.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Click <strong>Roles</strong> in the <strong>Configure</strong> sidebar to list the roles for this realm. This is a new realm, so there should only be the default <em>offline_access</em> role.</p></li><li><p>Click <strong>Add Role</strong>.</p></li><li><p>Enter the role name (this example uses the role <em>eap-user-role</em>) and click <strong>Save</strong>.</p></li></ol></div>
<div class="paragraph"><p><strong>Create Users and Assign Roles</strong></p></div>
<div class="paragraph"><p>Create two users:
- Assign the <em>realm management user</em> the <strong>realm-management</strong> roles to handle automatic Red Hat Single Sign-On client registration in the Red Hat Single Sign-On server.
- Assign the <em>application user</em> the JEE role, created in the previous step, to authenticate access to user applications.</p></div>
<div class="paragraph"><p>Create the <em>realm management user</em>:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Click <strong>Users</strong> in the <strong>Manage</strong> sidebar to view the user information for the realm.</p></li><li><p>Click <strong>Add User</strong>.</p></li><li><p>Enter a valid <strong>Username</strong> (this example uses the user <em>eap-mgmt-user</em>) and click <strong>Save</strong>.</p></li><li><p>Edit the user configuration. Click the <strong>Credentials</strong> tab in the user space and enter a password for the user. After the password has been confirmed you can click <strong>Reset Password</strong> to set the user password. A pop-up window prompts for additional confirmation.</p></li><li><p>Click <strong>Role Mappings</strong> to list the realm and client role configuration. In the <strong>Client Roles</strong> drop-down menu, select <strong>realm-management</strong> and add all of the available roles to the user. This provides the user Red Hat Single Sign-On server rights that can be used by the JBoss EAP image to create clients.</p></li></ol></div>
<div class="paragraph"><p>Create the <em>application user</em>:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Click <strong>Users</strong> in the <strong>Manage</strong> sidebar to view the user information for the realm.</p></li><li><p>Click <strong>Add User</strong>.</p></li><li><p>Enter a valid <strong>Username</strong> and any additional optional information for the <em>application user</em> and click <strong>Save</strong>.</p></li><li><p>Edit the user configuration. Click the <strong>Credentials</strong> tab in the user space and enter a password for the user. After the password has been confirmed you can click <strong>Reset Password</strong> to set the user password. A pop-up window prompts for additional confirmation.</p></li><li><p>Click <strong>Role Mappings</strong> to list the realm and client role configuration. In <strong>Available Roles</strong>, add the role created earlier.</p></li></ol></div>
<h3>Deploy the Red Hat Single Sign-On-enabled JBoss EAP Image</h3><div class="olist arabic"><ol class="arabic"><li><p>Return to the OpenShift web console and click <strong>Add to project</strong> to list the default image streams and templates.</p></li><li><p>Use the <strong>Filter by keyword</strong> search bar to limit the list to those that match <em>sso</em>. You may need to click <strong>See all</strong> to show the desired application template.</p></li><li><p>Select the <strong><em>eap71-sso-s2i</em></strong> image to list all of the deployment parameters. Include the following Red Hat Single Sign-On parameters to configure the Red Hat Single Sign-On credentials during the EAP build:</p><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Variable</th><th class="tableblock halign-left valign-top">Example Value</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>APPLICATION_NAME</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>sso</em></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HOSTNAME_HTTPS</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>secure-sample-jsp.eap-app-demo.openshift32.example.com</em></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HOSTNAME_HTTP</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>sample-jsp.eap-app-demo.openshift32.example.com</em></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SOURCE_REPOSITORY_URL</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>https://repository-example.com/developer/application</em></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_URL</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>https://secure-sso-sso-app-demo.openshift32.example.com/auth</em></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_REALM</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>eap-demo</em></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_USERNAME</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>eap-mgmt-user</em></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_PASSWORD</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>password</em></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_PUBLIC_KEY</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;realm-public-key&gt;</em></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_KEYSTORE</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>eapkeystore.jks</em></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_PASSWORD</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>password</em></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_SECRET</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>eap-ssl-secret</em></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_ENCRYPT_KEYSTORE</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>eapjgroups.jceks</em></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_ENCRYPT_PASSWORD</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>password</em></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_ENCRYPT_SECRET</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em>eap-jgroup-secret</em></p></td></tr></table></li><li><p>Click <strong>Create</strong> to deploy the JBoss EAP image.</p></li></ol></div>
<div class="paragraph"><p>It may take several minutes for the JBoss EAP image to deploy.</p></div>
<h3>Log in to the JBoss EAP Server Using Red Hat Single Sign-On</h3><div class="olist arabic"><ol class="arabic"><li><p>Access the JBoss EAP application server and click <strong>Login</strong>. You are redirected to the Red Hat Single Sign-On login.</p></li><li><p>Log in using the Red Hat Single Sign-On user created in the example. You are authenticated against the Red Hat Single Sign-On server and returned to the JBoss EAP application server.</p></li></ol></div></section><section id="Example-EAP-Manual"><h2>Example Workflow: Manually Registering EAP Application in Red Hat Single Sign-On with SAML Client</h2><div class="paragraph"><p>This follows on from <a href="#Example-Deploying-SSO">Example Workflow: Preparing and Deploying the Red Hat Single Sign-On for OpenShift image</a>, in which Red Hat Single Sign-On was deployed on OpenShift.</p></div>
<div class="paragraph"><p>This example prepares Red Hat Single Sign-On realm, role, and user credentials for an EAP project and configures an EAP for OpenShift deployment. Once deployed, the Red Hat Single Sign-On user can be used to authenticate and access JBoss EAP.</p></div>
<div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><div class="paragraph"><p>This example uses a SAML client but an OpenID-Connect client could also be used. See <a href="../advanced_concepts/advanced_concepts.html#SSO-Clients">Red Hat Single Sign-On Clients</a> and <a href="../advanced_concepts/advanced_concepts.html#Auto-Man-Client-Reg">Automatic and Manual Red Hat Single Sign-On Client Registration Methods</a> for more information on the differences between SAML and OpenID-Connect clients.</p></div></td></tr></table></div>
<h3>Preparing the Red Hat Single Sign-On Credentials</h3><div class="paragraph"><p>Log in to the encrypted Red Hat Single Sign-On web server at <strong>https://secure-sso-<em>&lt;project-name&gt;</em>.<em>&lt;hostname&gt;</em>/auth/admin</strong> using the <a href="#sso-administrator-setup">administrator account</a> created during the Red Hat Single Sign-On deployment.</p></div>
<div class="paragraph"><p><strong>Create a Realm</strong></p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Hover your cursor over the realm namespace (default is <strong>Master</strong>) at the top of the sidebar and click <strong>Add Realm</strong>.</p></li><li><p>Enter a realm name (this example uses <em>saml-demo</em>) and click <strong>Create</strong>.</p></li></ol></div>
<div class="paragraph"><p><strong>Copy the Public Key</strong></p></div>
<div class="paragraph"><p>In the newly created <em>saml-demo</em> realm, click the <strong>Keys</strong> tab and copy the generated public key. This example uses the variable <em>realm-public-key</em> for brevity. This is needed later to deploy the Red Hat Single Sign-On-enabled JBoss EAP image.</p></div>
<div class="paragraph"><p><strong>Create a Role</strong></p></div>
<div class="paragraph"><p>Create a role in Red Hat Single Sign-On with a name that corresponds to the JEE role defined in the <strong>web.xml</strong> of the example EAP application. This role will be assigned to an Red Hat Single Sign-On <em>application user</em> to authenticate access to user applications.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Click <strong>Roles</strong> in the <strong>Configure</strong> sidebar to list the roles for this realm. This is a new realm, so there should only be the default <em>offline_access</em> role.</p></li><li><p>Click <strong>Add Role</strong>.</p></li><li><p>Enter the role name (this example uses the role <em>saml-user-role</em>) and click <strong>Save</strong>.</p></li></ol></div>
<div class="paragraph"><p><strong>Create Users and Assign Roles</strong></p></div>
<div class="paragraph"><p>Create two users:
- Assign the <em>realm management user</em> the <strong>realm-management</strong> roles to handle automatic Red Hat Single Sign-On client registration in the Red Hat Single Sign-On server.
- Assign the <em>application user</em> the JEE role, created in the previous step, to authenticate access to user applications.</p></div>
<div class="paragraph"><p>Create the <em>realm management user</em>:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Click <strong>Users</strong> in the <strong>Manage</strong> sidebar to view the user information for the realm.</p></li><li><p>Click <strong>Add User</strong>.</p></li><li><p>Enter a valid <strong>Username</strong> (this example uses the user <em>app-mgmt-user</em>) and click <strong>Save</strong>.</p></li><li><p>Edit the user configuration. Click the <strong>Credentials</strong> tab in the user space and enter a password for the user. After the password has been confirmed you can click <strong>Reset Password</strong> to set the user password. A pop-up window prompts for additional confirmation.</p></li></ol></div>
<div class="paragraph"><p>Create the <em>application user</em>:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Click <strong>Users</strong> in the <strong>Manage</strong> sidebar to view the user information for the realm.</p></li><li><p>Click <strong>Add User</strong>.</p></li><li><p>Enter a valid <strong>Username</strong> and any additional optional information for the <em>application user</em> and click <strong>Save</strong>.</p></li><li><p>Edit the user configuration. Click the <strong>Credentials</strong> tab in the user space and enter a password for the user. After the password has been confirmed you can click <strong>Reset Password</strong> to set the user password. A pop-up window prompts for additional confirmation.</p></li><li><p>Click <strong>Role Mappings</strong> to list the realm and client role configuration. In <strong>Available Roles</strong>, add the role created earlier.</p></li></ol></div>
<div class="paragraph"><p><strong>Create and Configure a SAML Client</strong>:</p></div>
<div class="paragraph"><p>Clients are Red Hat Single Sign-On entities that request user authentication. This example configures a SAML client to handle authentication for the EAP application. This section saves two files, <strong>keystore.jks</strong> and <strong>keycloak-saml-subsystem.xml</strong> that are needed later in the procedure.</p></div>
<div class="paragraph"><p>Create the SAML Client:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Click <strong>Clients</strong> in the <strong>Configure</strong> sidebar to list the clients in the realm. Click <strong>Create</strong>.</p></li><li><p>Enter a valid <strong>Client ID</strong>. This example uses <em>sso-saml-demo</em>.</p></li><li><p>In the <strong>Client Protocol</strong> drop-down menu, select <strong>saml</strong>.</p></li><li><p>Enter the <strong>Root URL</strong> for the application. This example uses <em>https://demoapp-eap-app-demo.openshift32.example.com</em>.</p></li><li><p>Click <strong>Save</strong>.</p></li></ol></div>
<div class="paragraph"><p>Configure the SAML Client:</p></div>
<div class="paragraph"><p>In the <strong>Settings</strong> tab, set the <strong>Root URL</strong> and the <strong>Valid Redirect URLs</strong> for the new <strong><em>sso-saml-demo</em></strong> client:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>For the <strong>Root URL</strong>, enter the same address used when creating the client. This example uses <em>https://demoapp-eap-app-demo.openshift32.example.com</em>.</p></li><li><p>For the <strong>Valid Redirect URLs</strong>, enter an address for users to be redirected to at when they log in or out. This example uses a redirect address relative to the root <em>https://demoapp-eap-app-demo.openshift32.example.com/*</em>.</p></li></ol></div>
<div class="paragraph"><p>Export the SAML Keys:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Click the <strong>SAML Keys</strong> tab in the <em>sso-saml-demo</em> client space and click <strong>Export</strong>.</p></li><li><p>For this example, leave the <strong>Archive Format</strong> as <strong>JKS</strong>. This example uses the default <strong>Key Alias</strong> of <em>sso-saml-demo</em> and default <strong>Realm Certificate Alias</strong> of <em>saml-demo</em>.</p></li><li><p>Enter the <strong>Key Password</strong> and the <strong>Store Password</strong>. This example uses <em>password</em> for both.</p></li><li><p>Click <strong>Download</strong> and save the <strong>keystore-saml.jks</strong> file for use later.</p></li><li><p>Click the <strong><em>sso-saml-demo</em></strong> client to return to the client space ready for the next step.</p></li></ol></div>
<div class="paragraph"><p>Download the Client Adapter:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Click <strong>Installation</strong>.</p></li><li><p>Use the <strong>Format Option</strong> drop-down menu to select a format. This example uses <strong>Keycloak SAML Wildfly/JBoss Subsystem</strong>.</p></li><li><p>Click <strong>Download</strong> and save the file <strong>keycloak-saml-subsystem.xml</strong>.</p></li></ol></div>
<div class="paragraph"><p>The <strong>keystore-saml.jks</strong> will be used with the other EAP keystores in the next section to create an OpenShift secret for the EAP application project. Copy the <strong>keystore-saml.jks</strong> file to an OpenShift node.<br>
The <strong>keycloak-saml-subsystem.xml</strong> will be modified and used in the application deployment. Copy it into the <strong>/configuration</strong> folder of the application as <strong>secure-saml-deployments</strong>.</p></div>
<h3>Preparing Red Hat Single Sign-On Authentication for OpenShift Deployment</h3><div class="paragraph"><p>Log in to the OpenShift CLI with a user that holds the <em>cluster:admin</em> role.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Create a new project:</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc new-project eap-app-demo</code></pre></li><li><p>Add the <code>view</code> role to the <a href="https://docs.openshift.com/container-platform/latest/dev_guide/service_accounts.html#default-service-accounts-and-roles"><code>default</code></a> service account. This enables the service account to view all the resources in the <code>eap-app-demo</code> namespace, which is necessary for managing the cluster.</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc policy add-role-to-user view system:serviceaccount:$(oc project -q):default</code></pre></li><li><p>The EAP template requires an <a href="#Configuring-Keystores">SSL keystore and a JGroups keystore</a>.<br>
This example uses <code>keytool</code>, a package included with the Java Development Kit, to generate self-signed certificates for these keystores. The following commands will prompt for passwords.<br></p><div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>Generate a secure key for the SSL keystore:</p><pre class="highlight listingblock"><code class="bash language-bash">$ keytool -genkeypair -alias https -storetype JKS -keystore eapkeystore.jks</code></pre></li><li><p>Generate a secure key for the JGroups keystore:</p><pre class="highlight listingblock"><code class="bash language-bash">$ keytool -genseckey -alias jgroups -storetype JCEKS -keystore eapjgroups.jceks</code></pre></li></ol></div></li><li><p>Generate the EAP for OpenShift secrets with the SSL and JGroup keystore files:</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc secret new eap-ssl-secret eapkeystore.jks
$ oc secret new eap-jgroup-secret eapjgroups.jceks</code></pre></li><li><p>Add the EAP application secret to the EAP service account created earlier:</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc secrets link default eap-ssl-secret eap-jgroup-secret</code></pre></li></ol></div>
<h3>Modifying the <strong>secure-saml-deployments</strong> File</h3><div class="paragraph"><p>The <strong>keycloak-saml-subsystem.xml</strong>, exported from the Red Hat Single Sign-On client in a previous section, should have been copied into the <strong>/configuration</strong> folder of the application and renamed <strong>secure-saml-deployments</strong>. EAP searches for this file when it starts and copies it to the <strong>standalone-openshift.xml</strong> file inside the Red Hat Single Sign-On SAML adapter configuration.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Open the <strong>/configuration/secure-saml-deployments</strong> file in a text editor.</p></li><li><p>Replace the <strong>YOUR-WAR.war</strong> value of the <strong>secure-deployment name</strong> tag with the application <strong>.war</strong> file. This example uses <em>sso-saml-demo.war</em>.</p></li><li><p>Replace the <strong>SPECIFY YOUR LOGOUT PAGE!</strong> value of the <strong>logout page</strong> tag with the url to redirect users when they log out of the application. This example uses <strong>/index.jsp</strong>.</p></li><li><p>Delete the <strong>&lt;PrivateKeyPem&gt;</strong> and <strong>&lt;CertificatePem&gt;</strong> tags and keys and replace it with keystore information:</p><pre class="highlight listingblock"><code class="bash language-bash">...
&lt;Keys&gt;
  &lt;Key signing="true"&gt;
    &lt;KeyStore file= "/etc/eap-secret-volume/keystore-saml.jks" password="password"&gt;
      &lt;PrivateKey alias="sso-saml-demo" password="password"/&gt;
      &lt;Certificate alias="sso-saml-demo"/&gt;
    &lt;/KeyStore&gt;
  &lt;/Key&gt;
&lt;/Keys&gt;</code></pre>
<div class="paragraph"><p>The mount path of the <strong>keystore-saml.jks</strong> (in this example <strong><em>/etc/eap-secret-volume/keystore-saml.jks</em></strong>) can be specified in the application template with the parameter <strong>EAP_HTTPS_KEYSTORE_DIR</strong>.<br>
The aliases and passwords for the <strong>PrivateKey</strong> and the <strong>Certificate</strong> were configured when the SAML Keys were exported from the Red Hat Single Sign-On client.</p></div></li><li><p>Delete the second <strong>&lt;CertificatePem&gt;</strong> tag and key and replace it with the the realm certificate information:</p><pre class="highlight listingblock"><code class="bash language-bash">...
&lt;Keys&gt;
  &lt;Key signing="true"&gt;
    &lt;KeyStore file="/etc/eap-secret-volume/keystore-saml.jks" password="password"&gt;
      &lt;Certificate alias="saml-demo"/&gt;
    &lt;/KeyStore&gt;
  &lt;/Key&gt;
&lt;/Keys&gt;
...</code></pre>
<div class="paragraph"><p>The certificate alias and password were configured when the SAML Keys were exported from the Red Hat Single Sign-On client.</p></div></li><li><p>Save and close the <strong>/configuration/secure-saml-deployments</strong> file.</p></li></ol></div>
<h3>Configuring SAML Client Registration in the Application <strong>web.xml</strong></h3><div class="paragraph"><p>The client type must also be specified by the <strong>&lt;auth-method&gt;</strong> key in the application <strong>web.xml</strong>. This file is read by the image at deployment.</p></div>
<div class="paragraph"><p>Open the application <strong>web.xml</strong> file and ensure it includes the following:</p></div>
<pre class="highlight listingblock"><code class="bash language-bash">...
&lt;login-config&gt;
  &lt;auth-method&gt;KEYCLOAK-SAML&lt;/auth-method&gt;
&lt;/login-config&gt;
...</code></pre>
<h3>Deploying the Application</h3><div class="paragraph"><p>You do not need to include any Red Hat Single Sign-On configuration for the image because that has been configured in the application itself. Navigating to the application login page redirects you to the Red Hat Single Sign-On login. Log in to the application through Red Hat Single Sign-On using the <em>application user</em> user created earlier.</p></div></section></section>
<section><section id="_reference"><h2>Reference</h2></section><section id="sso-artifact-repository-mirrors-section"><h2>Artifact Repository Mirrors</h2><div class="paragraph"><p>A repository in Maven holds build artifacts and dependencies of various types
(all the project jars, library jar, plugins or any other project specific
artifacts). It also specifies locations from where to download artifacts from,
while performing the S2I build. Besides using central repositories, it is a
common practice for organizations to deploy a local custom repository (mirror).</p></div>
<div class="paragraph"><p>Benefits of using a mirror are:</p></div>
<div class="ulist"><ul><li><p>Availability of a synchronized mirror, which is geographically closer and
faster.</p></li><li><p>Ability to have greater control over the repository content.</p></li><li><p>Possibility to share artifacts across different teams (developers, CI),
without the need to rely on public servers and repositories.</p></li><li><p>Improved build times.</p></li></ul></div>
<div class="paragraph"><p>Often, a repository manager can serve as local cache to a mirror. Assuming that
the repository manager is already deployed and reachable externally at
<strong><em>http://10.0.0.1:8080/repository/internal/</em></strong>, the S2I build can then use this
manager by supplying the <code>MAVEN_MIRROR_URL</code> environment variable to the
build configuration of the application as follows:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Identify the name of the build configuration to apply <code>MAVEN_MIRROR_URL</code>
variable against:</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc get bc -o name
buildconfig/sso</code></pre></li><li><p>Update build configuration of <code>sso</code> with a <code>MAVEN_MIRROR_URL</code> environment variable</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc set env bc/sso \
  -e MAVEN_MIRROR_URL="http://10.0.0.1:8080/repository/internal/"
buildconfig "sso" updated</code></pre></li><li><p>Verify the setting</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc set env bc/sso --list
# buildconfigs sso
MAVEN_MIRROR_URL=http://10.0.0.1:8080/repository/internal/</code></pre></li><li><p>Schedule new build of the application</p></li></ol></div>
<div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">During application build, you will notice that Maven dependencies are
pulled from the repository manager, instead of the default public repositories.
Also, after the build is finished, you will see that the mirror is filled with
all the dependencies that were retrieved and used during the build.</td></tr></table></div>
<div class="paragraph"><p>A repository in Maven holds build artifacts and dependencies of various types
(all the project jars, library jar, plugins or any other project specific
artifacts). It also specifies locations from where to download artifacts from,
while performing the S2I build. Besides using central repositories, it is a
common practice for organizations to deploy a local custom repository (mirror).</p></div>
<div class="paragraph"><p>Benefits of using a mirror are:</p></div>
<div class="ulist"><ul><li><p>Availability of a synchronized mirror, which is geographically closer and
faster.</p></li><li><p>Ability to have greater control over the repository content.</p></li><li><p>Possibility to share artifacts across different teams (developers, CI),
without the need to rely on public servers and repositories.</p></li><li><p>Improved build times.</p></li></ul></div>
<div class="paragraph"><p>Often, a repository manager can serve as local cache to a mirror. Assuming that
the repository manager is already deployed and reachable externally at
<strong><em>http://10.0.0.1:8080/repository/internal/</em></strong>, the S2I build can then use this
manager by supplying the <code>MAVEN_MIRROR_URL</code> environment variable to the
build configuration of the application as follows:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Identify the name of the build configuration to apply <code>MAVEN_MIRROR_URL</code>
variable against:</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc get bc -o name
buildconfig/sso</code></pre></li><li><p>Update build configuration of <code>sso</code> with a <code>MAVEN_MIRROR_URL</code> environment variable</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc set env bc/sso \
  -e MAVEN_MIRROR_URL="http://10.0.0.1:8080/repository/internal/"
buildconfig "sso" updated</code></pre></li><li><p>Verify the setting</p><pre class="highlight listingblock"><code class="bash language-bash">$ oc set env bc/sso --list
# buildconfigs sso
MAVEN_MIRROR_URL=http://10.0.0.1:8080/repository/internal/</code></pre></li><li><p>Schedule new build of the application</p></li></ol></div>
<div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">During application build, you will notice that Maven dependencies are
pulled from the repository manager, instead of the default public repositories.
Also, after the build is finished, you will see that the mirror is filled with
all the dependencies that were retrieved and used during the build.</td></tr></table></div></section><section id="env_vars"><h2>Environment Variables</h2><h3>Information Environment Variables</h3><div class="paragraph"><p>The following information environment variables are designed to convey
information about the image and should not be modified by the user:</p></div>
<table class="tableblock frame-all grid-all" style="width:100%"><caption class="title">Table 2. Information Environment Variables</caption><colgroup><col style="width:33.3333%"><col style="width:33.3333%"><col style="width:33.3334%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Variable Name</th><th class="tableblock halign-left valign-top">Description</th><th class="tableblock halign-left valign-top">Example Value</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_AUTH_OPENSHIFT</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>true</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_HTTPS</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>true</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_PASSWORD_RANDOM</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>true</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JBOSS_IMAGE_NAME</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Image name, same as Name label.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>redhat-sso-7/sso72-openshift</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JBOSS_IMAGE_RELEASE</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Image release, same as Release label.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>dev</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JBOSS_IMAGE_VERSION</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Image version, same as Version label.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>1.1</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JBOSS_MODULES_SYSTEM_PKGS</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>org.jboss.logmanager,jdk.nashorn.api</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>STI_BUILDER</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Provides OpenShift S2I support for jee project types.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>jee</em></strong></p></td></tr></table>
<h3>Configuration Environment Variables</h3><div class="paragraph"><p>Configuration environment variables are designed to conveniently adjust the
image without requiring a rebuild, and should be set by the user as desired.</p></div>
<table id="conf_env_vars" class="tableblock frame-all grid-all" style="width:100%"><caption class="title">Table 3. Configuration Environment Variables</caption><colgroup><col style="width:33.3333%"><col style="width:33.3333%"><col style="width:33.3334%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Variable Name</th><th class="tableblock halign-left valign-top">Description</th><th class="tableblock halign-left valign-top">Example Value</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_AUTH_OPENSHIFT</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Switch on client authentication for OpenShift TLS communication. The value of
this parameter can be a relative distinguished name which must be contained in
a presented client&#8217;s certificate. Enabling this parameter will automatically
switch Jolokia into https communication mode. The default CA cert is set to
<code>/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</code>.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>true</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_CONFIG</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">If set uses this file (including path) as Jolokia JVM agent properties (as
described in Jolokia&#8217;s
<a href="https://jolokia.org/reference/html/agents.html#agents-jvm">reference
manual</a>). If not set, the <code>/opt/jolokia/etc/jolokia.properties</code> file will be
created using the settings as defined in this document, otherwise the rest of
the settings in this document are ignored.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>/opt/jolokia/custom.properties</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_DISCOVERY_ENABLED</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Enable Jolokia discovery. Defaults to <strong><em>false</em></strong>.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>true</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_HOST</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Host address to bind to. Defaults to <strong><em>0.0.0.0</em></strong>.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>127.0.0.1</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_HTTPS</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Switch on secure communication with https. By default self-signed server
certificates are generated if no serverCert configuration is given in
<strong><em>AB_JOLOKIA_OPTS</em></strong>. <em>NOTE: If the values is set to an empty string, https is
turned <code>off</code>. If the value is set to a non empty string, https is turned <code>on</code>.</em></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>true</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_ID</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Agent ID to use ($HOSTNAME by default, which is the container id).</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>openjdk-app-1-xqlsj</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_OFF</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">If set disables activation of Jolokia (i.e. echos an empty value). By default,
Jolokia is enabled. <em>NOTE: If the values is set to an empty string, https is
turned <code>off</code>. If the value is set to a non empty string, https is turned <code>on</code>.</em></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>true</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_OPTS</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Additional options to be appended to the agent configuration. They should be
given in the format <code>"key=value, key=value, …&lt;200b&gt; "</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>backlog=20</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_PASSWORD</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Password for basic authentication. By default authentication is switched off.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>mypassword</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_PASSWORD_RANDOM</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">If set, a random value is generated for <strong><em>AB_JOLOKIA_PASSWORD</em></strong>, and it is
saved in the <strong><em>/opt/jolokia/etc/jolokia.pw</em></strong> file.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>true</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_PORT</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Port to use (Default: <strong><em>8778</em></strong>).</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>5432</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AB_JOLOKIA_USER</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">User for basic authentication. Defaults to <strong><em>jolokia</em></strong>.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>myusername</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>CONTAINER_CORE_LIMIT</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">A calculated core limit as described in
<a href="https://www.kernel.org/doc/Documentation/scheduler/sched-bwc.txt">CFS
Bandwidth Control.</a></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>2</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>GC_ADAPTIVE_SIZE_POLICY_WEIGHT</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The weighting given to the current Garbage Collection (GC) time versus previous
GC times.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>90</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>GC_MAX_HEAP_FREE_RATIO</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Maximum percentage of heap free after GC to avoid shrinking.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>40</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>GC_MAX_METASPACE_SIZE</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The maximum metaspace size.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>100</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>GGC_TIME_RATIOC_MIN_HEAP_FREE_RATIO</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Minimum percentage of heap free after GC to avoid expansion.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>20</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>GC_TIME_RATIO</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the ratio of the time spent outside the garbage collection (for
example, the time spent for application execution) to the time spent in the
garbage collection.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>4</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JAVA_DIAGNOSTICS</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Set this to get some diagnostics information to standard out when things are
happening.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>true</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JAVA_INITIAL_MEM_RATIO</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">This is used to calculate a default initial heap memory based the maximal
heap memory. The default is 100 which means 100% of the maximal heap is used
for the initial heap size. You can skip this mechanism by setting this value
to 0 in which case no <code>-Xms</code> option is added.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>100</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JAVA_MAX_MEM_RATIO</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">It is used to calculate a default maximal heap memory based on a containers
restriction. If used in a Docker container without any memory constraints for
the container then this option has no effect. If there is a memory constraint
then <code>-Xmx</code> is set to a ratio of the container available memory as set here.
The default is 50 which means 50% of the available memory is used as an upper
boundary. You can skip this mechanism by setting this value to 0 in which case
no <code>-Xmx</code> option is added.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>40</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JAVA_OPTS_APPEND</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Server startup options.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>-Dkeycloak.migration.action=export -Dkeycloak.migration.provider=dir -Dkeycloak.migration.dir=/tmp</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>MQ_SIMPLE_DEFAULT_PHYSICAL_DESTINATION</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">For backwards compatability, set to true to use <code>MyQueue</code> and <code>MyTopic</code> as
physical destination name defaults instead of <code>queue/MyQueue</code> and <code>topic/MyTopic</code>.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>false</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>OPENSHIFT_KUBE_PING_LABELS</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Clustering labels selector.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>app=sso-app</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>OPENSHIFT_KUBE_PING_NAMESPACE</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Clustering project namespace.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>myproject</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SCRIPT_DEBUG</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code>, ensurses that the bash scripts are executed with the <code>-x</code>
option, printing the commands and their arguments as they are executed.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>true</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_ADMIN_PASSWORD</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Password of the administrator account for the <code>master</code> realm of the Red Hat Single Sign-On
server. <strong>Required.</strong> If no value is specified, it is auto generated and
displayed as an OpenShift Instructional message when the template is
instantiated.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>adm-password</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_ADMIN_USERNAME</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Username of the administrator account for the <code>master</code> realm of the Red Hat Single Sign-On
server. <strong>Required.</strong> If no value is specified, it is auto generated and
displayed as an OpenShift Instructional message when the template is
instantiated.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>admin</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_HOSTNAME</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Custom hostname for the Red Hat Single Sign-On server. <strong>Not set by default</strong>. If not
set, the <code>request</code> hostname SPI provider, which uses the request headers to
determine the hostname of the Red Hat Single Sign-On server is used. If set, the
<code>fixed</code> hostname SPI provider, with the hostname of the Red Hat Single Sign-On server
set to the provided variable value, is used. See dedicated
<a href="../content/advanced_concepts/advanced_concepts.html#advanced-concepts-sso-hostname-spi-setup">Customizing Hostname for the Red Hat Single Sign-On Server</a>
section for additional steps to be performed, when <strong><em>SSO_HOSTNAME</em></strong> variable
is set.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>rh-sso-server.openshift.example.com</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_REALM</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Name of the realm to be created in the Red Hat Single Sign-On server if this environment variable
is provided.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>demo</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SERVICE_PASSWORD</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The password for the Red Hat Single Sign-On service user.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>mgmt-password</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SERVICE_USERNAME</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The username used to access the Red Hat Single Sign-On service. This is used by clients to create
the application client(s) within the specified Red Hat Single Sign-On realm. This user is created
if this environment variable is provided.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>sso-mgmtuser</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_TRUSTSTORE</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The name of the truststore file within the secret.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>truststore.jks</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_TRUSTSTORE_DIR</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Truststore directory.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>/etc/sso-secret-volume</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_TRUSTSTORE_PASSWORD</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The password for the truststore and certificate.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>mykeystorepass</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_TRUSTSTORE_SECRET</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The name of the secret containing the truststore file. Used for
<em>sso-truststore-volume</em> volume.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>truststore-secret</em></strong></p></td></tr></table>
<div class="paragraph"><p>Available <a href="https://docs.openshift.com/container-platform/latest/dev_guide/templates.html#overview">application templates</a>
for Red Hat Single Sign-On for OpenShift can combine the <a href="#conf_env_vars">aforementioned configuration variables</a> with common OpenShift variables (for example
<strong><em>APPLICATION_NAME</em></strong> or <strong><em>SOURCE_REPOSITORY_URL</em></strong>), product specific variables
(e.g. <strong><em>HORNETQ_CLUSTER_PASSWORD</em></strong>), or configuration variables typical to
database images (e.g. <strong><em>MYSQL_FT_MAX_WORD_LEN</em></strong>) yet. All of these different
types of configuration variables can be adjusted as desired to achieve the
deployed Red Hat Single Sign-On-enabled application will align with the intended use case as much
as possible. The list of configuration variables, available for each category
of application templates for Red Hat Single Sign-On-enabled applications, is described below.</p></div>
<h3>Template variables for all Red Hat Single Sign-On images</h3><table class="tableblock frame-all grid-all" style="width:100%"><caption class="title">Table 4. Configuration Variables Available For All Red Hat Single Sign-On Images</caption><colgroup><col style="width:50%"><col style="width:50%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Variable</th><th class="tableblock halign-left valign-top">Description</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>APPLICATION_NAME</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The name for the application.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>DB_MAX_POOL_SIZE</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Sets xa-pool/max-pool-size for the configured datasource.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>DB_TX_ISOLATION</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Sets transaction-isolation for the configured datasource.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>DB_USERNAME</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Database user name.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HOSTNAME_HTTP</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Custom hostname for http service route. Leave blank for default hostname,
e.g.: <em>&lt;application-name&gt;.&lt;project&gt;.&lt;default-domain-suffix&gt;</em>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HOSTNAME_HTTPS</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Custom hostname for https service route. Leave blank for default hostname,
e.g.: <em>&lt;application-name&gt;.&lt;project&gt;.&lt;default-domain-suffix&gt;</em>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_KEYSTORE</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The name of the keystore file within the secret. If defined along with
<strong><em>HTTPS_PASSWORD</em></strong> and <strong><em>HTTPS_NAME</em></strong>, enable HTTPS and set the SSL certificate
key file to a relative path under <em>$JBOSS_HOME/standalone/configuration</em>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_KEYSTORE_TYPE</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The type of the keystore file (JKS or JCEKS).</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_NAME</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The name associated with the server certificate (e.g. <em>jboss</em>). If defined
along with <strong><em>HTTPS_PASSWORD</em></strong> and <strong><em>HTTPS_KEYSTORE</em></strong>, enable HTTPS and set the
SSL name.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_PASSWORD</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The password for the keystore and certificate (e.g. <em>mykeystorepass</em>). If
defined along with <strong><em>HTTPS_NAME</em></strong> and <strong><em>HTTPS_KEYSTORE</em></strong>, enable HTTPS and set
the SSL key password.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_SECRET</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The name of the secret containing the keystore file.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>IMAGE_STREAM_NAMESPACE</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Namespace in which the ImageStreams for Red Hat Middleware images are
installed. These ImageStreams are normally installed in the <em>openshift</em>
namespace. You should only need to modify this if you&#8217;ve installed the
ImageStreams in a different namespace/project.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_CLUSTER_PASSWORD</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">JGroups cluster password.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_ENCRYPT_KEYSTORE</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The name of the keystore file within the secret.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_ENCRYPT_NAME</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The name associated with the server certificate (e.g. <em>secret-key</em>).</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_ENCRYPT_PASSWORD</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The password for the keystore and certificate (e.g. <em>password</em>).</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_ENCRYPT_SECRET</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The name of the secret containing the keystore file.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_ADMIN_USERNAME</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Username of the administrator account for the <code>master</code> realm of the Red Hat Single Sign-On
server. <strong>Required.</strong> If no value is specified, it is auto generated and
displayed as an OpenShift instructional message when the template is
instantiated.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_ADMIN_PASSWORD</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Password of the administrator account for the <code>master</code> realm of the Red Hat Single Sign-On
server. <strong>Required.</strong> If no value is specified, it is auto generated and
displayed as an OpenShift instructional message when the template is
instantiated.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_REALM</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Name of the realm to be created in the Red Hat Single Sign-On server if this environment variable
is provided.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SERVICE_USERNAME</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The username used to access the Red Hat Single Sign-On service. This is used by clients to create
the application client(s) within the specified Red Hat Single Sign-On realm. This user is created
if this environment variable is provided.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SERVICE_PASSWORD</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The password for the Red Hat Single Sign-On service user.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_TRUSTSTORE</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The name of the truststore file within the secret.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_TRUSTSTORE_SECRET</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The name of the secret containing the truststore file. Used for
<strong><em>sso-truststore-volume</em></strong> volume.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_TRUSTSTORE_PASSWORD</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The password for the truststore and certificate.</p></td></tr></table>
<h3>Template variables specific to <strong><em>sso-cd-mysql</em></strong>, <strong><em>sso-cd-mysql-persistent</em></strong>, and <strong><em>sso-cd-x509-mysql-persistent</em></strong></h3><table class="tableblock frame-all grid-all" style="width:100%"><caption class="title">Table 5. Configuration Variables Specific To Red Hat Single Sign-On-enabled MySQL Applications With Ephemeral Or Persistent Storage</caption><colgroup><col style="width:50%"><col style="width:50%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Variable</th><th class="tableblock halign-left valign-top">Description</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>DB_USERNAME</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Database user name.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>DB_PASSWORD</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Database user password.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>DB_JNDI</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Database JNDI name used by application to resolve the datasource,
e.g. <em>java:/jboss/datasources/mysql</em>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>MYSQL_AIO</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Controls the <em>innodb_use_native_aio</em> setting value if the native AIO is
broken.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>MYSQL_FT_MAX_WORD_LEN</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The maximum length of the word to be included in a FULLTEXT index.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>MYSQL_FT_MIN_WORD_LEN</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The minimum length of the word to be included in a FULLTEXT index.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>MYSQL_LOWER_CASE_TABLE_NAMES</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Sets how the table names are stored and compared.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>MYSQL_MAX_CONNECTIONS</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The maximum permitted number of simultaneous client connections.</p></td></tr></table>
<h3>Template variables specific to <strong><em>sso-cd-postgresql</em></strong>, <strong><em>sso-cd-postgresql-persistent</em></strong>, and <strong><em>sso-cd-x509-postgresql-persistent</em></strong></h3><table class="tableblock frame-all grid-all" style="width:100%"><caption class="title">Table 6. Configuration Variables Specific To Red Hat Single Sign-On-enabled PostgreSQL Applications With Ephemeral Or Persistent Storage</caption><colgroup><col style="width:50%"><col style="width:50%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Variable</th><th class="tableblock halign-left valign-top">Description</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>DB_USERNAME</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Database user name.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>DB_PASSWORD</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Database user password.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>DB_JNDI</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Database JNDI name used by application to resolve the datasource,
e.g. <em>java:/jboss/datasources/postgresql</em></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>POSTGRESQL_MAX_CONNECTIONS</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of client connections allowed. This also sets the maximum
number of prepared transactions.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>POSTGRESQL_SHARED_BUFFERS</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Configures how much memory is dedicated to PostgreSQL for caching data.</p></td></tr></table>
<h3>Template variables specific to <strong><em>sso-cd-mysql-persistent</em></strong>, <strong><em>sso-cd-x509-mysql-persistent</em></strong>, <strong><em>sso-cd-postgresql-persistent</em></strong>, and <strong><em>sso-cd-x509-postgresql-persistent</em></strong></h3><table class="tableblock frame-all grid-all" style="width:100%"><caption class="title">Table 7. Configuration Variables Specific To Red Hat Single Sign-On-enabled MySQL / PostgreSQL Applications With Persistent Storage</caption><colgroup><col style="width:50%"><col style="width:50%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Variable</th><th class="tableblock halign-left valign-top">Description</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>VOLUME_CAPACITY</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Size of persistent storage for database volume.</p></td></tr></table>
<h3>Template variables for general <strong>eap64</strong> and <strong>eap71</strong> S2I images</h3><table class="tableblock frame-all grid-all" style="width:100%"><caption class="title">Table 8. Configuration Variables For EAP 6.4 and EAP 7 Applications Built Via S2I</caption><colgroup><col style="width:50%"><col style="width:50%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Variable</th><th class="tableblock halign-left valign-top">Description</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>APPLICATION_NAME</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The name for the application.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>ARTIFACT_DIR</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Artifacts directory.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>AUTO_DEPLOY_EXPLODED</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Controls whether exploded deployment content should be automatically deployed.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>CONTEXT_DIR</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Path within Git project to build; empty for root project directory.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>GENERIC_WEBHOOK_SECRET</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Generic build trigger secret.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>GITHUB_WEBHOOK_SECRET</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">GitHub trigger secret.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HORNETQ_CLUSTER_PASSWORD</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">HornetQ cluster administrator password.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HORNETQ_QUEUES</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Queue names.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HORNETQ_TOPICS</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Topic names.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HOSTNAME_HTTP</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Custom host name for http service route. Leave blank for default host name,
e.g.: <em>&lt;application-name&gt;.&lt;project&gt;.&lt;default-domain-suffix&gt;</em>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HOSTNAME_HTTPS</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Custom host name for https service route. Leave blank for default host name,
e.g.: <em>&lt;application-name&gt;.&lt;project&gt;.&lt;default-domain-suffix&gt;</em>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_KEYSTORE_TYPE</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The type of the keystore file (JKS or JCEKS).</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_KEYSTORE</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The name of the keystore file within the secret. If defined along with
<strong><em>HTTPS_PASSWORD</em></strong> and <strong><em>HTTPS_NAME</em></strong>, enable HTTPS and set the SSL certificate
key file to a relative path under <em>$JBOSS_HOME/standalone/configuration</em>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_NAME</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The name associated with the server certificate (e.g. <em>jboss</em>). If defined
along with <strong><em>HTTPS_PASSWORD</em></strong> and <strong><em>HTTPS_KEYSTORE</em></strong>, enable HTTPS and set the
SSL name.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_PASSWORD</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The password for the keystore and certificate (e.g. <em>mykeystorepass</em>). If
defined along with <strong><em>HTTPS_NAME</em></strong> and <strong><em>HTTPS_KEYSTORE</em></strong>, enable HTTPS and set
the SSL key password.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>HTTPS_SECRET</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The name of the secret containing the keystore file.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>IMAGE_STREAM_NAMESPACE</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Namespace in which the ImageStreams for Red Hat Middleware images are
installed. These ImageStreams are normally installed in the <em>openshift</em>
namespace. You should only need to modify this if you&#8217;ve installed the
ImageStreams in a different namespace/project.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_CLUSTER_PASSWORD</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">JGroups cluster password.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_ENCRYPT_KEYSTORE</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The name of the keystore file within the secret.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_ENCRYPT_NAME</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The name associated with the server certificate (e.g. <em>secret-key</em>).</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_ENCRYPT_PASSWORD</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The password for the keystore and certificate (e.g. <em>password</em>).</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>JGROUPS_ENCRYPT_SECRET</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The name of the secret containing the keystore file.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SOURCE_REPOSITORY_REF</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Git branch/tag reference.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SOURCE_REPOSITORY_URL</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Git source URI for application.</p></td></tr></table>
<h3>Template variables specific to <strong><em>eap64-sso-s2i</em></strong> and <strong><em>eap71-sso-s2i</em></strong> for automatic client registration</h3><table class="tableblock frame-all grid-all" style="width:100%"><caption class="title">Table 9. Configuration Variables For EAP 6.4 and EAP 7 Red Hat Single Sign-On-enabled Applications Built Via S2I</caption><colgroup><col style="width:50%"><col style="width:50%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Variable</th><th class="tableblock halign-left valign-top">Description</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_URL</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Red Hat Single Sign-On server location.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_REALM</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Name of the realm to be created in the Red Hat Single Sign-On server if this environment variable
is provided.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_USERNAME</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The username used to access the Red Hat Single Sign-On service. This is used to create the
application client(s) within the specified Red Hat Single Sign-On realm. This should match the
<strong><em>SSO_SERVICE_USERNAME</em></strong> specified through one of the <strong>sso-cd-</strong> templates.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_PASSWORD</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The password for the Red Hat Single Sign-On service user.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_PUBLIC_KEY</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Red Hat Single Sign-On public key. Public key is recommended to be passed into the template to
avoid man-in-the-middle security attacks.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SECRET</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The Red Hat Single Sign-On client secret for confidential access.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SERVICE_URL</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Red Hat Single Sign-On service location.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_TRUSTSTORE_SECRET</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The name of the secret containing the truststore file. Used for
<strong><em>sso-truststore-volume</em></strong> volume.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_TRUSTSTORE</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The name of the truststore file within the secret.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_TRUSTSTORE_PASSWORD</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The password for the truststore and certificate.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_BEARER_ONLY</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Red Hat Single Sign-On client access type.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_DISABLE_SSL_CERTIFICATE_VALIDATION</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">If true SSL communication between EAP and the Red Hat Single Sign-On Server is insecure
(i.e. certificate validation is disabled with curl)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_ENABLE_CORS</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Enable CORS for Red Hat Single Sign-On applications.</p></td></tr></table>
<h3>Template variables specific to <strong><em>eap64-sso-s2i</em></strong> and <strong><em>eap71-sso-s2i</em></strong> for automatic client registration with SAML clients</h3><table class="tableblock frame-all grid-all" style="width:100%"><caption class="title">Table 10. Configuration Variables For EAP 6.4 and EAP 7 Red Hat Single Sign-On-enabled Applications Built Via S2I Using SAML Protocol</caption><colgroup><col style="width:50%"><col style="width:50%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Variable</th><th class="tableblock halign-left valign-top">Description</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SAML_CERTIFICATE_NAME</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The name associated with the server certificate.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SAML_KEYSTORE_PASSWORD</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The password for the keystore and certificate.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SAML_KEYSTORE</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The name of the keystore file within the secret.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SAML_KEYSTORE_SECRET</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The name of the secret containing the keystore file.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>SSO_SAML_LOGOUT_PAGE</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Red Hat Single Sign-On logout page for SAML applications.</p></td></tr></table></section><section id="_exposed_ports"><h2>Exposed Ports</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Port Number</th><th class="tableblock halign-left valign-top">Description</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>8443</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>8778</em></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Jolokia monitoring</p></td></tr></table></section></section></div></div><script src="node_modules/reveal.js/lib/js/head.min.js"></script><script src="node_modules/reveal.js/js/reveal.js"></script><script>Array.prototype.slice.call(document.querySelectorAll('.slides section')).forEach(function(slide) {
  if (slide.getAttribute('data-background-color')) return;
  // user needs to explicitly say he wants CSS color to override otherwise we might break custom css or theme (#226)
  if (!(slide.classList.contains('canvas') || slide.classList.contains('background'))) return;
  var bgColor = getComputedStyle(slide).backgroundColor;
  if (bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent') {
    slide.setAttribute('data-background-color', bgColor);
    slide.style.backgroundColor = 'transparent';
  }
})

// See https://github.com/hakimel/reveal.js#configuration for a full list of configuration options
Reveal.initialize({
  // Display presentation control arrows
  controls: true,
  // Help the user learn the controls by providing hints, for example by
  // bouncing the down arrow when they first encounter a vertical slide
  controlsTutorial: true,
  // Determines where controls appear, "edges" or "bottom-right"
  controlsLayout: 'bottom-right',
  // Visibility rule for backwards navigation arrows; "faded", "hidden"
  // or "visible"
  controlsBackArrows: 'faded',
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: false,
  // Control which views the slide number displays on
  showSlideNumber: 'all',
  // Push each slide change to the browser history
  history: false,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // Randomizes the order of slides each time the presentation loads
  shuffle: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags whether to include the current fragment in the URL,
  // so that reloading brings you to the same fragment position
  fragmentInURL: false,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Flags if we should show a help overlay when the questionmark
  // key is pressed
  help: true,
  // Flags if speaker notes should be visible to all viewers
  showNotes: false,
  // Global override for autolaying embedded media (video/audio/iframe)
  // - null: Media will only autoplay if data-autoplay is present
  // - true: All media will autoplay, regardless of individual setting
  // - false: No media will autoplay, regardless of individual setting
  autoPlayMedia: null,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Use this method for navigation when auto-sliding
  autoSlideMethod: Reveal.navigateNext,
  // Specify the average time in seconds that you think you will spend
  // presenting each slide. This is used to show a pacing timer in the
  // speaker view
  defaultTiming: 120,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  // Add `data-preview-link` and `data-preview-link="false"` to customise each link
  // individually
  previewLinks: false,
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: 'slide',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',
  // Number of pixels to move the parallax background per slide
  // - Calculated automatically unless specified
  // - Set to 0 to disable movement along an axis
  parallaxBackgroundHorizontal: null,
  parallaxBackgroundVertical: null,
  // The display mode that will be used to show slides
  display: 'block',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 960,
  height: 700,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'node_modules/reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
      
      { src: 'node_modules/reveal.js/plugin/zoom-js/zoom.js', async: true },
      { src: 'node_modules/reveal.js/plugin/notes/notes.js', async: true },
      
      
      
      
  ],

  

});</script></body></html>